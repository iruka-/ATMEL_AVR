<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>2011-09 - PukiWiki</title>
 <link rel="stylesheet" type="text/css" media="screen" href="../skin/monobook/monobook.css" />
 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />
</head>
<body>
<div id="globalWrapper">
 <div id="menubar"><ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage" data-mtime="2015-05-02T16:17:31+09:00">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage" data-mtime="2013-04-29T09:29:29+09:00">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage" data-mtime="2014-12-01T23:50:24+09:00">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage" data-mtime="2012-09-12T22:43:19+09:00">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage" data-mtime="2011-11-25T22:47:41+09:00">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage" data-mtime="2011-11-27T16:31:48+09:00">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage" data-mtime="2015-05-02T16:17:40+09:00">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage" data-mtime="2014-09-27T22:53:38+09:00">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage" data-mtime="2014-11-20T22:01:19+09:00">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage" data-mtime="2015-02-01T14:32:31+09:00">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage" data-mtime="2013-05-10T22:28:35+09:00">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage" data-mtime="2009-09-25T17:26:22+09:00">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage" data-mtime="2009-04-16T22:42:14+09:00">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage" data-mtime="2010-02-17T16:23:41+09:00">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage" data-mtime="2009-05-06T01:05:20+09:00">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage" data-mtime="2010-04-28T09:27:01+09:00">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage" data-mtime="2014-06-22T14:58:37+09:00">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage" data-mtime="2015-01-22T18:20:53+09:00">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage" data-mtime="2012-12-06T13:25:35+09:00">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage" data-mtime="2015-05-07T20:22:52+09:00">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage" data-mtime="2008-10-13T03:47:40+09:00">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage" data-mtime="2010-11-02T22:35:53+09:00">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage" data-mtime="2010-10-11T18:16:06+09:00">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage" data-mtime="2008-05-17T00:51:37+09:00">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage" data-mtime="2007-08-28T23:52:40+09:00">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2022-07-25</strong>
<ul class="recent_list">
 <li><a href="20082D-10.html" class="link_page_passage" data-mtime="2022-07-25T22:19:24+09:00">2008-10</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li>
 <li><a href="H8EF-BC-8F-3048F.html" class="link_page_passage" data-mtime="2022-07-25T21:46:43+09:00">H8／3048F</a></li>
 <li><a href="AutoTicketLinkName.html" class="link_page_passage" data-mtime="2022-07-25T16:51:44+09:00">AutoTicketLinkName</a></li>
</ul>
<strong>2021-12-11</strong>
<ul class="recent_list">
 <li><a href="FormattingRules.html" class="link_page_passage" data-mtime="2021-12-11T00:40:03+09:00">FormattingRules</a></li>
</ul>
<strong>2021-12-08</strong>
<ul class="recent_list">
 <li><a href="PukiWiki/1.4/Manual/Plugin/O2D-R.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/O-R</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/L2D-N.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/L-N</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/V2D-Z.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/V-Z</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/A2D-D.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/A-D</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/E2D-G.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/E-G</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/S2D-U.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/S-U</a></li>
 <li><a href="PukiWiki/1.4/Manual/Plugin/H2D-K.html" class="link_page_passage" data-mtime="2021-12-08T08:58:38+09:00">PukiWiki/1.4/Manual/Plugin/H-K</a></li>
</ul>
<strong>2020-02-23</strong>
<ul class="recent_list">
 <li><a href="YukiWiki.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">YukiWiki</a></li>
 <li><a href="PHP.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">PHP</a></li>
 <li><a href="PukiWiki.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">PukiWiki</a></li>
 <li><a href="WikiWikiWeb.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">WikiWikiWeb</a></li>
</ul>
<strong>2018-12-19</strong>
<ul class="recent_list">
 <li><a href="SandBox.html" class="link_page_passage" data-mtime="2018-12-19T06:50:32+09:00">SandBox</a></li>
 <li><a href="InterWiki.html" class="link_page_passage" data-mtime="2018-12-19T06:50:32+09:00">InterWiki</a></li>
</ul>
<strong>2015-05-07</strong>
<ul class="recent_list">
 <li><a href="20152D-04.html" class="link_page_passage" data-mtime="2015-05-07T20:22:52+09:00">2015-04</a></li>
</ul>
<strong>2015-05-02</strong>
<ul class="recent_list">
 <li><a href="MenuBar.html" class="link_page_passage" data-mtime="2015-05-02T16:20:12+09:00">MenuBar</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li id="wn_main" class="selected"><a href="" title="2011-09" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">本文</a></li><li id="wn_note"><span class="noexists"><a href="./?cmd=edit&amp;page=note%2F2011-09">ノート</a></span></li><li><a href="./?cmd=edit&amp;page=2011-09">編集</a></li><li><a href="./?cmd=diff&amp;page=2011-09">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">2011-09</h1><div id="contentSub"></div>
    <p><a href="20112D-08.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">2011-08</a></p>
<hr class="full_hr" />
<h2 id="content_1_0">地球暦２０１１年。台風に非ず、白色彗星帝国が接近してきているらしい。<a class="anchor_super" id="u04f2d6a" href="#u04f2d6a" title="u04f2d6a" style="user-select:none;">&dagger;</a></h2>
<p><a href="http://omoroid.blog103.fc2.com/blog-entry-555.html" rel="nofollow">http://omoroid.blog103.fc2.com/blog-entry-555.html</a></p>
<p><a href="http://stereo.gsfc.nasa.gov/gallery/item.php?id=selects&amp;iid=154" rel="nofollow">提供NASA</a></p>
<p>どうする？</p>
<ul class="list1 list-indent1"><li>（１）逃げる</li>
<li>（２）たたかう。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>そんな低スペック装備で大丈夫か？ヤマトの諸君、いや地球人類。</li>
<li><strong>大丈夫だ。問題ない</strong></li></ul>
<p><br />
<br />
だめだこのテンプレ。</p>
<p><br />
必ず<strong>大丈夫</strong>になってしまう。</p>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_1"><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a>の続き<a class="anchor_super" id="gc0ede50" href="#gc0ede50" title="gc0ede50" style="user-select:none;">&dagger;</a></h2>
<p>現状の問題認識</p>
<ul class="list1 list-indent1"><li>libmapleでも仮想COMの実装は手抜きになっている（というかバグがあるくさい）</li></ul>
<ul class="list1 list-indent1"><li>具体的には、以下のusb関数に、受信データから(len)バイト分の要求を行った場合、</li>
<li>必ず、vcom<span class="noexists"><a href="./?cmd=edit&amp;page=BufferRx&amp;refer=2011-09">BufferRx</a></span>[]の先頭から(len)バイトをコピーして寄越すので、</li>
<li>ぜんぜんFIFOっぽくないというかバグじゃねえか？という件である。</li></ul>
<p><br /></p>
<pre>/* copies len bytes from the local recieve FIFO (not
  usb packet buffer) into recvBuf and deq's the fifo.
  will only copy the minimum of len or the available
  bytes. returns the number of bytes copied */
uint32 usbReceiveBytes(uint8* recvBuf, uint32 len) {
 if (len &gt; newBytes) {
     len = newBytes;
 }
 int i;
 for (i=0;i&lt;len;i++) {
   recvBuf[i] = (uint8)(vcomBufferRx[i]);
 }
 newBytes -= len;
 /* re-enable the rx endpoint which we had set to receive 0 bytes */
 if (newBytes == 0) {
   SetEPRxCount(VCOM_RX_ENDP,VCOM_RX_EPSIZE);
   SetEPRxStatus(VCOM_RX_ENDP,EP_RX_VALID);
 }
 return len;
}</pre>
<ul class="list1 list-indent1"><li>さて、どうすりゃいいんだ？</li></ul>
<p><br />
<br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_2">バグその２<a class="anchor_super" id="wd5ba2e0" href="#wd5ba2e0" title="wd5ba2e0" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>現状の<a href="http:/ATMEL_AVR/upload.cgi/STM/cdctool.zip" rel="nofollow">cdctool</a>は、大量のデータをホストＰＣに送れない。</li>
<li>必ず、32byteのコマンドパケットを送って、32byteの返答を貰うようにしている。</li>
<li>これを、不定長というか32byte以上のデータをまとめて送ると、何故か転送が完了せずにハングするのだ。</li>
<li>これ、仮想COMとはいえ、<strong>RS232Cだぞ</strong>。まとめて送ろうが五月雨に送ろうが、TxDはTxDのはずなのにハングするとか
何事だ。
<ul class="list2 list-indent1"><li>たぶんホスト側のバグなんだろうなぁ・・・</li></ul></li></ul>
<p>原因調査中。続く・・・。</p>
<ul class="list1 list-indent1"><li>以下次号</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_3"><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a>の続きの続き<a class="anchor_super" id="zbc42a88" href="#zbc42a88" title="zbc42a88" style="user-select:none;">&dagger;</a></h2>
<p>ごめんな、疑って。</p>
<ul class="list1 list-indent1"><li>前回bugと書いた件。</li>
<li><strong>速攻で直されてた。</strong></li></ul>
<ul class="list1 list-indent1"><li>gitから落としてみた。</li></ul>
<pre>/* copies len bytes from the local recieve FIFO (not
  usb packet buffer) into recvBuf and deq's the fifo.
  will only copy the minimum of len or the available
  bytes. returns the number of bytes copied */
uint32 usbReceiveBytes(uint8* recvBuf, uint32 len) {
 static int offset = 0;
 if (len &gt; newBytes) {
     len = newBytes;
 }
 int i;
 for (i=0;i&lt;len;i++) {
     recvBuf[i] = (uint8)(vcomBufferRx[i+offset]);
 }
 newBytes -= len;
 offset += len;
 /* re-enable the rx endpoint which we had set to receive 0 bytes */
 if (newBytes == 0) {
   SetEPRxCount(VCOM_RX_ENDP,VCOM_RX_EPSIZE);
   SetEPRxStatus(VCOM_RX_ENDP,EP_RX_VALID);
   offset = 0;
 }
 return len;
}</pre>
<ul class="list1 list-indent1"><li>変更履歴を見たいけど、オレgitの使い方わかんない・・・。スマン。</li>
<li>残念ながらmaple-ide-0.0.11-windowsxp32.zipの時点では、まだ直っていないので、IDEを使う人でここらへん
がクリティカルな人は、<strong>git経由でlibmapleを落として</strong>使うことをお勧めする次第。</li></ul>
<p><a href="https://github.com/leaflabs/libmaple" rel="nofollow">https://github.com/leaflabs/libmaple</a></p>
<p>もしくは、Linuxコンソール等で</p>
<pre>$ git clone git://github.com/leaflabs/libmaple.git
$ git clone git://github.com/leaflabs/maple-bootloader.git</pre>
<p><br />
追伸</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload.cgi/STM/libmaple.zip" rel="nofollow">libmaple</a>と<a href="http:/ATMEL_AVR/upload/STM/cdctool.zip" rel="nofollow">cdctool</a>に関しては最新のgitから落としたソースに更新済み。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<p><br />
<br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_4">バグその２：解決<a class="anchor_super" id="w65c750b" href="#w65c750b" title="w65c750b" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>不定長というか32byte以上のデータをまとめて送ると、何故か転送が完了せずにハングするのだ。
<ul class="list2 list-indent1"><li><del>たぶんホスト側のバグなんだろうなぁ・・・</del></li></ul></li>
<li>原因が判明。意外なところに盲点があった。</li>
<li>32byte以下の転送要求に対しては、データはバッファにコピーされた後、SerialUSB.write(buf,size);
される。</li>
<li>32byteを超える転送要求に対しては、（転送長が分からないので）ポインタをそのままSerialUSB.write(buf,size);
に渡している。</li></ul>
<ul class="list1 list-indent1"><li>ハングするのは32byte以上だから、ではなくて、<strong>０番地を逆アセンブル</strong>するときだ。</li>
<li>SerialUSB.write(buf,size);のbufがたまたま０番地になると、bufにNULLを渡されたと勘違いしたＣ＋＋クラス
が怒ってなにもしないで制御を返す--&gt;ホストＰＣはデータが送られずに延々と待ち続ける。<strong>がっかりだよ</strong></li></ul>
<ul class="list1 list-indent1"><li>現在、逆アセンブルを高速化するためにある程度まとまったブロックでメモリー要求しているのだけれど、０番地
のブロックだけは32byteに小分けして転送するように改良した。</li>
<li>この方法なら、０番地の内容はいったんローカルバッファにコピーされるので、引数bufにNULLを渡す恐れは無い。</li></ul>
<p><br />
<br />
<br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_5">予定稿<a class="anchor_super" id="dd3d377c" href="#dd3d377c" title="dd3d377c" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>libmapleを使って仮想COMベースのブートローダーを作る。</li></ul>
<p>ステージ１）・・・完了</p>
<ul class="list2 list-indent2"><li>libmapleのフレームワークのまま、ブートローダー（仮）のダミーモジュールを組み込んだものは、一応仮想COMデバイスとして認識に成功した。</li>
<li>ただし、まだブートローダーとしての機能はない。</li>
<li>サイズは8Kを超えている。</li>
<li>wirish/ と libraries/ は削除済み。Ｃ＋＋ソースは使用していないけれどcrt0.oやリンカスクリプトなどはＣ＋＋用をそのまま使用している。</li></ul>
<p><br />
ステージ２）・・・完了</p>
<ul class="list2 list-indent2"><li>Ｃ＋＋用のリンカスクリプトとcrt0.oを排除してみた。</li>
<li>コードは8kB未満。</li>
<li>まだブートローダーとしての機能はない。</li>
<li>USBをイネーブルするとハングする。USB用割り込みベクターの名称が異なるようだ・・・<del>修正中</del> --- USB割り込みハンドラーの関数名だけを変更したら、一応デバイス認識まで通るようになった。</li></ul>
<p><br />
ダウンロード（仮）：</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload.cgi/STM/cdcboot.zip" rel="nofollow">cdcboot.zip</a></li></ul>
<p>説明：</p>
<ul class="list1 list-indent1"><li><del>ブートローダーとしての機能はまだありません。</del> ---使えるようになりました。</li></ul>
<p><br />
ステージ３）</p>
<ul class="list1 list-indent1"><li>ブートローダーにする。</li></ul>
<p>以下<a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" title="libmapleでブートローダー" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">次号へ</a></p>
<p><br />
<br /></p>
<ul class="list1 list-indent1"><li>libmapleを使って仮想COMベースのAVR/PIC/PIC24/OpenOCDライターを作る。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_6">ちょっとだけフォントにこだわってみる。<a class="anchor_super" id="f4de184f" href="#f4de184f" title="f4de184f" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>2007年くらいまで頑張って使い続けていたWindows98を捨てて、</li>
<li>XPに移行した今も、</li>
<li>モニターコンソールだけは頑なに800x600(SVGA)を守り続けてきた。<a id="notetext_1" href="#notefoot_1" class="note_super" title="液晶モニタは1280x1024なので、800x600を拡大で映すとややボケするのが欠点だ">*1</a></li></ul>
<p><a href="http:/ATMEL_AVR/upload/STM/svga.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/upload/STM/svga.jpg" alt="http:/ATMEL_AVR/upload/STM/svga.jpg" /></a></p>
<ul class="list1 list-indent1"><li>Windowsなのに、自分のデスクトップときたら、ほぼ全画面状態のＤＯＳ窓かteratermしか起動していない。</li>
<li>昔は<strong>Vz派</strong>だったけど、ファイル名やパス名が長くなりすぎたので、Linuxのjedを改造して(Vzのかわりに)使っている。</li>
<li>フォントはPC9801のものをFixedsysに移してそのまま使っているので、まるでPC9801状態。</li>
<li>（そういうわけで、ＧＵＩが嫌いというか使ってないというか。WindowsなのにCUIのままだ）</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>しかし、800x600で何が困るって、ダイアログがはみ出してＯＫボタンを押せないことだ。（たびたびある）</li>
<li>ほかにもいろいろ困り始めたので、しかたなく8x16dotの馴染み深いフォントを捨てることにした。</li></ul>
<p>代替品はこのへん。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_7">M+IPA<a class="anchor_super" id="mb5072db" href="#mb5072db" title="mb5072db" style="user-select:none;">&dagger;</a></h4>
<p><a href="http://mix-mplus-ipa.sourceforge.jp/" rel="nofollow">http://mix-mplus-ipa.sourceforge.jp/</a></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_8">DOS窓用ConsoleFontへの追加方法<a class="anchor_super" id="r5f02f9c" href="#r5f02f9c" title="r5f02f9c" style="user-select:none;">&dagger;</a></h4>
<p><a href="http://ub.blog85.fc2.com/blog-entry-235.html" rel="nofollow">http://ub.blog85.fc2.com/blog-entry-235.html</a></p>
<ul class="list1 list-indent1"><li>なんかWindowsなのにubuntuのMonoSpaceフォントを使っている気分だ。
<ul class="list2 list-indent1"><li>だったらubuntuを使えばいいのか。そうなのか。</li></ul></li>
<li>ちょっと慣れるまで大変そうだ。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_9">今週のインストールトラブル<a class="anchor_super" id="qaf4a30f" href="#qaf4a30f" title="qaf4a30f" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>Wake-on-Lanが使えない。
<ul class="list2 list-indent1"><li>H61のとあるマザー。AMIのAptio BIOSなんだけど、WAKE ON LANの設定が無い。</li>
<li>Resume by RING(S3)とかはある。</li>
<li>Resume by KB(S3)を試してみたけれど、シャットダウンした後にKBのPOWERボタンを押しても電源は入らない。</li>
<li>というかキーボードに電気来てないから。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>試行錯誤の末、Linuxをsuspend(S3)させて、magic packetで復帰するしかない、ということが分かった。</li>
<li>Suspend To RAM(S3)はDDR3に電力供給してDRAMリフレッシュも要るので、ＡＣから測って5Wくらい消費する。</li></ul>
<p><br />
ちなみにいろいろ分かったこと。</p>
<ul class="list1 list-indent1"><li>SandyBridgeはCore2や旧世代爆熱Core-iと比べて消費電力が30W〜40W低い。アイドリングで30W程度。フルスロットルでも100Wくらい。（Core2Quadだとそれに+30W〜40Wくらい）
<ul class="list2 list-indent1"><li>2chの低消費電力スレには20W以下の猛者もいる。消費電力でもAtomは完全に要らない。用済みだ。</li></ul></li>
<li>それでいて性能が上なので、Core2にしがみつく理由が無くなった。</li>
<li>互換機電源には２種類あって、力率が100%近い部類と、せいぜい60%くらいの部類が存在。
<ul class="list2 list-indent1"><li>だったら、ＡＣに電流計入れるだけの計測では、まともに測れるやつと誤差だらけのやつがあることになる。</li></ul></li></ul>
<p>なんかＰＣの消費電力にこだわるのは昔は静音追求だったんだけど、今は原発のせいだけんね。</p>
<ul class="list1 list-indent1"><li>こまめに電源を切らなきゃならなくなったのも。</li>
<li>昔はサーバーなんて電源入れっぱなしでよかったのに。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_10">加速する「MacでARM採用」の噂、議論の存在をIntelが認める - 米報道<a class="anchor_super" id="nc9cda58" href="#nc9cda58" title="nc9cda58" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://journal.mycom.co.jp/news/2011/08/23/079/index.html" rel="nofollow">http://journal.mycom.co.jp/news/2011/08/23/079/index.html</a></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>MacのCPUは昔は68000だったし、次はPowerPCだった。</li>
<li>昔のMacOSと、今の(*bsdベースの)OSXは全く別物。</li>
<li>なので、x86の次はARMでも全然かまわない。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>そうやって変化するものだけが生き残れるとしたら、Windowsは・・・。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_11"><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">armon/armboot</a>の高速化<a class="anchor_super" id="bc5caa6c" href="#bc5caa6c" title="bc5caa6c" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>cdcboot.zipの成果を少しだけフィードバックしてみたなり。</li>
<li>armboot.exe でVerifyが特に遅いと感じる人はお試しあれ。（かなり速くなっているはず）</li>
<li>armon.exe で逆アセンブルが相当速くなった。意味があるかどうかは分からないが。</li></ul>
<ul class="list1 list-indent1"><li><a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" title="libmapleでブートローダー" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">cdcboot</a>をブートローダーとして使えるようにするのは、もう目前の状態だけど、上記改良を行ったので、HIDのままでも特に困らない。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_12"><a href="http://www3.nhk.or.jp/netradio/index.html" rel="nofollow">NHK</a>のネットラジオ<a class="anchor_super" id="i45d2b94" href="#i45d2b94" title="i45d2b94" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>ラジオなので、受信料は払わなくてよい。（テレビのほうですでに払っているが）</li></ul>
<ul class="list1 list-indent1"><li>FMのクラシック番組「ベストオブクラシック」は権利関係でネット放送できないらしい。
<ul class="list2 list-indent1"><li>そのときはどうなる？もうすぐ7:30 ---&gt;ちゃんと聞こえていますよ。いいのかな</li></ul></li></ul>
<p>利点</p>
<ul class="list1 list-indent1"><li>ラジオサーバーのようなものを用意しなくても普通にブラウザーで聞けること。
<ul class="list2 list-indent1"><li>ということは、ラジオの出力を録音するようなハードウェアを用意しなくても普通にパソコンで録音出来る（はず）なので手間が省ける。</li></ul></li>
<li>AMなのに音質が良い。（逆にFMだとすこし悪いのか）</li>
<li>本物ラジオでありがちな、パソコンなどから出るデジタルノイズを拾わないでクリアーに聞ける。</li>
<li>都市圏だったら、地下鉄やビルの谷間でも聞けるというメリットがあるかもしれない。（ただしパケ死とかするかも）</li></ul>
<p>弱点？</p>
<ul class="list1 list-indent1"><li>弱点ではないけれど・・・やっぱり作業の邪魔になる。（話番組が多いので）</li>
<li><span class="noexists"><a href="./?cmd=edit&amp;page=HappyDay&amp;refer=2011-09">HappyDay</a></span>(インターネットラジオ)を聞きながら、のほうが効率が良いので。</li></ul>
<ul class="list1 list-indent1"><li>mp3で録音とかしないで、流し聞きするだけだったら、わざわざパソコンつけるのが面倒くさい。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_13">秋月：ＬＰＣ１1Ｕ１４評価ボードＬＰＣＸｐｒｅｓｓｏＢｏａｒｄ　<a class="anchor_super" id="c7e7fec7" href="#c7e7fec7" title="c7e7fec7" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://akizukidenshi.com/catalog/g/gM-05091/" rel="nofollow">http://akizukidenshi.com/catalog/g/gM-05091/</a></li>
<li>この手の基板でターゲット側にUSBコネクタが付いているのは初めてだ。（いつもは自分でつけないと使えない）</li>
<li>2000円なので、他のXpressoより少し安い。</li>
<li>と、思ったら、他のXpressoも、すこしづつ安くなっている。(1114,1343は2000円、1769でさえ2500円)</li></ul>
<p>円高のせい？</p>
<ul class="list1 list-indent1"><li>1227とか11c24とかも2000円。</li></ul>
<ul class="list1 list-indent1"><li>11U14はクロックも低い(48MHz?)し、SRAMも少ない(6kB)。Flashも32K。</li></ul>
<ul class="list1 list-indent1"><li>あいかわらずST-Link側(LPC3154)はプロテクト掛かってるから再利用できないのが残念なんだな。
<ul class="list2 list-indent1"><li>LPC3154はスペックむちゃくちゃ高い。こんなのがおまけで付いてていいのか？</li></ul></li></ul>
<p><br />
物欲ついでに</p>
<ul class="list1 list-indent1"><li><a href="http://akizukidenshi.com/catalog/g/gM-05113/" rel="nofollow">ＸＩＬＩＮＸ　ＦＰＧＡ評価ボードＳｐａｒｔａｎ−６　ＬＸ９</a></li>
<li>ナナキュッパ。</li>
<li>すこし惹かれた。</li>
<li>DRAMが64MB乗っているので、Linuxっぽいものがぎりぎり走るかも。(<span class="noexists"><a href="./?cmd=edit&amp;page=MicroBlaze&amp;refer=2011-09">MicroBlaze</a></span>)</li>
<li>基板形状と拡張コネクタが、ちょっとだめか。</li></ul>
<p><br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_14"><a href="STBeeMini.html" title="STBeeMini" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STBee/Miniのファームを飛ばしてしまった</a><a class="anchor_super" id="d52e769e" href="#d52e769e" title="d52e769e" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>案の定</li>
<li><strong>やっちまったな</strong></li></ul>
<p>STBeeもだよ。</p>
<p>もっと読む  <a href="STBeeMini.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STBeeMini</a></p>
<ul class="list1 list-indent1"><li>失敗の理由は、ファーム自身のエリアを誤消去から守るため、エリアチェックを入れていたのだが、</li>
<li>そのstartとendが適切に設定されていなかったから。</li>
<li>ついでに言うと、Eraseだけ保護してもProgramWordを保護しなければ、結局だめなことにかわりはない。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_15"><a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleでブートローダー</a><a class="anchor_super" id="y71e48d7" href="#y71e48d7" title="y71e48d7" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>STM8S_Discovery(のSTM32側) に対して、ほぼブートローダーが<strong>完成</strong>。</li>
<li>CQ-STARM/STBee/STBeeMiniでも、ブートローダーとして使えるようになった。</li></ul>
<p>read more : <a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleでブートローダー</a></p>
<ul class="list1 list-indent1"><li>結局、手持ちのSTM32は全部cdcbootに移行してしまった。</li></ul>
<p>残念なお知らせ。</p>
<ul class="list1 list-indent1"><li>STM32の（STmicroの）サンプルソースがなぜかcdcbootで動かない。</li>
<li>armbootに戻して調べるの面倒だな。そうだ１枚だけSTM8S-Discovery基板をarmboot専用にしておこう。</li></ul>
<p>残念なお知らせ２。</p>
<ul class="list1 list-indent1"><li>STBeeのファーム復旧のために、手持ちのLPC-Xpresso(1343)にvcomサンプルを焼いて使ってみたのだけれど、
<span class="noexists"><a href="./?cmd=edit&amp;page=FlashLoader&amp;refer=2011-09">FlashLoader</a></span> Demonstratorで書き込み中、（４％くらいのところで）必ず失敗する。</li>
<li>しかたがないので携快電話に付いてきたProlificのUSB-Serialポート（を改造して電子工作用にした）ドングル経由でファームを書き換えたら問題なくうまくいった。</li>
<li>LPCのvcomサンプルはマジ馬具ッテイルのかな？</li></ul>
<p>なんかここんところ仮想COMファームのバグに当たりっぱなしだぎゃー。</p>
<p><br />
今後の予定</p>
<ul class="list1 list-indent1"><li><del>書き込みの高速化。</del> --- <strong>済み</strong>
<ul class="list2 list-indent1"><li>maple-bootloaderのコードを見たら、flash<span class="noexists"><a href="./?cmd=edit&amp;page=ProgramWord&amp;refer=2011-09">ProgramWord</a></span>()で４バイト書くごとにベリファイしてエラーコードを返しているので、このエラーをカウントして、ノーエラーだったら基本、読み出しチェックいらないのでは。</li>
<li>エラーカウントが０じゃないときだけ、普通のベリファイを実行するようにすると速度<strong>２倍お得</strong>。</li></ul></li></ul>
<ul class="list2 list-indent2"><li>ついでに、書き込みのブロックサイズを1024単位にしてみた。</li>
<li>注意: 前のバージョンから自己書き換えでupdateする場合は、0x803000番地hexを書くときだけ、</li>
<li>前のバージョンのcdcboot.exeを使用する必要があります。</li></ul>
<p>例）</p>
<pre>D:&gt; cdcboot-oldver.exe -r DISCOVERY-3000.hex
D:&gt; cdcboot.exe -B DISCOVERY-0000.hex
この後、USBケーブルを挿しなおす。</pre>
<p><br /></p>
<ul class="list1 list-indent1"><li>オレオレBitBangモードのようなもの。
<ul class="list2 list-indent1"><li>FTDIのbitbangは専用のドライバーが必要だけれど、普通に仮想COMだけでbitbangを実装してしまえば、</li>
<li>それを使うだけで、大抵のマイコンへの書き込みメソッドは事足りるようになる（はず）。</li>
<li>Flashライターのほとんどの処理はPC側の仕事になってしまうけれど面倒なライターファームを開発する必要は無くなる。</li>
<li>今はAVR用/PIC18F用/PIC24F用と、それぞれの細かい書き込み処理をファーム内でこなしているので、容量がでかくなる問題と、それ以外のマイコンの場合ファームを拡張しないと対応できない問題を抱えている。</li></ul></li></ul>
<p><br />
<br />
<br />
いろいろあったバグ：</p>
<ul class="list1 list-indent1"><li>Flash書き込みを1024バイト単位に・・・ならない。
<ul class="list2 list-indent1"><li>ファームの受け側のsize変数が何故かuchar。これpicのソースか。</li></ul></li>
<li>Flashに書くと化けまくり
<ul class="list2 list-indent1"><li>flash<span class="noexists"><a href="./?cmd=edit&amp;page=ProgramWord&amp;refer=2011-09">ProgramWord</a></span>()関数のsizeはword(4byte)単位なのに上位層のsizeは全部byte数に統一していた。</li>
<li>ある関数レベルからword単位に換算するのだけれど、その後の大小判定や分割処理をbyte数だと勘違いして実装。</li></ul></li></ul>
<p><br />
その他</p>
<ul class="list1 list-indent1"><li>なんかlibmapleの仮想COMは、一度にホストに転送できる文字数(byte数)が63くらいまでっぽい。</li>
<li>USBのパケットは64byteまで許されているのだけれど、64にするとハングする。(これはCDCの仕様を守ってないから？)</li>
<li>たぶん64バイト転送したら、次に0バイトのパケットを送るか、後続のデータを送らないとだめなんだろう。</li>
<li>libmapleでは最大32byteまでしかホストに送らない（超えたら分割送信）</li></ul>
<ul class="list1 list-indent1"><li>ホストＰＣから受信するときはこの制限は一応ない。</li>
<li>実は内部で分割転送しているから。</li>
<li>ただし、受信パケットの扱いは非効率。usb<span class="noexists"><a href="./?cmd=edit&amp;page=ReceiveBytes&amp;refer=2011-09">ReceiveBytes</a></span>()で64byteの受信バッファを全部引き取って空にするまでは、次のパケットの受信をイネーブルに出来ない。ホストＰＣからの送信はふんづまりになる。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_16"><a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleでブートローダー</a>、<a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a>を更新<a class="anchor_super" id="w158f333" href="#w158f333" title="w158f333" style="user-select:none;">&dagger;</a></h2>
<p>中身は、似たり寄ったり。C++が使えるかどうかだけの違い。</p>
<ul class="list1 list-indent1"><li><a href="libmapleE3-81-A7-E3-83-96-E3-83-BC-E3-83-88-E3-83-AD-E3-83-BC-E3-83-80-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleでブートローダー</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a></li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_17">やはりARMのWindows8ではレガシーアプリは動かず<a class="anchor_super" id="b263b20b" href="#b263b20b" title="b263b20b" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://www.geocities.jp/andosprocinfo/wadai11/20110917.htm" rel="nofollow">http://www.geocities.jp/andosprocinfo/wadai11/20110917.htm</a></li>
<li>ARMでx86アプリを動かそうと思っていた人には残念なお知らせかも。</li></ul>
<ul class="list1 list-indent1"><li>しかし、言い訳が、電池の持ちに転嫁されている。</li></ul>
<p>これは変な話だ。</p>
<ul class="list1 list-indent1"><li>MS-DOSアプリなら、大半の処理はビジーループだらけなので電力効率は悪いに決まっている。</li>
<li>しかしwin32のGUIアプリなら、ほとんどの処理はイベント駆動なので、基本的にイベントが来なければ電力を消費しないと思うんだけど、どうなんだろう。</li>
<li>マウスmoveのイベントはどかどか来るかもしれないけれど、そのたびにredrawするわけじゃない。</li></ul>
<p><br />
<br />
<br />
<br />
<br />
<br /></p>
<hr class="full_hr" />
<p><a href="20112D-10.html" title="2011-10" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">次の月へ</a></p>
<hr class="note_hr" /><a id="notefoot_1" href="#notetext_1" class="note_super">*1</a>
<span class="small">液晶モニタは1280x1024なので、800x600を拡大で映すとややボケするのが欠点だ</span><br />   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="http:/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="#">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2014-11-17 (月) 14:44:26<span class="page_passage" data-mtime="2014-11-17T14:44:26+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>convert time: 0.044 sec</li>
    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
