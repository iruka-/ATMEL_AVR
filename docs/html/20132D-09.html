<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>2013-09 - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar">
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage">ＨＩＤａｓｐ高速化</a></li>
<li><strong><a href="Newest.html" title="Newest" class="link_page_passage">開発日記</a></strong> <a href="SiteMap.html" title="SiteMap" class="link_page_passage">ログ</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2024-10-18</strong>
<ul class="recent_list">
 <li><a href="20222D-08.html" class="link_page_passage">2022-08</a></li>
</ul>
<strong>2024-10-11</strong>
<ul class="recent_list">
 <li><a href="Poem/SCMP2.html" class="link_page_passage">Poem/SCMP2</a></li>
 <li><a href="Poem/Ollama.html" class="link_page_passage">Poem/Ollama</a></li>
 <li><a href="Newest.html" class="link_page_passage">Newest</a></li>
</ul>
<strong>2024-10-10</strong>
<ul class="recent_list">
 <li><a href="Poem/GitList.html" class="link_page_passage">Poem/GitList</a></li>
 <li><a href="Poem/Win11upg.html" class="link_page_passage">Poem/Win11upg</a></li>
 <li><a href="Poem/LXCUbuntu.html" class="link_page_passage">Poem/LXCUbuntu</a></li>
 <li><a href="Poem/JavaScriptBBS.html" class="link_page_passage">Poem/JavaScriptBBS</a></li>
 <li><a href="Poem/SourceCodeViewer.html" class="link_page_passage">Poem/SourceCodeViewer</a></li>
 <li><a href="Poem/mkCert.html" class="link_page_passage">Poem/mkCert</a></li>
 <li><a href="Poem/WebPush.html" class="link_page_passage">Poem/WebPush</a></li>
</ul>
<strong>2024-07-01</strong>
<ul class="recent_list">
 <li><a href="node.jsE3-81-AE-E5-85-A5-E3-82-8C-E6-96-B9-.html" class="link_page_passage">node.jsの入れ方</a></li>
</ul>
<strong>2024-06-29</strong>
<ul class="recent_list">
 <li><a href="20242D-07.html" class="link_page_passage">2024-07</a></li>
</ul>
<strong>2024-06-21</strong>
<ul class="recent_list">
 <li><a href="SMRE3-81-AA-HDDE3-83-99-E3-83-B3-E3-83-81-E3-83-9E-E3-83-BC-E3-82-AF-.html" class="link_page_passage">SMRなHDDベンチマーク</a></li>
 <li><a href="UEFI_Basic.html" class="link_page_passage">UEFI_Basic</a></li>
</ul>
<strong>2024-06-20</strong>
<ul class="recent_list">
 <li><a href="MenuBar.html" class="link_page_passage">MenuBar</a></li>
</ul>
<strong>2022-12-06</strong>
<ul class="recent_list">
 <li><a href="MSE3-82-A2-E3-82-AB-E3-82-A6-E3-83-B3-E3-83-88-E3-81-AE-WindowsE3-81-AE-CE3-83-89-E3-83-A9-E3-82-A4-E3-83-96-E3-82-92-E4-BF-AE-E5-BE-A9-E3-81-99-E3-82-8B-.html" class="link_page_passage">MSアカウントのWindowsのCドライブを修復する</a></li>
</ul>
<strong>2022-09-29</strong>
<ul class="recent_list">
 <li><a href="AndroidE3-81-AB-SSLE8-87-AA-E5-B7-B1-E7-BD-B2-E5-90-8D-E8-A8-BC-E6-98-8E-E6-9B-B8-E3-82-92-E5-85-A5-E3-82-8C-E3-82-8B-.html" class="link_page_passage">AndroidにSSL自己署名証明書を入れる</a></li>
</ul>
<strong>2022-08-31</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E9-80-9F-E5-BA-A6-E6-B8-AC-E5-AE-9A-E3-82-B5-E3-82-A4-E3-83-88-.html" class="link_page_passage">簡易速度測定サイト</a></li>
 <li><a href="E3-83-8D-E3-83-83-E3-83-88-E3-83-AF-E3-83-BC-E3-82-AF-BOOT.html" class="link_page_passage">ネットワークBOOT</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li class="selected" id="separate"><a href="">本文</a></li><li><a href="./?cmd=edit&amp;page=2013-09">編集</a></li><li><a href="./?cmd=diff&amp;page=2013-09">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">2013-09</h1><div id="contentSub"></div>
    <p><a href="20132D-08.html" class="link_page_passage">2013-08</a>　<a href="FM3.html" class="link_page_passage">FM3</a>　<a href="RX62N.html" class="link_page_passage">RX62N</a>　<a href="SH2A.html" class="link_page_passage">SH2A</a>　<a href="PIC32MX.html" class="link_page_passage">PIC32MX</a></p>
<hr class="full_hr" />
<h2 id="content_1_0">９月<a class="anchor_super" id="n9e71c85" href="#n9e71c85" title="n9e71c85" style="user-select:none;">&dagger;</a></h2>
<p>PIC32MX: SPIは叩けるようになった。</p>
<ul class="list1 list-indent1"><li>Pinguinoの割り込み系関数はmx220だと微妙にずれていて動かない</li>
<li>（ので、ライブラリを手でコピペして、MCHIPのPDF見ながらいろいろ番号を書き換える必要がある）<strong>面倒ぃ</strong></li></ul>
<p><br /></p>
<p>1bit DACは作れなかった。</p>
<ul class="list1 list-indent1"><li>（一応、正弦波もどきは出せたけど・・・たぶん全部事前計算にすればDDSっぽいものなら作れるけど、なんかべつにPWMとそんな変わらん感じでボツ感漂う）</li></ul>
<p><br />
PIC32MXでVGA出力</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/jpg/pic32vga.jpg" rel="nofollow"><img src="/ATMEL_AVR/jpg/pic32vga.jpg" alt="/ATMEL_AVR/jpg/pic32vga.jpg" /></a></li>
<li>とりあえずだらだらと続けている。</li>
<li>目標は、TTL爺さんよりは先に完成させたい。</li></ul>

<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_1"><a href="PIC32MX.html" class="link_page_passage">PIC32MX</a>: HIDBoot.Xを地道に改良。<a class="anchor_super" id="md61762e" href="#md61762e" title="md61762e" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>crt0.Sに .weakな例外ベクターのjmpテーブルを作成。（実際には例外は使ってないので他プロジェクトで活用するためのもの）</li>
<li>コードサイズを1K弱縮めてみた。</li>
<li>__IntVectorTable[]とか__IntSrcTable[]という大ボスがまだ残っている。</li>
<li>HIDBoot.Xでは、実際のところ例外（割り込み）を使用しないので、INT***()関数を追放するか、最小機能のものに置き換えることが出来れば、さらに2kBは縮むはずだ。</li>
<li>あと、一般例外(general_exception_vector)とブート例外(boot_exception)も、どうせ使ってない（NOPが置かれて放置されているだけ）ので、これらも外して、BOOT-ROMを全部フラットで使っちゃうとかすれば、下手すると常駐4kB FLASH(+3kB BOOT)に収まるかも。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_2"><a href="PIC32MX.html" class="link_page_passage">PIC32MX</a>: HIDBoot.Xをさらに改良<a class="anchor_super" id="oe9fdc58" href="#oe9fdc58" title="oe9fdc58" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>__IntVectorTable[]とか__IntSrcTable[]は、無くてもなんとかなるっぽい。（INTClearFlag()がダミー関数になるけど）</li>
<li>消してみたら、FLASH使用量は5kB強になった。</li>
<li>あと1kBなんだけど、BOOT-ROMのほうには512byteは空きがあるので、結局のところ<strong>4kBに収める射程内</strong>に入ってしまった。</li></ul>
<p><strong>ああどうしよう。縮めちゃうよ。</strong></p>
<ul class="list1 list-indent1"><li>なんかSPIを動かすという目標はぜんぜんつまんなくて、ROM4kBに収めることのほうが<strong>俄然面白い。</strong> 病気か？</li></ul>
<ul class="list1 list-indent1"><li>作りかけだけど、<strong>ダウンロード:</strong><a href="/ATMEL_AVR/upload/PIC/HIDBoot.Y.zip" rel="nofollow">HIDBoot.Y.zip</a></li>
<li><del>600バイトくらい足が出ている。</del> --- 今は逆に<strong>256byte以上余っている不思議</strong>。気づいたらそうなっていた。俺どうかしてる。</li></ul>
<ul class="list1 list-indent1"><li><del>このまま行くと、全部mips16アセンブラで書きそうで怖い自分。</del> --- その必要は無かった。crt0.S以外は全部Ｃでっせ。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_3">次の予定<a class="anchor_super" id="ee265c5a" href="#ee265c5a" title="ee265c5a" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>せっかくFLASHが256以上空いたので、PIC32MXのPinの電位状態を一括モニタリングするpollコマンドを仕込んで、グラフィカル表示＆マウスでＬチカというのをやってみる（予定</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_4">PIC32MXでVGA出力<a class="anchor_super" id="m1d3c68c" href="#m1d3c68c" title="m1d3c68c" style="user-select:none;">&dagger;</a></h2>
<p>なんと、</p>
<ul class="list1 list-indent1"><li>DMAでSPI2 out出来るようになった。(20Mbps)</li>
<li>HSYNCはTimer1割り込みでタイミングを取っている。</li>
<li>HSYNC割り込みでDMAを起動させている。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/jpg/vgatest1.jpg" rel="nofollow"><img src="/ATMEL_AVR/jpg/vgatest1.jpg" alt="/ATMEL_AVR/jpg/vgatest1.jpg" /></a></li></ul>
<p>しかし、ジッターがひどくて画質的に実用性がない。</p>
<ul class="list1 list-indent1"><li>というか液晶モニターがなかなか同期とってくれないって、どうよ？</li>
<li>一応640x480 31kHz (60Hz) VGA
<br />
原因究明中だけど、迷宮入りかも。</li>
<li>測定器欲しい。</li></ul>
<p><br />
今疑っているところ</p>
<ul class="list1 list-indent1"><li>水晶まわりの配線</li>
<li>電源周りのパスコン</li>
<li>水晶そのもの(12MHz)</li>
<li>水晶に繋ぐ負荷コンデンサ（付けてない）</li>
<li>各種SFRの設定値。(Tmr1割り込みとか割り込みとか・・・)</li>
<li>そして、MicroChip本社。（エラッタのこと）</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_5">PIC32MXでVGA出力：原因究明中<a class="anchor_super" id="bb13078c" href="#bb13078c" title="bb13078c" style="user-select:none;">&dagger;</a></h2>
<p>電源周りのパスコン</p>
<ul class="list1 list-indent1"><li>なんと、入れてなかった。</li>
<li>３端子の出力側の付け根に33uFの電解コンを一つ入れてた。</li>
<li>AVdd-AVss間には0.1uF積セラが入ってる。</li>
<li>PIC32MX内部電圧(2V?)のVcap-Vss間には10uF積セラが入ってる。</li>
<li>肝心の3.3V Vdd-Vss間には<strong>何も入れてなかった。</strong>（つまり、遠くに電解コン33uFがあるだけ状態）</li></ul>
<p><br />
3.3V Vdd-Vss間の一番近い位置に0.1uF積セラを入れてみた。</p>
<ul class="list1 list-indent1"><li>けれど、直る気配なし。
<br /></li>
<li>もしやと思って、WindowsPCからUSB給電するのをやめて、安物のUSB充電アダプタから電源を取るようにしたら
酷いジッターは直った。</li></ul>
<p><strong>原因はＰＣかよ。</strong></p>
<p><br /></p>
<p><br /></p>
<ul class="list1 list-indent1"><li>ただ、1ドット弱程度のジッタがある程度規則的に横方向に入る。</li>
<li>それと、液晶モニターなのにときどき画像が乱れたり消える。</li></ul>
<p>変だなー。</p>
<p><br /></p>
<p>その後：</p>
<ul class="list1 list-indent1"><li>あ、違った。usb_config.h 見たらPOLLINGじゃなくてINTERRUPTでUSB動かしてた。</li>
<li>POLLINGにしたら、画面が全然出なくなったので、割り込みの初期設定をそもそもしていないっぽいというのが諸悪の根源だったらしい。</li>
<li><strong>直さなきゃ。</strong></li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_6">PIC32MXでVGA出力：文字が出たっ<a class="anchor_super" id="bb13078c" href="#bb13078c" title="bb13078c" style="user-select:none;">&dagger;</a></h2>
<p>ここで、はまりポイントを解説</p>
<ul class="list1 list-indent1"><li>１） RB15のLED点滅は、SPI2をOnにした瞬間に使えない。
<ul class="list2 list-indent1"><li>理由は、どうやらSPI2のSCKはRB15ピンに固定割り当てされている感じ。</li>
<li>これが原因で、LEDが点かない＝ハング、とずっと勘違いしてた。</li></ul></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>２） usb_config.h で USB_INTEERUPTからUSB_POLLINGに変更したら死ぬ。
<ul class="list2 list-indent1"><li>この理由は、USB側での割り込み初期化が期待できなくなるから。
<pre>	INTEnableSystemMultiVectoredInt();
	INTEnableInterrupts();</pre></li>
<li>これを入れて解決。最初は asm(&quot;ei&quot;);を入れていたがハングするばかり。</li>
<li>crt0.Sを見た限りでは、INTEnableSystemMultiVectoredInt();等価の処理は書かれている。まさかシングルベクターなわけはない（はず）。</li></ul></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>３） USB_POLLINGでもジッターは出る。
<ul class="list2 list-indent1"><li>USBを使うのを諦めて、main()側を
<pre> while(1) {
      asm(&quot;wait&quot;);
 }</pre></li>
<li>とか
<pre> while(1) {
      asm(&quot;nop&quot;);
 }</pre></li>
<li>にすると直った。</li></ul></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>あと、DOT CLOCKがちょっと低めなので、クロック上げて、ソースを整理したい。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_7">PIC32MXでVGA出力：ここまで出来た。<a class="anchor_super" id="ob329619" href="#ob329619" title="ob329619" style="user-select:none;">&dagger;</a></h2>
<p>結局、640x480のドットクロック25.175MHzを出すことが出来なかった。</p>
<ul class="list1 list-indent1"><li>ドットクロック20MHzだと、縦のラインがぼやける</li>
<li>ドットクロック24MHzだと、２，３文字に１文字の割合で特定の縦ラインのドットが２倍になって文字が歪む。見栄えが悪い。
<ul class="list2 list-indent1"><li>たぶんブラウン管ならドットのサンプリングをしないので全然平気だとは思う。でも<strong>２１世紀にブラウン管はありえない</strong></li></ul></li>
<li>CPUを50.35MHzで動作させれば可能。</li>
<li>そのためには、4.1958MHzか、その整数倍（５倍まで）の水晶が必要。</li></ul>
<ul class="list1 list-indent1"><li>・・・</li>
<li>諦めて、800x600 SVGA @60Hz （ドットクロックは40MHz）を使うことにした。</li>
<li><a href="/ATMEL_AVR/jpg/vgatest2.jpg" rel="nofollow"><img src="/ATMEL_AVR/jpg/vgatest2.jpg" alt="/ATMEL_AVR/jpg/vgatest2.jpg" /></a></li>
<li>もちろん、40MHzのドットクロックは出せない（？要検証）ので、20MHzにして横倍フォント（実質400dot)
ということにしてみた。</li></ul>
<ul class="list1 list-indent1"><li>HSYNCから、ドットクロック（文字）出力までが妙に間延びしているのは、DMA Kickのルーチンが思った以上に長いから。</li>
<li>Ｃソース上ではさほど長くないのだが、SVGAでは1dot=40MHzなので、100クロック掛かれば100dot空くわけで・・・。</li>
<li>実際そのくらい。</li>
<li>あらかじめセットアップする量を増やすとか、全部アセンブラで縦書き（つまり関数は絶対呼ばない）とかすればましに
なるのかも。</li></ul>
<ul class="list1 list-indent1"><li>Tmr1Interrupt()関数で、MIPS32コード見たら絶望した。MIPSって、こんなに割り込み応答に時間が掛かるのか。</li></ul>
<ul class="list1 list-indent1"><li><pre>9d00331c &lt;_Tmr1Interrupt&gt;:
9d00331c:	401a6800 	mfc0	k0,c0_cause
9d003320:	401b7000 	mfc0	k1,c0_epc
9d003324:	27bdff90 	addiu	sp,sp,-112
9d003328:	afbb006c 	sw	k1,108(sp)
9d00332c:	401b6000 	mfc0	k1,c0_status
9d003330:	001ad282 	srl	k0,k0,0xa
9d003334:	afbb0068 	sw	k1,104(sp)
9d003338:	7f5b7a84 	ins	k1,k0,0xa,0x6
9d00333c:	0000d012 	mflo	k0
9d003340:	7c1b2044 	ins	k1,zero,0x1,0x4
9d003344:	afba0064 	sw	k0,100(sp)
9d003348:	0000d010 	mfhi	k0
9d00334c:	afba0060 	sw	k0,96(sp)
9d003350:	409b6000 	mtc0	k1,c0_status
9d003354:	afa20018 	sw	v0,24(sp)
9d003358:	3c02bf88 	lui	v0,0xbf88
9d00335c:	afbf005c 	sw	ra,92(sp)
9d003360:	8c421030 	lw	v0,4144(v0)
9d003364:	afb90058 	sw	t9,88(sp)
9d003368:	30420010 	andi	v0,v0,0x10
9d00336c:	afb80054 	sw	t8,84(sp)
9d003370:	afb00050 	sw	s0,80(sp)
9d003374:	afaf004c 	sw	t7,76(sp)
9d003378:	afae0048 	sw	t6,72(sp)
9d00337c:	afad0044 	sw	t5,68(sp)
9d003380:	afac0040 	sw	t4,64(sp)
9d003384:	afab003c 	sw	t3,60(sp)
9d003388:	afaa0038 	sw	t2,56(sp)
9d00338c:	afa90034 	sw	t1,52(sp)
9d003390:	afa80030 	sw	t0,48(sp)
9d003394:	afa7002c 	sw	a3,44(sp)
9d003398:	afa60028 	sw	a2,40(sp)
9d00339c:	afa50024 	sw	a1,36(sp)
9d0033a0:	afa40020 	sw	a0,32(sp)
9d0033a4:	afa3001c 	sw	v1,28(sp)
9d0033a8:	10400012 	beqz	v0,9d0033f4 &lt;_Tmr1Interrupt+0xd8&gt;
9d0033ac:	afa10014 	sw	at,20(sp)
9d0033b0:	3c02bf88 	lui	v0,0xbf88
9d0033b4:	24030010 	li	v1,16
9d0033b8:	ac431034 	sw	v1,4148(v0)
9d0033bc:	3c02bf88 	lui	v0,0xbf88
9d0033c0:	24100001 	li	s0,1
9d0033c4:	24040018 	li	a0,24
9d0033c8:	ac506138 	sw	s0,24888(v0)
9d0033cc:	77400c67 	jalx	9d00319c &lt;wait_125ns&gt;
9d0033d0:	00000000 	nop
9d0033d4:	3c02bf88 	lui	v0,0xbf88
9d0033d8:	ac506134 	sw	s0,24884(v0)
9d0033dc:	77400cac 	jalx	9d0032b0 &lt;gen_VSYNC&gt;
9d0033e0:	00000000 	nop
9d0033e4:	3c02a000 	lui	v0,0xa000
9d0033e8:	8c43010c 	lw	v1,268(v0)
9d0033ec:	24630001 	addiu	v1,v1,1
9d0033f0:	ac43010c 	sw	v1,268(v0)
9d0033f4:	41606000 	di
9d0033f8:	000000c0 	ehb
9d0033fc:	8fba0064 	lw	k0,100(sp)
9d003400:	8fbf005c 	lw	ra,92(sp)
9d003404:	03400013 	mtlo	k0
9d003408:	8fba0060 	lw	k0,96(sp)
9d00340c:	8fb90058 	lw	t9,88(sp)
9d003410:	03400011 	mthi	k0
9d003414:	8fb80054 	lw	t8,84(sp)
9d003418:	8fb00050 	lw	s0,80(sp)
9d00341c:	8faf004c 	lw	t7,76(sp)
9d003420:	8fae0048 	lw	t6,72(sp)
9d003424:	8fad0044 	lw	t5,68(sp)
9d003428:	8fac0040 	lw	t4,64(sp)
9d00342c:	8fab003c 	lw	t3,60(sp)
9d003430:	8faa0038 	lw	t2,56(sp)
9d003434:	8fa90034 	lw	t1,52(sp)
9d003438:	8fa80030 	lw	t0,48(sp)
9d00343c:	8fa7002c 	lw	a3,44(sp)
9d003440:	8fa60028 	lw	a2,40(sp)
9d003444:	8fa50024 	lw	a1,36(sp)
9d003448:	8fa40020 	lw	a0,32(sp)
9d00344c:	8fa3001c 	lw	v1,28(sp)
9d003450:	8fa20018 	lw	v0,24(sp)
9d003454:	8fa10014 	lw	at,20(sp)
9d003458:	8fba006c 	lw	k0,108(sp)
9d00345c:	409a7000 	mtc0	k0,c0_epc
9d003460:	8fba0068 	lw	k0,104(sp)
9d003464:	27bd0070 	addiu	sp,sp,112
9d003468:	409a6000 	mtc0	k0,c0_status
9d00346c:	42000018 	eret</pre></li></ul>
<ul class="list1 list-indent1"><li>案の定、$k0,$k1は壊したまま放置している。</li>
<li>乗算の結果レジスタも退避が必要らしい。</li>
<li>こうしてみると、ARMって、コンテキストスイッチ軽いなぁ。(NEON/vfpを除く)</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>↓VGA/SVGAの両方に対応させてみました。</li></ul>
<p>もっと読む: <a href="pic32vga.html" title="pic32vga" class="link_page_passage">PIC32MXでVGA出力をやってみる</a>
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_8">TinyBasic2 for RasPi<a class="anchor_super" id="ka44eb40" href="#ka44eb40" title="ka44eb40" style="user-select:none;">&dagger;</a></h2>
<p>これ：</p>
<ul class="list1 list-indent1"><li><a href="http://www.staff.city.ac.uk/afl/tinybasic/downloads.html" rel="nofollow">http://www.staff.city.ac.uk/afl/tinybasic/downloads.html</a></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>SDLやtermioを使わないようにコンパイルしてみた。</li>
<li>MinGW32でstripしてexeのサイズが63kB</li>
<li>こりゃPIC32MXに入れるのは無理？</li></ul>
<p><br /></p>
<p><strong>そんなことは無かった。</strong></p>
<ul class="list1 list-indent1"><li>もっと読む: <a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage">PIC32MXでBASICを動かす</a></li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_9">PICとAndroidとUSB接続する Microbridge<a class="anchor_super" id="r9ac2aa1" href="#r9ac2aa1" title="r9ac2aa1" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://projectc3.seesaa.net/article/219854646.html" rel="nofollow">http://projectc3.seesaa.net/article/219854646.html</a></li></ul>
<ul class="list1 list-indent1"><li><a href="http://code.google.com/p/microbridge-pic/" rel="nofollow">http://code.google.com/p/microbridge-pic/</a></li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>またなんかやばそうなものを見つけてきた。</li>
<li>そうそう、アンドロイドのUSB端子から、ADB(debugger)接続するプロトコル
をPICに喋らせたら、端末をハックし放題（デバッグし放題、とも言う）だよねー、って昔言ってたやつをほんとに実行してる人がいたわけ。</li></ul>
<p>これから読む。・・・</p>
<p><br />
<br />
<br />
<a href="20132D-08.html" title="2013-08" class="link_page_passage">＜前の月</a>｜<a href="20132D-10.html" title="2013-10" class="link_page_passage">次の月＞</a></p>
   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="http://">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2014-11-17 (月) 14:44:26<span class="page_passage" data-mtime="2014-11-17T14:44:26+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
