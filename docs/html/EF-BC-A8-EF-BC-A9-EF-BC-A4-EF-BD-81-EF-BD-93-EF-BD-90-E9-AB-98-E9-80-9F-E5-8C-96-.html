<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>ＨＩＤａｓｐ高速化 - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar"><ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage" data-mtime="2022-08-01T10:35:15+09:00">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage" data-mtime="2013-04-29T09:29:29+09:00">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage" data-mtime="2014-12-01T23:50:24+09:00">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage" data-mtime="2012-09-12T22:43:19+09:00">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage" data-mtime="2011-11-25T22:47:41+09:00">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage" data-mtime="2011-11-27T16:31:48+09:00">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage" data-mtime="2015-05-02T16:17:40+09:00">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage" data-mtime="2014-09-27T22:53:38+09:00">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage" data-mtime="2014-11-20T22:01:19+09:00">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage" data-mtime="2015-02-01T14:32:31+09:00">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage" data-mtime="2013-05-10T22:28:35+09:00">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage" data-mtime="2009-09-25T17:26:22+09:00">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage" data-mtime="2009-04-16T22:42:14+09:00">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage" data-mtime="2010-02-17T16:23:41+09:00">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage" data-mtime="2009-05-06T01:05:20+09:00">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage" data-mtime="2010-04-28T09:27:01+09:00">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage" data-mtime="2014-06-22T14:58:37+09:00">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage" data-mtime="2015-01-22T18:20:53+09:00">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage" data-mtime="2012-12-06T13:25:35+09:00">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage" data-mtime="2008-10-13T03:47:40+09:00">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage" data-mtime="2010-11-02T22:35:53+09:00">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage" data-mtime="2008-05-17T00:51:37+09:00">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage" data-mtime="2007-08-28T23:52:40+09:00">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2022-08-01</strong>
<ul class="recent_list">
 <li><a href="20222D-08.html" class="link_page_passage" data-mtime="2022-08-01T10:46:25+09:00">2022-08</a></li>
 <li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:34+09:00">ＨＩＤａｓｐ</a></li>
 <li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
 <li><a href="AVRetc.html" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">AVRetc</a></li>
 <li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
 <li><a href="20082D-08.html" class="link_page_passage" data-mtime="2022-08-01T10:37:50+09:00">2008-08</a></li>
 <li><a href="http:/ATMEL_AVR/html/" class="link_page_passage" data-mtime="2022-08-01T10:35:15+09:00">FrontPage</a></li>
</ul>
<strong>2022-07-31</strong>
<ul class="recent_list">
 <li><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">ＷｉｄｅＴｅｘｔ</a></li>
 <li><a href="RecentDeleted.html" class="link_page_passage" data-mtime="2022-07-31T15:25:08+09:00">RecentDeleted</a></li>
 <li><a href="SiteMap.html" class="link_page_passage" data-mtime="2022-07-31T15:21:46+09:00">SiteMap</a></li>
</ul>
<strong>2022-07-25</strong>
<ul class="recent_list">
 <li><a href="20082D-10.html" class="link_page_passage" data-mtime="2022-07-25T22:19:24+09:00">2008-10</a></li>
 <li>ＨＩＤａｓｐ高速化</li>
 <li><a href="H8EF-BC-8F-3048F.html" class="link_page_passage" data-mtime="2022-07-25T21:46:43+09:00">H8／3048F</a></li>
 <li><a href="AutoTicketLinkName.html" class="link_page_passage" data-mtime="2022-07-25T16:51:44+09:00">AutoTicketLinkName</a></li>
</ul>
<strong>2021-12-11</strong>
<ul class="recent_list">
 <li><a href="FormattingRules.html" class="link_page_passage" data-mtime="2021-12-11T00:40:03+09:00">FormattingRules</a></li>
</ul>
<strong>2020-02-23</strong>
<ul class="recent_list">
 <li><a href="WikiWikiWeb.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">WikiWikiWeb</a></li>
 <li><a href="YukiWiki.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">YukiWiki</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li id="wn_main" class="selected"><a href="" title="ＨＩＤａｓｐ高速化" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">本文</a></li><li id="wn_note"><span class="noexists"><a href="./?cmd=edit&amp;page=note%2F%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">ノート</a></span></li><li><a href="./?cmd=edit&amp;page=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">編集</a></li><li><a href="./?cmd=diff&amp;page=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">ＨＩＤａｓｐ高速化</h1><div id="contentSub"></div>
    
<p>Ｆｒｏｍ：<a href="20082D-09.html" class="link_page_passage" data-mtime="2008-09-27T11:00:55+09:00">2008-09</a></p>
<p>Ｆｒｏｍ：<a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:34+09:00">ＨＩＤａｓｐ</a></p>
<p><strong>このページは、瓶詰堂さんのＨＩＤａｓｐで実装されているＨＩＤ　Ｒｅｐｏｒｔの転送速度向上について考察したものです</strong></p>
<ul class="list1 list-indent1"><li>時間軸が逆になっていて、上の情報のほうが新しいです。</li></ul>
<ul class="list1 list-indent1"><li>最新版アーカイブと、制作に関する説明は、<a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:34+09:00">ＨＩＤａｓｐ</a>のページをご覧ください。</li></ul>
<hr class="full_hr" />
<h2 id="content_1_0">ＨＩＤａｓｐ速度比較<a class="anchor_super" id="x38a5e09" href="#x38a5e09" title="x38a5e09" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-80-9F-E5-BA-A6-E6-AF-94-E8-BC-83-.html" class="link_page_passage" data-mtime="2008-09-28T21:00:45+09:00">ＨＩＤａｓｐ速度比較</a>のページをご覧ください。</li></ul>
<div class="contents">
<a id="contents_1"></a>
<ul class="list1 list-indent1"><li><a href="#x38a5e09">ＨＩＤａｓｐ速度比較</a></li>
<li><a href="#x7c77c66">AVRUSB FLOW_CONTROLの追加</a></li>
<li><a href="#c2b871b8">ＨＩＤ　Ｒｅｐｏｒｔ送信の遅延評価</a></li>
<li><a href="#kd61a76d">ファームウェアの容量削減</a></li>
<li><a href="#z551790c">ＳＣＫ、ＭＯＳＩのＨｉ−Ｚ化改良</a></li>
<li><a href="#p7941a5a">高速化改良その６</a></li>
<li><a href="#cf9dee00">高速化改良その５</a></li>
<li><a href="#pb2d0ff9">高速化改良その４</a></li>
<li><a href="#baa8c2ec">ＡＶＲｂｅｎｃｈ</a></li>
<li><a href="#ke5da781">高速化改良その３</a></li>
<li><a href="#ybae0820">高速化改良（案のみ）</a></li>
<li><a href="#ke5da781">高速化改良その２</a>
<ul class="list2 list-indent1"><li><a href="#b82fcd7c">６ＫＢ書き込み＆ベリファイ時間計測</a></li></ul></li>
<li><a href="#vf296265">高速化改良その１</a></li>
<li><a href="#l2b87bfc">HIDasp高速化完了</a></li>
<li><a href="#g58ea4f9">考察</a></li>
<li><a href="#f285f099">落穂拾い</a></li>
<li><a href="#ab6a2305">HIDasp高速化検討中</a></li></ul>
</div>

<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_1">AVRUSB FLOW_CONTROLの追加<a class="anchor_super" id="x7c77c66" href="#x7c77c66" title="x7c77c66" style="user-select:none;">&dagger;</a></h2>
<p>AMDマザーで計測.(SiSではこれより遅いです.)</p>
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">read</td><td class="style_td">1.453 sec (5.637kB/s)</td></tr>
<tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">write &amp; verify</td><td class="style_td">3.157 sec (2.594kB/s)</td></tr>
</tbody></table></div>
<pre>bash-3.2$ time ./hidspx.exe -ph -d0 8kB.hex
Detected device is ATmega88.
Erase Flash memory.
Write   Flash: 8192/8192 B
Verify  Flash: 8192/8192 B
Passed.

real    0m3.157s
user    0m0.015s
sys     0m0.015s</pre>
<pre>bash-3.2$ time ./hidspx.exe -ph -d0 -rp &gt;rom.hex
Detected device is ATmega88.
Read    Flash: 8192/8192 B
Passed.

real    0m1.453s
user    0m0.047s
sys     0m0.000s</pre>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_2">ＨＩＤ　Ｒｅｐｏｒｔ送信の遅延評価<a class="anchor_super" id="c2b871b8" href="#c2b871b8" title="c2b871b8" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>HID Reportのパケットを受け取った後、isp書き込み時間がどの程度許されるのかを評価してみた。</li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidmon-test-1007.zip" rel="nofollow">ソースアーカイブ：hidmon-test-1007.zip</a></li></ul>
<ul class="list1 list-indent1"><li>結果</li>
<li>bench2コマンドは第一引数が試行回数、第二引数が遅延係数（単位は１０μ秒）</li>
<li>ＨＩＤパケットサイズは３９バイト固定。送信（ホストからデバイス宛）のみ。</li>
<li>Low Speed USBパケットを８バイト受け取る毎に待ちループを呼び出している。</li></ul>
<pre>X:UHCI(intel i815e)&gt;hidmon -i script
AVR&gt; bench2 100 1
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 2
hid delay write start
hid delay write end, 3900 bytes/791 ms,  4930 bytes/s
AVR&gt; bench2 100 3
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 4
hid delay write start
hid delay write end, 3900 bytes/811 ms,  4808 bytes/s
AVR&gt; bench2 100 5
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 6
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 7
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 8
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 9
hid delay write start
hid delay write end, 3900 bytes/791 ms,  4930 bytes/s
AVR&gt; bench2 100 10
hid delay write start
hid delay write end, 3900 bytes/802 ms,  4862 bytes/s
AVR&gt; bench2 100 20
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 30
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 40
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 50
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 60
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 70
hid delay write start
hid delay write end, 3900 bytes/802 ms,  4862 bytes/s
AVR&gt; bench2 100 80
hid delay write start
hid delay write end, 3900 bytes/801 ms,  4868 bytes/s
AVR&gt; bench2 100 90
hid delay write start
hid delay write end, 3900 bytes/1302 ms,  2995 bytes/s
AVR&gt; bench2 100 110
hid delay write start
hid delay write end, 3900 bytes/1302 ms,  2995 bytes/s
AVR&gt; bench2 100 120
hid delay write start
hid delay write end, 3900 bytes/1301 ms,  2997 bytes/s
AVR&gt; bench2 100 130
hid delay write start
hid delay write end, 3900 bytes/1301 ms,  2997 bytes/s
AVR&gt; bench2 100 140
hid delay write start
hid delay write end, 3900 bytes/1302 ms,  2995 bytes/s
AVR&gt; bench2 100 150
hid delay write start
hid delay write end, 3900 bytes/1292 ms,  3018 bytes/s
AVR&gt; bench2 100 160
hid delay write start
hid delay write end, 3900 bytes/1402 ms,  2781 bytes/s
AVR&gt; bench2 100 170
hid delay write start
hid delay write end, 3900 bytes/1803 ms,  2163 bytes/s
AVR&gt; bench2 100 180
hid delay write start
hid delay write end, 3900 bytes/1792 ms,  2176 bytes/s
AVR&gt; bench2 100 190
hid delay write start
hid delay write end, 3900 bytes/1803 ms,  2163 bytes/s
AVR&gt; q
Bye.</pre>
<pre>X:OHCI(SiS M671T)&gt;hidmon -i script
AVR&gt; bench2 100 1
hid delay write start
hid delay write end, 3900 bytes/203 ms,  19211 bytes/s
AVR&gt; bench2 100 2
hid delay write start
hid delay write end, 3900 bytes/297 ms,  13131 bytes/s
AVR&gt; bench2 100 3
hid delay write start
hid delay write end, 3900 bytes/296 ms,  13175 bytes/s
AVR&gt; bench2 100 4
hid delay write start
hid delay write end, 3900 bytes/329 ms,  11854 bytes/s
AVR&gt; bench2 100 5
hid delay write start
hid delay write end, 3900 bytes/391 ms,  9974 bytes/s
AVR&gt; bench2 100 6
hid delay write start
hid delay write end, 3900 bytes/406 ms,  9605 bytes/s
AVR&gt; bench2 100 7
hid delay write start
hid delay write end, 3900 bytes/453 ms,  8609 bytes/s
AVR&gt; bench2 100 8
hid delay write start
hid delay write end, 3900 bytes/485 ms,  8041 bytes/s
AVR&gt; bench2 100 9
hid delay write start
hid delay write end, 3900 bytes/500 ms,  7800 bytes/s
AVR&gt; bench2 100 10
hid delay write start
hid delay write end, 3900 bytes/500 ms,  7800 bytes/s
AVR&gt; bench2 100 20
hid delay write start
hid delay write end, 3900 bytes/797 ms,  4893 bytes/s
AVR&gt; bench2 100 30
hid delay write start
hid delay write end, 3900 bytes/1188 ms,  3282 bytes/s
AVR&gt; bench2 100 40
hid delay write start
hid delay write end, 3900 bytes/1563 ms,  2495 bytes/s
AVR&gt; bench2 100 50
hid delay write start
hid delay write end, 3900 bytes/1828 ms,  2133 bytes/s
AVR&gt; bench2 100 60
hid delay write start
hid delay write end, 3900 bytes/2203 ms,  1770 bytes/s
AVR&gt; bench2 100 70
hid delay write start
hid delay write end, 3900 bytes/2515 ms,  1550 bytes/s
AVR&gt; bench2 100 80
hid delay write start
hid delay write end, 3900 bytes/2844 ms,  1371 bytes/s
AVR&gt; bench2 100 90
hid delay write start
hid delay write end, 3900 bytes/3203 ms,  1217 bytes/s
AVR&gt; bench2 100 110
hid delay write start
hid delay write end, 3900 bytes/3875 ms,  1006 bytes/s
AVR&gt; bench2 100 120
hid delay write start
hid delay write end, 3900 bytes/4172 ms,  934 bytes/s
AVR&gt; bench2 100 130
hid delay write start
hid delay write end, 3900 bytes/4500 ms,  866 bytes/s
AVR&gt; bench2 100 140
hid delay write start
hid delay write end, 3900 bytes/4796 ms,  813 bytes/s
AVR&gt; bench2 100 150
hid delay write start
hid delay write end, 3900 bytes/5188 ms,  751 bytes/s
AVR&gt; bench2 100 160
hid delay write start
hid delay write end, 3900 bytes/5562 ms,  701 bytes/s
AVR&gt; bench2 100 170
hid delay write start
hid delay write end, 3900 bytes/5828 ms,  669 bytes/s
AVR&gt; bench2 100 180
hid delay write start
hid delay write end, 3900 bytes/6188 ms,  630 bytes/s
AVR&gt; bench2 100 190
hid delay write start
hid delay write end, 3900 bytes/6531 ms,  597 bytes/s
AVR&gt; q
Bye.
    </pre>
<ul class="list1 list-indent1"><li>結果、なんと<strong>ＵＨＣＩでは１パケット毎に直後８００μ秒のＩＳＰコマンド処理時間があったとしても、コンスタントに４.８ｋＢ/秒の転送速度を保っている！</strong></li>
<li>つまり、ＨＩＤでもインターリーブの効果はあるということだ。</li>
<li>逆に、ＯＨＣＩでは８００μ秒のＩＳＰコマンド処理時間があった場合、１.３ｋＢ/秒にまで転送速度が落ちている。</li>
<li>これは謎だ。</li></ul>
<p>ちなみに '-d3'オプションを指定した場合のSCLKは３７５ｋＨｚなので、</p>
<ul class="list1 list-indent1"><li>８ビットのＳＰＩを送るのに必要な時間は２１.３３μ秒。</li>
<li>８バイトのファームウェアをページバッファにセットアップする時間はその３２倍の６８３μ秒あれば良い。
<ul class="list2 list-indent1"><li>（ＳＰＩコマンドは常に４バイト単位になっていて、１コマンドで正味データ１バイト分しか転送できない）</li></ul></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_3">ファームウェアの容量削減<a class="anchor_super" id="kd61a76d" href="#kd61a76d" title="kd61a76d" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>senshuさんにより取り纏め頂いたhidspx-0928b.zipに対して、firmware容量の削減を
行いました。</li>
<li>機能やコンフィギュレーションは同一です。</li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidspx-0928c.zip" rel="nofollow">ソースアーカイブ：hidspx-0928c.zip</a></li></ul>
<pre>avr-objcopy -j .text -j .data -O ihex main.elf main.hex
avr-size --mcu=attiny2313 main.elf
  text    data     bss     dec     hex filename
  2014       4      88    2106     83a main.elf </pre>
<ul class="list1 list-indent1"><li>1988バイトは気の迷いでした。（とあるコーディングミスで最適化され機能削除されていました。）</li></ul>
<ul class="list1 list-indent1"><li>WinAVRのバージョンは2006-0421でビルドしていますので、最新のWinAVRではサイズが変わる（増える）かもしれません。</li></ul>
<p>おまけソフト</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidmon-0929.zip" rel="nofollow">ＨＩＤｍｏｎ：hidmon-0929.zip</a></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_4">ＳＣＫ、ＭＯＳＩのＨｉ−Ｚ化改良<a class="anchor_super" id="z551790c" href="#z551790c" title="z551790c" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>senshuさんにより取り纏め頂いたhidspx-0928.zipに対して、ＳＣＫ、ＭＯＳＩのＨｉ−Ｚ化を
行いました。</li>
<li>ライターが書き込み動作を行っていないときはＳＣＫ、ＭＯＳＩをＨｉ−Ｚにします。</li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidspx-0928a.zip" rel="nofollow">ソースアーカイブ：hidspx-0928a.zip</a></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_5">高速化改良その６<a class="anchor_super" id="p7941a5a" href="#p7941a5a" title="p7941a5a" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>address_set , page_write , isp_command を全部含んだ融合コマンドを実装しました。</li>
<li>tiny2313では、かなり有効かと思われます。</li></ul>
<ul class="list1 list-indent1"><li>それに伴って命令セット体系に少し変更が生じました。</li>
<li><del>ソースは現在整理中です。乞うご期待。</del> <strong>任務完了！</strong></li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidspx-0927a.zip" rel="nofollow">ソースアーカイブ：hidspx-0927a.zip</a></li></ul>
<p>おまけソフト</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidmon-0927a.zip" rel="nofollow">ＨＩＤｍｏｎ：hidmon-0927a.zip</a></li></ul>
<p>注意</p>
<ul class="list1 list-indent1"><li><del>ＨＩＤｍｏｎを使用される場合は命令Fusionが使えませんので、</del> --使えるようにしました。
<pre>#define INCLUDE_FUSION       0
#define INCLUDE_MONITOR_CMD  1</pre>
<del>でファームを作成しなおしてください。</del></li>
<li>ポートの方向初期値を適切に設定してあげてください。</li></ul>
<p>たぶん、ここらで打ち止めです。</p>
<ul class="list1 list-indent1"><li>残りはＨＩＤｍｏｎの若干の機能強化と、汎用ＵＳＢ　Ｉ/Ｏ　ＤＬＬもどきの作成。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_6">高速化改良その５<a class="anchor_super" id="cf9dee00" href="#cf9dee00" title="cf9dee00" style="user-select:none;">&dagger;</a></h2>
<p><strong>変更内容</strong>（わりと堅実路線）</p>
<ul class="list1 list-indent1"><li>'-d&lt;delay&gt;' オプションのクロックをＵＳＢａｓｐに近づけるように努力しました。
<ul class="list2 list-indent1"><li>詳細は firmware/main.c にあります。</li></ul></li>
<li>hidasp.c を少しリライトしました。
<ul class="list2 list-indent1"><li>デバッグ文が多くて見づらかったためです。</li></ul></li>
<li>メモリーを減らしました。
<ul class="list2 list-indent1"><li>-d&lt;delay&gt; で思いのほかメモリー使用量が増えたので、ダイエットです。</li></ul></li>
<li>タイマー０によるＵＳＩクロック生成は諦めました。
<ul class="list2 list-indent1"><li>うまくいく方法が見つかったらこっそり教えてください。</li></ul></li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/upload/hidspx-src-0925.zip" rel="nofollow">ソースアーカイブ：hidspx-src-0925.zip</a></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_7">高速化改良その４<a class="anchor_super" id="pb2d0ff9" href="#pb2d0ff9" title="pb2d0ff9" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>紆余曲折の末、８バイト単位でのインターリーブ転送を実施することに決定しました。</li>
<li>つまり、図で書くとこんな感じ
<pre>時間軸 0mS                         1mS                           2mS  
       +--------------------------+-----------------------------+------------------ ...
       |USB転送|                  |USB転送|                     |USB転送|
       +--------------------------+-----------------------------+------------------ ...
                |&lt;=ISP書き込み===&gt;|        |&lt;=ISP書き込み======&gt;|        |&lt;=ISP書き込み</pre></li></ul>
<ul class="list1 list-indent1"><li>目標では５ｋＢ/Ｓ（但しＳＣＬＫ１ＭＨｚ弱程度を想定）</li>
<li>ＳＣＬＫはタイマー０で与える。</li>
<li>タイマー０のプリスケーラと分周比のペアを専用のコマンドで与える。</li>
<li>ディレイオプション -d&lt;delay&gt; からペア値への変換表はホストＰＣ側が担当する。</li></ul>
<p>さて、うまくいきますやら・・・</p>
<p><strong>結論</strong></p>
<ul class="list1 list-indent1"><li>駄目でした。（テストマシンはintel UHCI）
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">read</td><td class="style_td">1.862 sec (4.4kB/s)</td></tr>
<tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">write &amp; verify</td><td class="style_td">5.368 sec (1.5kB/s)</td></tr>
</tbody></table></div></li></ul>
<p>ちなみにfirmのサイズは2048きっかりでした。</p>
<ul class="list1 list-indent1"><li>LED,MONITORの両方削除</li>
<li>アンロール削除</li>
<li>vendor,productIDを１字に。</li>
<li>HID Reportディスクリプタは最小限の３個(6,38,70)</li></ul>
<p>そもそも５ｋＢ/Ｓは読みか書きのどちらかの速度です。</p>
<ul class="list1 list-indent1"><li>転送ベンチが５ｋだったので、書き＆ベリファイで５ｋも出るわけないです。</li>
<li>あと、現在の実装は書き込みパケットにかなり無駄があります。（page_writeの前後の２パケットは内包可能）</li></ul>
<p>コードエリアが足りません。（これは深刻・・・）</p>
<pre>avr-size --mcu=attiny2313 main.elf
  text    data     bss     dec     hex filename
  2034       4      59    2097     831 main.elf</pre>
<ul class="list1 list-indent1"><li>100mSのディレイが残っていたので、差し引くと1.762 sec</li>
<li>書き込み時には無駄パケットが少し多いので、パケットをうまく統合するとreadの倍の3.6 sec 程度まで行くかもしれません。</li>
<li>でも、どう頑張っても５Ｋの半分(2.5k/s)よりは出ないでしょう。</li>
<li>だったら、今の最速（Ｗ＆Ｖで２Ｋ弱）をキープして、コード保守するほうが堅実なのかもしれません。</li></ul>
<p>実計測結果<br />
<a href="http:/ATMEL_AVR/upload/hidspx-test-0925.zip" rel="nofollow">テストアーカイブ：hidspx-test-0925.zip</a></p>
<ul class="list1 list-indent1"><li>マシン＝Athlon64 USBホスト＝VIAチップPCIカード(UHCI)</li>
<li>delayループ取り払い状態（1.5MHz SCLK)</li></ul>
<ul class="list1 list-indent1"><li>ATmega88へ8192バイトのHEXを書き込み＆ベリファイ
<pre>bash-3.2$ time ./hidspx.exe -ph -d0 xx.hex
Detected device is ATmega88.
Erase Flash memory.
Write   Flash: 8192/8192 B
Verify  Flash: 8192/8192 B
Passed.

real    0m3.859s
user    0m0.031s
sys     0m0.015s</pre></li></ul>
<ul class="list1 list-indent1"><li>ATmega88から8192バイトのHEXを読み込み
<pre>bash-3.2$ time ./hidspx.exe -ph -d0 -rp &gt;a.hex
Detected device is ATmega88.
Read    Flash: 8192/8192 B
Passed.

real    0m1.438s
user    0m0.015s
sys     0m0.000s
bash-3.2$</pre></li></ul>
<ul class="list1 list-indent1"><li>まとめ（テストマシンはAMD + UHCI）</li>
<li>delay()ループ完全取り払い（SCLK=1.5MHz）
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">read</td><td class="style_td">1.438 sec (5.696kB/s)</td></tr>
<tr><td class="style_td">8kB</td><td class="style_td">-d0</td><td class="style_td">write &amp; verify</td><td class="style_td">3.859 sec (2.122kB/s)</td></tr>
</tbody></table></div></li>
<li>書き込みパケット数を減量（統合）すれば、write &amp; verifyはもうすこし速くなりますので、2.5kB/sも夢ではないかもしれませんが、そのまえにコードサイズのスリム化が必要です。（どなたか挑戦しませんか、アーカイブは上記のhidspx-test-0925.zipです）</li></ul>
<p>とりあえず、いい夢を見させてくれました。ありがとう＞ＵＳＢａｓｐ</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_8">ＡＶＲｂｅｎｃｈ<a class="anchor_super" id="baa8c2ec" href="#baa8c2ec" title="baa8c2ec" style="user-select:none;">&dagger;</a></h2>
<p>usb<span class="noexists"><a href="./?cmd=edit&amp;page=FunctionWrite&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">FunctionWrite</a></span>()の性能テスト.</p>
<ul class="list1 list-indent1"><li>usb<span class="noexists"><a href="./?cmd=edit&amp;page=FunctionWrite&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">FunctionWrite</a></span>()内に遅延関数の呼び出しを入れる。</li>
<li>どのくらい遅延すると、ホスト側の速度に影響するかのテスト.
</li>
<li>0060 番地が遅延係数で 1 増えるごとに100uS
</li>
<li>使い方は win32/ で
<pre> term -iscript</pre></li></ul>
<p><a href="http:/ATMEL_AVR/upload/AVRbench.zip" rel="nofollow">テストアーカイブ：AVRbench.zip</a></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_9">高速化改良その３<a class="anchor_super" id="ke5da781" href="#ke5da781" title="ke5da781" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>たいした変更ではありませんので、ここに差分を書きます。</li></ul>
<pre>static uint8_t usi_trans(uint8_t data){
	USIDR=data;
	USISR=(1&lt;&lt;USIOIF);
+	if(wait==0) {
+	uchar CR0=(1&lt;&lt;USIWM0)|(1&lt;&lt;USICS1)|(1&lt;&lt;USITC);
+	uchar CR1=(1&lt;&lt;USIWM0)|(1&lt;&lt;USICS1)|(1&lt;&lt;USITC)|(1&lt;&lt;USICLK);
+	{
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+		USICR=CR0;	asm(&quot;nop&quot;);	USICR=CR1;	asm(&quot;nop&quot;);
+	}
+	return USIDR;
+	}else{
		do{
			delay(wait);
			USICR=(1&lt;&lt;USIWM0)|(1&lt;&lt;USICS1)|(1&lt;&lt;USICLK)|(1&lt;&lt;USITC);
		} while(!(USISR&amp;(1&lt;&lt;USIOIF)));
+	}
	return USIDR;
}</pre>
<pre>bash-2.02$ time ./hidspx.exe -rp &gt;1
Detected device is ATmega88.
Read    Flash: 8192/8192 B
Passed.

real    0m1.915s
user    0m0.015s
sys     0m0.000s
bash-2.02$ time ./hidspx.exe 8K.hex
Detected device is ATmega88.
Erase Flash memory.
Write   Flash: 8192/8192 B
Verify  Flash: 8192/8192 B
Passed.

real    0m4.247s
user    0m0.015s
sys     0m0.000s</pre>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_10">高速化改良（案のみ）<a class="anchor_super" id="ybae0820" href="#ybae0820" title="ybae0820" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>書き込みのみですが、３２バイトのＨＩＤ　Ｒｅｐｏｒｔを送りつけられている間もＳＰＩ転送するような
ソリューションが考えられます。</li>
<li>具体的には、usb<span class="noexists"><a href="./?cmd=edit&amp;page=FunctionWrite&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">FunctionWrite</a></span>()で全部貯めてからＳＰＩ書き込みではなくて、８バイト貯まったＨＥＸをそのつどＳＰＩで送るといった方法です。</li>
<li>読み出しは今のところAVRUSB側にポインタと長さを渡してそれっきり、という方法でやってますのでこれも、usbFunctionReadに引っ掛けて、ちまちま読み出す、というところでしょうか。</li></ul>
<ul class="list1 list-indent1"><li>ただし、delayオプションが長い場合はＵＳＢ転送の足を思いっきり引っ張るような気もしています。</li></ul>
<ul class="list1 list-indent1"><li>readに対してだけ実際に試してみましたが、8Kのreadに1.4秒が限界でした.</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_11">高速化改良その２<a class="anchor_super" id="ke5da781" href="#ke5da781" title="ke5da781" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>たいした変更ではありませんので、ここに差分を書きます。
<pre>static uint8_t usi_trans(uint8_t data){
	USIDR=data;
 	USISR=(1&lt;&lt;USIOIF);
+	if(wait==0) {
+		do{
+			USICR=(1&lt;&lt;USIWM0)|(1&lt;&lt;USICS1)|(1&lt;&lt;USICLK)|(1&lt;&lt;USITC);
+		} while(!(USISR&amp;(1&lt;&lt;USIOIF)));
+		return USIDR;
+	}else{
		do{
			delay(wait);
			USICR=(1&lt;&lt;USIWM0)|(1&lt;&lt;USICS1)|(1&lt;&lt;USICLK)|(1&lt;&lt;USITC);
		} while(!(USISR&amp;(1&lt;&lt;USIOIF)));
+	}
	return USIDR;
}</pre></li></ul>
<pre>avr-objcopy -j .text -j .data -O ihex main.elf main.hex
bash checksize main.elf 2048 128
ROM: 2010 bytes (data=4)
RAM: 93 bytes</pre>
<p>残りあと３８バイトとなりました。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_12">６ＫＢ書き込み＆ベリファイ時間計測<a class="anchor_super" id="b82fcd7c" href="#b82fcd7c" title="b82fcd7c" style="user-select:none;">&dagger;</a></h3>
<pre>HIDspx -ph -d&lt;Delay&gt; test.hex </pre>
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">Delay</td><td class="style_td">Time</td></tr>
<tr><td class="style_td">-d0</td><td class="style_td">４秒</td></tr>
<tr><td class="style_td">-d1</td><td class="style_td">５秒</td></tr>
<tr><td class="style_td">-d4</td><td class="style_td">８秒</td></tr>
</tbody></table></div>
<ul class="list1 list-indent1"><li>計測に使用したマザーボードはSiS製です。</li>
<li>マザーとHIDaspの間にはELECOM製のＵＳＢ１.１ハブが挟まっています。</li></ul>
<p><span class="noexists"><a href="./?cmd=edit&amp;page=ToDo&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">ToDo</a></span>:</p>
<ul class="list1 list-indent1"><li>時間計測コマンド(unixのtime相当)をちゃんと作る。
<ul class="list2 list-indent1"><li>今使っているのは自作ツールで 16bit MSDOSのコード。
<pre>1993/07/09  02:33            11,682 WATCH.EXE</pre></li></ul></li>
<li>そろそろＡＴｍｅｇａ８８では限界なのでＡＴｍｅｇａ６４４のボードを（<strong>書き込み時間計測のためだけに</strong>）制作する。</li>
<li>Ｓｎｏｏｐｙ−Ｐｒｏを使ってＵＳＢ転送の様子を観察し、パケット送信間隔等を評価する。</li></ul>
<p>なんかこう、<strong>ＡＶＲに高速に書き込むこと</strong>が目的化してしまいました。笑っちゃいます。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_13">高速化改良その１<a class="anchor_super" id="vf296265" href="#vf296265" title="vf296265" style="user-select:none;">&dagger;</a></h2>
<p><strong>内容</strong></p>
<ul class="list1 list-indent1"><li>パケットサイズのバリエーションをさらに増やしてみました。</li>
<li>usbHidReportDescriptorを６種類用意して、サイズをそれぞれ、6,14,22,30,38,46 にしました。</li>
<li>但し、読み込みパケットサイズは38に留めています。（現在のところ固定）</li>
<li>waitのループを瓶詰堂さんのオリジナルに戻しています(nopを消してしまいました：実は書き込み速度向上にはこれ＋オプション「-d0」が一番効きます。)</li>
<li>さらに速くするには、-d0のときはdelay()を外したusi_trans()を用意するか、あるいはＨＩＤａｓｐを２０ＭＨｚ動作させる等が考えられますが、ターゲットデバイスが遅い場合は意味がありません。</li></ul>
<p><a href="http:/ATMEL_AVR/upload/hidspx-src-0920.zip" rel="nofollow">ダウンロードはこちらです：hidspx-src-0920.zip</a></p>
<ul class="list1 list-indent1"><li>書き込み速度の実測値ですが、ATmega88に６ｋＢの書き込み＆ベリファイで約５秒に短縮しました。</li>
<li>CMD_PEEKとCMD_POKEを追加してあります。（未デバッグ）</li>
<li>また、サイズは以下の通りです。
<pre>avr-objcopy -j .text -j .data -O ihex main.elf main.hex
bash checksize main.elf 2048 128
ROM: 1992 bytes (data=4)
RAM: 93 bytes</pre></li></ul>
<p>追加：</p>
<ul class="list1 list-indent1"><li>HIDsphの '-d4'オプションのほうが、こちらの '-d0'書き込みより速いのではないか疑惑
<ul class="list2 list-indent1"><li>上記調査中です。</li></ul></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_14">HIDasp高速化完了<a class="anchor_super" id="l2b87bfc" href="#l2b87bfc" title="l2b87bfc" style="user-select:none;">&dagger;</a></h2>
<p><a href="http://www-ice.yamagata-cit.ac.jp/ken/senshu/sitedev/index.php?AVR%2FHIDasp" rel="nofollow">千秋様のＨＰへのリンク</a></p>
<p><a href="http://www.binzume.net/library/avr_hidasp.html" rel="nofollow">瓶詰堂さんのＨＰへのリンク</a></p>
<p>senshu様から頂いたソースと、瓶詰堂さんのHIDaspソースをもとに
作成しました。</p>
<p>ディレクトリ構成</p>
<pre>| hidspx-src/ HIDspx.exe とそのソースです。
| firmware/   AVR側のファームウェアHEXとそのソースです。</pre>
<p>変更内容:</p>
<ul class="list1 list-indent1"><li>HID Reportの転送をHidD_<span class="noexists"><a href="./?cmd=edit&amp;page=GetFeature&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">GetFeature</a></span>()/HidD_<span class="noexists"><a href="./?cmd=edit&amp;page=SetFeature&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">SetFeature</a></span>()で行うようにしました。</li>
<li>usbHidReportDescriptorを４種類用意して、サイズをそれぞれ、6,14,22,30にしました。</li>
<li>変更点はたったそれだけです。</li>
<li>上位プロトコルは瓶詰堂さんのHIDaspと同じままです。</li>
<li>配線はUSBのD+,D-だけを PORTD,3,2 に変えて、他は瓶詰堂さんのHIDaspと同じです。</li>
<li>usbHidReportDescriptorが異なりますので、上記exeとファームはペアでないと動作しません。</li></ul>
<p><a href="http:/ATMEL_AVR/upload/hidspx-src-0919.zip" rel="nofollow">ダウンロードはこちらです：hidspx-src-0919.zip</a></p>
<ul class="list1 list-indent1"><li>期待したほど速くはなりませんでした。
<ul class="list2 list-indent1"><li>ATmega88に６ＫＢのHEXを書き込み＆ベリファイにて、所要時間６秒（ＡＭＤマザーボード）</li>
<li>（後でＰｅｎｔｉｕｍ４マシンで追試しましたところ９秒でしたので、実は遅くなっただけかも・・・）</li></ul></li>
<li>ＵＳＢの挿抜に対しては安定です。</li>
<li>コードサイズは以下のとおりです。特に縮める作業はやっていません。
<pre>avr-objcopy -j .text -j .data -O ihex main.elf main.hex
bash checksize main.elf 8192 1024
ROM: 1962 bytes (data=4)
RAM: 86 bytes</pre></li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_15">考察<a class="anchor_super" id="g58ea4f9" href="#g58ea4f9" title="g58ea4f9" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>HID Report３０バイトの書き込みと読み出しを交互に１０００回実行してみます。</li>
<li>実行方法は、hidasp.cのソースにて、最初に４回testパケットを送る部分を改造して、３０バイトのHID Reportを送るようにします。</li>
<li>ループ回数を１０００に増やします。</li>
<li>hidspx.exe -ph -r を実行します。（書き込みデバイスは無くてよい）</li></ul>
<ul class="list1 list-indent1"><li>ＯＨＣＩのＵＳＢ付きマザーで試したところ、１０００回の試行に６秒掛かりましたが、ＵＨＣＩではその倍の１２秒でした。</li>
<li>すなわち、３０バイトのＨＩＤ Ｒｅｐｏｒｔを送るのに３フレーム(OHCI)もしくは６フレーム(UHCI)掛かる計算になります。</li>
<li>より正確な時間の推移を知りたい場合はSnoopy-proというＷｉｎｄｏｗｓ上のＵＳＢスニッファーを入れて、パケットをキャプチャーすると良いです。</li>
<li>３０バイト単位でただひたすら読むだけなら、10kB/s もしくは 5kB/s くらいの速度が出るはずなのに、実際にＳＰＩ転送が入るとその1/10あるいは1/5になるのは、なにか要因があるのだと思いますが、まだ追求できていません。</li></ul>
<p><br />
<br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_16">落穂拾い<a class="anchor_super" id="f285f099" href="#f285f099" title="f285f099" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>配線は森芳電子さんの方法が洗練されているので、それに合わせたい。
<ul class="list2 list-indent1"><li>クロック出力をターゲットに与えることが可能になっている。</li>
<li>LEDをPB2,PB3に移してあるので、TxD,RxDを使用可能になっている。（実際tiny2313ではコードを入れる空きがないけれど、同じ基板を別の用途に転用しやすい）</li>
<li>但し、D+,D-の配置がさらに変わるので、usbdrv/以下のいくつかのソースにまで手を入れなければならない。</li>
<li>さらに、INT0がINT1に変わるので、最小限必要な割り込みベクタが２バイト増加する。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>AVRmonitの一部の機能(RAMやI/Oに対するPEEK/POKE命令)を組み込んで、代わりにLED制御はそっちでやる。
<ul class="list2 list-indent1"><li>すると、余ったポートにPWMを設定して昇圧回路をドライブするとか、変な付加機能をＰＣ側から好きなように実装できる。</li>
<li>ＡＶＲを焼かないときでも汎用ＩＯ代わりに流用できるようになる。</li>
<li>ＡＶＲを焼いた直後にターゲットをリセット起動させたり、ターゲットとＳＰＩクロス接続になっているので通信(printfデバッグ)したり出来るようになる（かも）</li></ul></li></ul>
<ul class="list1 list-indent1"><li>高速化したいけれど・・・。（無理かなぁ）
<ul class="list2 list-indent1"><li>すzさんの考察されているように、ＨＩＤデバイスに見せかけておいて、libusb経由でバルク転送とか。</li>
<li>ファーム容量的に無理っぽいのと、けっきょくそうういったことは別のＡＶＲライターでやり尽くされているような気もする</li>
<li>自分はATtiny2313しか知らないので、そんな世界も知らない。でも見てみたいかも。</li></ul></li></ul>
<p><strong>こうやって、ＡＶＲライターの種類だけが増えていく</strong>のは、なんだかむなしいなぁ</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_17">HIDasp高速化検討中<a class="anchor_super" id="ab6a2305" href="#ab6a2305" title="ab6a2305" style="user-select:none;">&dagger;</a></h2>
<p>光が見えてきたので、作業記録を書いてみる。</p>
<p><strong>現状</strong></p>
<ul class="list1 list-indent1"><li>HIDaspはWindowsAPIの<span class="noexists"><a href="./?cmd=edit&amp;page=ReadFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">ReadFile</a></span>()/<span class="noexists"><a href="./?cmd=edit&amp;page=WriteFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">WriteFile</a></span>()によってHID Reportを転送している。</li>
<li>HID Reportというのは、たとえばマウスならボタン情報、座標などを含む、固定サイズのデータだ。</li>
<li>そのReportの１パケットは８バイトになっている。<span class="noexists"><a href="./?cmd=edit&amp;page=ReadFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">ReadFile</a></span>()/<span class="noexists"><a href="./?cmd=edit&amp;page=WriteFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">WriteFile</a></span>()に与える転送長は＋１した９を与える。</li>
<li>Report_IDは０になっている。<span class="noexists"><a href="./?cmd=edit&amp;page=ReadFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">ReadFile</a></span>()/<span class="noexists"><a href="./?cmd=edit&amp;page=WriteFile&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">WriteFile</a></span>()のバッファ先頭にReport_IDを置く。</li>
<li>他の例(AVR-DoperやHIDsph)を見るとReportIDは１〜のようだ。</li></ul>
<p><strong>問題点</strong></p>
<ul class="list1 list-indent1"><li>Windows2000では、起動時のハンドシェークでやりとりがうまく行かず、ハングする。</li>
<li>WindowsXPではＵＳＢ挿入直後だけハンドシェークをミスるが、一応無視して継続する。</li>
<li>転送速度は約１ｋＢ/秒なので、ATmega644では１分弱掛かり実用的でない。
<ul class="list2 list-indent1"><li>ATtiny2313では４秒程度なので問題なし。</li></ul></li></ul>
<p><strong>改善策（案）</strong></p>
<ul class="list1 list-indent1"><li>まず、HID Reportの転送単位を変更する（３２バイト程度にすると効果あり）</li>
<li>HIDaspのusbHidReportDescriptorを<a href="http://www.obdev.at/products/avrusb/avrdoper.html" rel="nofollow">AVR-Doper</a>ベースのものに差し替える。</li>
<li>これは、HID Report ID 1〜5までが定義されていて、転送サイズ(REPORT_COUNT)はそれぞれ</li>
<li>(16-2),(32-2),(64-2),(128-2),(64-2) のようになっている。</li>
<li>なぜ２のべき-2なのかというと、パケットの先頭にReport ID(1〜5のどれか)を入れる必要があるからだ。</li>
<li>(でもそれは-1である理由にしかなってないんだけど)</li>
<li>実はキリの良い値でなければならないという理由はないが<span class="noexists"><a href="./?cmd=edit&amp;page=LowSpeed&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">LowSpeed</a></span> USBのパケット長上限は８バイトなので、総転送サイズが８の倍数になっているほうが効率が良い。</li>
<li>最後のやつだけ数列から外れているが、これはデバッグパケットらしい。</li></ul>
<p><br />
そして、HID Reportの転送には<strong>HidD_<span class="noexists"><a href="./?cmd=edit&amp;page=GetFeature&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">GetFeature</a></span>()/HidD_<span class="noexists"><a href="./?cmd=edit&amp;page=SetFeature&amp;refer=%EF%BC%A8%EF%BC%A9%EF%BC%A4%EF%BD%81%EF%BD%93%EF%BD%90%E9%AB%98%E9%80%9F%E5%8C%96">SetFeature</a></span>()</strong> を使う。</p>
<ul class="list1 list-indent1"><li>転送サイズはREPORT_COUNT+1を与え、バッファの先頭にはReport_IDを書き込んで使う。</li></ul>
<p><strong>今日やったこと</strong></p>
<ul class="list1 list-indent1"><li>AVR-DoperのHidReportDescriptorを移植したAVR-USBのフレームワークを用意して、
３２バイトパケットを単純にエコーバックするだけのファームを書く。</li>
<li>そして、ホストＰＣ側から、接続を試みる。</li>
<li>（senshuさんのHIDspx-srcをありがたく使わせて頂いております）</li>
<li>３１バイトのHID Reportを適当にでっちあげて Report_ID=2で送信し、そのエコーが戻ってくるのを確認。<strong>&lt;===今日はここまで</strong></li></ul>
<p>とりあえず現状報告</p>
<pre>avr-objcopy -j .text -j .data -O ihex main.elf main.hex
bash checksize main.elf 8192 1024
ROM: 1968 bytes (data=4)
RAM: 87 bytes</pre>
<ul class="list1 list-indent1"><li>一応isp_commandまで入れた。</li>
<li>AVRmonitは入れていない。</li></ul>
<p>明日以降の予定</p>
<ul class="list1 list-indent1"><li>AVRmonitをHIDベースにして、デバイスドライバ不要のやつを作ってみる。</li>
<li>ベンチマーク機能があるので、ベンチマークしてみる。</li>
<li>予想では4kB/s程度。根拠は32バイトまとめて送るので。</li>
<li><del>コードサイズが余れば瓶詰さんのプロトコルを乗せてみる。</del>すでに入っているつもり</li></ul>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br /></p>
<hr class="full_hr" />
<p>下記の記述はＨＩＤクラスの制約を無視した考察ですので、多分に間違いを含んでおります。
（libusbを使用する場合はＯＫかもしれません。）</p>
<p>現在再検討中です。</p>
<hr class="full_hr" />
<p>千秋さんのサイトでの話題</p>
<ul class="list1 list-indent1"><li><a href="http://www-ice.yamagata-cit.ac.jp/ken/senshu/sitedev/index.php?AVR%2Fnews25#l06c25ea" rel="nofollow">http://www-ice.yamagata-cit.ac.jp/ken/senshu/sitedev/index.php?AVR%2Fnews25#l06c25ea</a></li></ul>
<p>可能性を探ってみた。</p>
<ul class="list1 list-indent1"><li>まず、ＬｏｗＳｐｅｅｄの転送速度は、理論値１.５Ｍｂｐｓあるように見えるけれどこれは<strong>気の迷い</strong>。</li>
<li>基本、コントロール転送を使うと仮定。</li>
<li>ＵＳＢでは１フレーム（１ｍＳ）に８バイトのパケットが１回送れる（あるいは受け取れる）だけなのだ。</li>
<li>じゃあ８ｋＢ/秒かというと微妙なところで、コントロール転送を用いて８バイトのベンダーコマンドを送り、デバイスから８バイトのリターンを返してもらうという１回のトランザクションの<a href="E4-BB-8A-E5-BE-8C-E3-81-AE-E7-9B-AE-E6-A8-99-.html#l07b1d63" title="今後の目標" class="link_page_passage" data-mtime="2007-10-27T23:01:36+09:00">時間を計測してみる</a>と、</li>
<li>ＯＨＣＩでは１ｍＳで完結するがＵＨＣＩでは４ｍＳ掛かる。</li>
<li>つまり、ＯＨＣＩでは１秒に８ｋＢ送って８ｋＢのリターンが得られるが、</li>
<li>ＵＨＣＩではその１/４の速度（２ｋＢ/秒）まで落ちる。</li></ul>
<ul class="list1 list-indent1"><li>もうひとつやっかいなのがコントロール転送では８バイトの内容のうち、先頭１バイトがbmRequestTypeであり、お尻の２バイトがwLength（後続データのサイズ指定子）となっていて自由に使えない。</li>
<li>つまり送出できる正味データ量は８ｋＢ/Ｓではなく５ｋＢ/Ｓになってしまうわけだ。（ＵＨＣＩではさらにその１/４）
<ul class="list2 list-indent1"><li>ＨＩＤａｓｐに限った話をすると、５バイトのうち最初の１バイトがコマンドバイトとして使われていて、正味のＳＰＩデータ送出は４バイト／フレームである。</li>
<li>但し、ＡＶＲ書き込みターゲットに対するページリードがサポートされていて、４バイトのファームウェアデータを１トランザクションで転送しているようなので、書き込み速度としては４バイト／４ｍＳ＝毎秒１ｋＢとなる。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>これを打破する手としては、１トランザクションに後続データを１６〜３２バイト付加してやって、１回のコントロール転送で１６〜３２バイト分のファームウェアデータを送りつけてやる方法だ。</li>
<li>仮に３２バイト送るとするとＵＨＣＩでは４＋４＝８フレームでおそらく完結するので、</li>
<li>３２バイト/８ｍＳ＝４ｋＢ／秒になる計算だ。</li></ul>
<ul class="list1 list-indent1"><li>問題はそれらの処理を含めて２ｋＢに入るかどうかなんだな。</li>
<li>かなり難しいと思う。ＧＣＣ４ではバイナリコードが肥大化する傾向があるのでＧＣＣ３ベースのＷｉｎＡＶＲを使うしかないかも。</li>
<li>むしろ、千秋さんのサイトで指摘されているとおり、ｔｉｎｙ２３１３に固執するのをやめて、ＡＴｍｅｇａ８８あたりでゆったりとコードを組んだほうが正解なのかもしれない。</li></ul>
<ul class="list1 list-indent1"><li>でも、当サイトでは無理やりコードを縮めて２３１３に詰め込む方向にむしろ快感を感じるので、ｍｅｇａ８８は使わないだろうと思う。（嘘。手持ちのｍｅｇａ８８が少なくて、２３１３ばかりが余っているので、２３１３を使い切る方向で考えている。）</li></ul>
<hr class="full_hr" />
   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="http:/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="#">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2022-07-25 (月) 21:56:43<span class="page_passage" data-mtime="2022-07-25T21:56:43+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>convert time: 0.043 sec</li>
    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
