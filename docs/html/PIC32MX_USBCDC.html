<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>PIC32MX_USBCDC - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar">
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage" data-mtime="2022-08-01T12:48:11+09:00">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li>
<li><strong><a href="20222D-08.html" title="2022-08" class="link_page_passage" data-mtime="2022-12-06T14:55:12+09:00">開発日記</a></strong> <a href="SiteMap.html" title="SiteMap" class="link_page_passage" data-mtime="2022-07-31T15:21:46+09:00">ログ</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage" data-mtime="2013-04-29T09:29:29+09:00">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage" data-mtime="2014-12-01T23:50:24+09:00">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage" data-mtime="2012-09-12T22:43:19+09:00">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage" data-mtime="2011-11-25T22:47:41+09:00">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage" data-mtime="2011-11-27T16:31:48+09:00">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage" data-mtime="2015-05-02T16:17:40+09:00">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">シリアルブートローダー</a></li>
<li><a href="" title="PIC32MX_USBCDC" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage" data-mtime="2014-09-27T22:53:38+09:00">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage" data-mtime="2014-11-20T22:01:19+09:00">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage" data-mtime="2015-02-01T14:32:31+09:00">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage" data-mtime="2013-05-10T22:28:35+09:00">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage" data-mtime="2009-09-25T17:26:22+09:00">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage" data-mtime="2009-04-16T22:42:14+09:00">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage" data-mtime="2010-02-17T16:23:41+09:00">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage" data-mtime="2009-05-06T01:05:20+09:00">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage" data-mtime="2010-04-28T09:27:01+09:00">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage" data-mtime="2014-06-22T14:58:37+09:00">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage" data-mtime="2015-01-22T18:20:53+09:00">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage" data-mtime="2012-12-06T13:25:35+09:00">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage" data-mtime="2008-10-13T03:47:40+09:00">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage" data-mtime="2010-11-02T22:35:53+09:00">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage" data-mtime="2008-05-17T00:51:37+09:00">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage" data-mtime="2007-08-28T23:52:40+09:00">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2022-12-06</strong>
<ul class="recent_list">
 <li><a href="MSE3-82-A2-E3-82-AB-E3-82-A6-E3-83-B3-E3-83-88-E3-81-AE-WindowsE3-81-AE-CE3-83-89-E3-83-A9-E3-82-A4-E3-83-96-E3-82-92-E4-BF-AE-E5-BE-A9-E3-81-99-E3-82-8B-.html" class="link_page_passage" data-mtime="2022-12-06T15:05:42+09:00">MSアカウントのWindowsのCドライブを修復する</a></li>
 <li><a href="20222D-08.html" class="link_page_passage" data-mtime="2022-12-06T14:55:12+09:00">2022-08</a></li>
</ul>
<strong>2022-09-29</strong>
<ul class="recent_list">
 <li><a href="AndroidE3-81-AB-SSLE8-87-AA-E5-B7-B1-E7-BD-B2-E5-90-8D-E8-A8-BC-E6-98-8E-E6-9B-B8-E3-82-92-E5-85-A5-E3-82-8C-E3-82-8B-.html" class="link_page_passage" data-mtime="2022-09-29T22:10:56+09:00">AndroidにSSL自己署名証明書を入れる</a></li>
</ul>
<strong>2022-09-01</strong>
<ul class="recent_list">
 <li><a href="UEFI_Basic.html" class="link_page_passage" data-mtime="2022-09-01T20:22:14+09:00">UEFI_Basic</a></li>
</ul>
<strong>2022-08-31</strong>
<ul class="recent_list">
 <li><a href="SMRE3-81-AA-HDDE3-83-99-E3-83-B3-E3-83-81-E3-83-9E-E3-83-BC-E3-82-AF-.html" class="link_page_passage" data-mtime="2022-08-31T11:15:42+09:00">SMRなHDDベンチマーク</a></li>
 <li><a href="E7-B0-A1-E6-98-93-E9-80-9F-E5-BA-A6-E6-B8-AC-E5-AE-9A-E3-82-B5-E3-82-A4-E3-83-88-.html" class="link_page_passage" data-mtime="2022-08-31T11:11:11+09:00">簡易速度測定サイト</a></li>
 <li><a href="E3-83-8D-E3-83-83-E3-83-88-E3-83-AF-E3-83-BC-E3-82-AF-BOOT.html" class="link_page_passage" data-mtime="2022-08-31T11:09:22+09:00">ネットワークBOOT</a></li>
</ul>
<strong>2022-08-26</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E3-82-B3-E3-83-B3-E3-83-91-E3-82-A4-E3-83-AB-E3-83-99-E3-83-B3-E3-83-81-.html" class="link_page_passage" data-mtime="2022-08-26T16:28:56+09:00">簡易コンパイルベンチ</a></li>
</ul>
<strong>2022-08-05</strong>
<ul class="recent_list">
 <li><a href="MenuBar.html" class="link_page_passage" data-mtime="2022-08-05T09:51:36+09:00">MenuBar</a></li>
</ul>
<strong>2022-08-01</strong>
<ul class="recent_list">
 <li><a href="/ATMEL_AVR/html/" class="link_page_passage" data-mtime="2022-08-01T12:48:11+09:00">FrontPage</a></li>
 <li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:34+09:00">ＨＩＤａｓｐ</a></li>
 <li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
 <li><a href="AVRetc.html" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">AVRetc</a></li>
 <li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
 <li><a href="20082D-08.html" class="link_page_passage" data-mtime="2022-08-01T10:37:50+09:00">2008-08</a></li>
</ul>
<strong>2022-07-31</strong>
<ul class="recent_list">
 <li><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">ＷｉｄｅＴｅｘｔ</a></li>
 <li><a href="RecentDeleted.html" class="link_page_passage" data-mtime="2022-07-31T15:25:08+09:00">RecentDeleted</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li class="selected" id="separate"><a href="">本文</a></li><li><a href="./?cmd=edit&amp;page=PIC32MX_USBCDC">編集</a></li><li><a href="./?cmd=diff&amp;page=PIC32MX_USBCDC">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">PIC32MX_USBCDC</h1><div id="contentSub"></div>
    <p><a href="PIC32MX.html" class="link_page_passage" data-mtime="2015-05-02T16:17:40+09:00">PIC32MX</a></p>
<div class="contents">
<a id="contents_1"></a>
<ul class="list1 list-indent1"><li><a href="#p1a04499">PIC32MXで仮想シリアルポートを実装してみる。</a></li>
<li><a href="#a4f38fbd">Pinguinoのスケッチを使用してエコーバックサンプル。</a></li>
<li><a href="#i7cb9167">---考察します。</a></li>
<li><a href="#td696145">---次は、MicroChipのUSB-CDCサンプルを使って試してみます。</a></li>
<li><a href="#b0bc3853">ダウンロード</a></li>
<li><a href="#q0f43147">ベンチマーク結果</a></li>
<li><a href="#jcf74f3e">USB - シリアル変換器 (Serial Emulator) を作る。</a></li>
<li><a href="#gbc2be36">移植の手順についての説明</a></li></ul>
</div>

<h2 id="content_1_0">PIC32MXで仮想シリアルポートを実装してみる。<a class="anchor_super" id="p1a04499" href="#p1a04499" title="p1a04499" style="user-select:none;">&dagger;</a></h2>
<p><strong>２通りの方法があります</strong></p>
<ul class="list1 list-indent1"><li>１つめは、Pinguinoのお手軽スケッチをそのまま使う方法です。</li></ul>
<ul class="list1 list-indent1"><li>もうひとつは、MicroChipのUSB-CDCサンプルを使います。</li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_1">Pinguinoのスケッチを使用してエコーバックサンプル。<a class="anchor_super" id="a4f38fbd" href="#a4f38fbd" title="a4f38fbd" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>スケッチを使用するといっても、pde拡張子のままではROMに焼いたりいろいろ改造できませんので、
例によって、Pinguino環境でMakefileその他を用意してコマンドライン開発する環境に移します。</li></ul>
<ul class="list1 list-indent1"><li>user.c
<pre>unsigned int counter=0;
void setup()
{
	pinmode(13, OUTPUT);
}

void loop()
{
	static int cnt=0;
	static char buffer[256];
	int numBytesRead = USB_Service_CDC_GetString( buffer );
	if(numBytesRead&gt;0) {
		CDCputs(buffer,numBytesRead);
	}
	cnt++;
	if(	cnt &gt;= 500000 ) {
		cnt=0;
		toggle(13);
	}
}</pre></li>
<li>ダウンロード:<a href="/ATMEL_AVR/upload/PIC/cdcecho.zip" rel="nofollow">cdcecho.zip</a></li></ul>
<ul class="list1 list-indent1"><li>こうして出来た仮想シリアルポートのエコーバックサンプルに対して、規則的な繰り返しの文字データを送信し、同時に受信を行なって、その時間を計ります。（ベンチマーク）</li></ul>
<pre>E:\cdcecho&gt;w32term -p
==== COM Port List====
COM50:TxQue=0,RxQue=16384,Baud=0x66b70,BaudMax=0x10000000,Bits=0xc,SubType=6,Capa=cd
COM1:TxQue=0,RxQue=4096,Baud=0x1006ffff,BaudMax=0x10000000,Bits=0xf,SubType=1,Capa=ff

E:\cdcecho&gt;w32term -c50 -t
Entering Benchmark: Escape=^A
..........................................................................................
..........................................................................................
......................................................................
Benchmark end. 32000 bytes/812 ms,  39408 bytes/s (394080 bps)

E:\cdcecho&gt;</pre>
<ul class="list1 list-indent1"><li>毎秒４０ｋＢのスループットになっていることがわかります。ボーレートでは(start/stop bitを加味すると)394kBPSです。</li>
<li>ちょっと遅いですね。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_2">---考察します。<a class="anchor_super" id="i7cb9167" href="#i7cb9167" title="i7cb9167" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>Pinguinoライブラリのcdcサンプルがどのような実装になっているかはあくまで推測です。</li>
<li>毎秒40kBしか送り返せない、ということは、USBの1フレーム時間(1mS)に40byteしか返送されていません。</li>
<li><span class="noexists"><a href="./?cmd=edit&amp;page=FullSpeed&amp;refer=PIC32MX_USBCDC">FullSpeed</a></span>(12Mbps)USBのパケット長は64byteなので、１フレーム時間にわずか1パケットしか返送されていません。</li>
<li>しかも64byteではなくて40byteです。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>これはおそらく、返送ルーチンがバイト指向になっていて、上限が40byteに制限されているのではないか、と推察します。</li></ul>
<ul class="list1 list-indent1"><li>以前にもARMのmapleライブラリのcdc実装がそれに似た感じになっていました。</li>
<li><span class="noexists"><a href="./?cmd=edit&amp;page=FullSpeed&amp;refer=PIC32MX_USBCDC">FullSpeed</a></span> USBの性能としては、１フレーム時間に少なくとも10パケット程度は送出できます。</li>
<li>これが、なぜ1パケットに制限されるか、というと、それはCDC ACMクラスのWindowsドライバーがそうなっているからで、１回のシリアルデータのバルク転送パケットのサイズが64byte未満だった場合は、後続データ無しとみなして、その１フレーム時間(1mS)内には次のパケットを受け取らないという仕様になっているからです。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>USB-CDCデバイスでせっかくバルク転送が使用できるのに、HIDデバイス未満の転送速度しか得られないというのは<strong>なんだか納得がいきません</strong></li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_3">---次は、MicroChipのUSB-CDCサンプルを使って試してみます。<a class="anchor_super" id="td696145" href="#td696145" title="td696145" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>ソースは長いのですが、一応肝の部分だけ抜粋します。
<pre>void ProcessIO(void)
{
	BYTE numBytesRead;
	BlinkUSBStatus();
	if((USBDeviceState &lt; CONFIGURED_STATE)||(USBSuspendControl==1)) return;
	if(buttonPressed) {
		if(stringPrinted == FALSE) {
			if(mUSBUSARTIsTxTrfReady()) {
				putrsUSBUSART(&quot;Button Pressed -- \r\n&quot;);
				stringPrinted = TRUE;
			}
		}
	} else {
		stringPrinted = FALSE;
	}
	if(USBUSARTIsTxTrfReady()) {
		numBytesRead = getsUSBUSART(USB_Out_Buffer,64);
		if(numBytesRead != 0) {
			memcpy(USB_In_Buffer,USB_Out_Buffer,64);
			putUSBUSART(USB_In_Buffer,numBytesRead);
		}
	}
	CDCTxService();
}</pre></li></ul>
<ul class="list1 list-indent1"><li>実際の応答部分は、最後の８行分のところだけです。</li>
<li>こちらのソースでは、受け取ったUSBパケットをそっくりそのままWindowsに返送しています。</li>
<li>なので、１フレーム時間(1mS)に複数個のパケット(64byteパケットが連続して、最後に64byte未満のパケットが来る)が送られてきてもそれをそっくりそのまま返送するので効率がよいのです。</li>
<li>（もちろん、バイト指向で再組み立てする方法でも64byte未満パケットに分断さえしなければスループットは低下しません。）</li></ul>
<p><br />
ビルド</p>
<ul class="list1 list-indent1"><li>Pinguinoコンパイラでビルドしますが、MchipのヘッダーとMchipのUSBアプリケーションフレームワークが必要です。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_4">ダウンロード<a class="anchor_super" id="b0bc3853" href="#b0bc3853" title="b0bc3853" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/upload/PIC/cdcscope.zip" rel="nofollow">cdcscope.zip</a>
<br /></li>
<li>このcdcscope.zipで生成されるHEXファイルはBOOTLOADERからの書き込みとPicKit2からの書き込みの両方に対応しています。</li>
<li>こういうふうになっています。</li></ul>
<pre>BFC0_0000+---------------+
         | Jmp _start    | &lt;=== RESETで最初に実行される命令
         |               |
         |               |
         |BOOTLOADERの一部|
         +---------------+

9D00_0000+---------------+
         | BOOTLOADER    | BOOTLOADERに重なっている部分はアプリでは使用しません。
         |               |
         |               |
         |               |
9D00_2000+---------------+
(_reset) | Jmp _start    | &lt;=== BOOTLOADERからの起動により最初に実行される命令
         | ============= |
         | 割り込みVECTOR|
         | ============= |
         |_start:初期化部|
         |               |
         |   アプリ本体  |
         |               |
9D00_7FFF+---------------+</pre>
<ul class="list1 list-indent1"><li>BFC0_0000からの16バイトだけが、BOOTLOADERとアプリケーションで重複しますが、</li>
<li>BOOTLOADERは9D00_2000〜9D00_7FFFの範囲内のみイレース、書き換えを行ない、それ以外の領域のHEXレコードを無視しますので、スタンドアローン、ブートローダー起動のどちらでも正しく起動します。</li></ul>
<p><br />
<br />
<br /></p>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_5">ベンチマーク結果<a class="anchor_super" id="q0f43147" href="#q0f43147" title="q0f43147" style="user-select:none;">&dagger;</a></h2>
<pre>E:\cdcscope&gt;w32term -c50 -t
Entering Benchmark: Escape=^A
..........................................................................................
..........................................................................................
......................................................................
Benchmark end. 32000 bytes/141 ms,  226950 bytes/s (2269500 bps)

E:\cdcscope&gt;</pre>
<ul class="list1 list-indent1"><li>スループットは毎秒226kB (実効ボーレートで2.26M BPS)になりました。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_6">USB - シリアル変換器 (Serial Emulator) を作る。<a class="anchor_super" id="jcf74f3e" href="#jcf74f3e" title="jcf74f3e" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>FTDI FT232RのようなUSB-シリアル変換器を作成します。</li>
<li>これは、MicroChipのUSBフレームワークのCDC Serial EmulatorをビルドすればＯＫです。</li>
<li>MX220F032B用に移植したものを用意しました。</li></ul>
<p><strong>ダウンロード</strong></p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/upload/PIC/cdcserial.zip" rel="nofollow">cdcserial.zip</a></li></ul>
<ul class="list1 list-indent1"><li>ブートローダー起動、PicKit2ライター直接書き込みの両対応HEXになっています。</li>
<li>Pinguinoのmips-gccとコマンドライン版Make(Pinguino付属)でビルドします。</li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_7">移植の手順についての説明<a class="anchor_super" id="gbc2be36" href="#gbc2be36" title="gbc2be36" style="user-select:none;">&dagger;</a></h2>
<p>（１）チップ品種の変換</p>
<ul class="list1 list-indent1"><li><span class="noexists"><a href="./?cmd=edit&amp;page=HardwareProfile&amp;refer=PIC32MX_USBCDC">HardwareProfile</a></span>.h というヘッダーが各品種ごとのヘッダーを選択的にincludeするようになっていますので、
<pre>HardwareProfile_MX220F032B.h</pre>
というヘッダーを用意して、それをインクルードするように書き換えます。</li>
<li>HardwareProfile_MX220F032B.hヘッダーにはMX220F032Bの自作基板にあわせたピン配置の定義を書きます。</li></ul>
<p><br />
（２）crt0.Sの用意</p>
<ul class="list1 list-indent1"><li>メモリー配置をブートローダー起動、PicKit2ライター直接書き込みの両対応にするためと、メモリー節約のために、少し改造したcrt0.Sを用意しています。</li>
<li>これは、ramfuncのコピーを省略してサイズを0x180 byte以下に抑え、割り込みベクターの手前に収まるサイズにしたものです。</li>
<li>ついでに、割り込みベクターから、割り込みハンドラーへのJmp命令も書き足しています。</li></ul>
<p><br />
（３）MakefileとObjs.makの用意。</p>
<ul class="list1 list-indent1"><li>Objs.makはリンクしたいモジュールを列挙したものです。</li></ul>
<p><br />
（４）main.cの改造</p>
<ul class="list1 list-indent1"><li>MchipのサンプルコードはPIC18FやLowPinCountPIC,PIC24F,dsPIC33など数多くの品種をカバーしているために、#ifdef〜#endifの嵐になっています。</li>
<li>これでは、あまりに見通しが悪いので、PIC32MX以外の記述は思い切って削除します。</li>
<li>つぎに、main()関数の先頭、かつ割り込みベクター設定があればその直後にそれを上書きする形で下記の記述を追加します。
<pre>_CP0_SET_EBASE(_RESET_ADDR); 	// 割り込みベクターを9D00_2000 に変更する.</pre></li>
<li>_RESET_ADDR はリンカースクリプトから供給されるシンボルラベルです。</li></ul>
<ul class="list1 list-indent1"><li>最後に、USBをポーリング実装でコンパイルするときに消滅する関数_USB1Interrupt()を補うための記述を入れます。
<pre>#if defined(USB_POLLING) 
	// for crt0.S vector dummy;
	// Dummy Function (Never Called)
	//
	void __attribute__((interrupt,nomips16,noinline)) _USB1Interrupt(){}
#endif</pre></li>
<li>これはcrt0.SからJmp命令で飛んでくる関数ですが、ポーリングモードでは実在しませんので、ダミーとしてここに置きます。実際には割り込みませんのでここに飛んでくることはないです。</li>
<li>（crt0.Sを毎回書き換えるのが面倒なのでＣレベルで対処）</li></ul>
   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="http://">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2014-11-17 (月) 14:44:26<span class="page_passage" data-mtime="2014-11-17T14:44:26+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
