<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>今後の目標 - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar">
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage">ＨＩＤａｓｐ高速化</a></li>
<li><strong><a href="Newest.html" title="Newest" class="link_page_passage">開発日記</a></strong> <a href="SiteMap.html" title="SiteMap" class="link_page_passage">ログ</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2024-06-21</strong>
<ul class="recent_list">
 <li><a href="SMRE3-81-AA-HDDE3-83-99-E3-83-B3-E3-83-81-E3-83-9E-E3-83-BC-E3-82-AF-.html" class="link_page_passage">SMRなHDDベンチマーク</a></li>
 <li><a href="20222D-08.html" class="link_page_passage">2022-08</a></li>
 <li><a href="UEFI_Basic.html" class="link_page_passage">UEFI_Basic</a></li>
</ul>
<strong>2024-06-20</strong>
<ul class="recent_list">
 <li><a href="Newest.html" class="link_page_passage">Newest</a></li>
 <li><a href="MenuBar.html" class="link_page_passage">MenuBar</a></li>
</ul>
<strong>2022-12-06</strong>
<ul class="recent_list">
 <li><a href="MSE3-82-A2-E3-82-AB-E3-82-A6-E3-83-B3-E3-83-88-E3-81-AE-WindowsE3-81-AE-CE3-83-89-E3-83-A9-E3-82-A4-E3-83-96-E3-82-92-E4-BF-AE-E5-BE-A9-E3-81-99-E3-82-8B-.html" class="link_page_passage">MSアカウントのWindowsのCドライブを修復する</a></li>
</ul>
<strong>2022-09-29</strong>
<ul class="recent_list">
 <li><a href="AndroidE3-81-AB-SSLE8-87-AA-E5-B7-B1-E7-BD-B2-E5-90-8D-E8-A8-BC-E6-98-8E-E6-9B-B8-E3-82-92-E5-85-A5-E3-82-8C-E3-82-8B-.html" class="link_page_passage">AndroidにSSL自己署名証明書を入れる</a></li>
</ul>
<strong>2022-08-31</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E9-80-9F-E5-BA-A6-E6-B8-AC-E5-AE-9A-E3-82-B5-E3-82-A4-E3-83-88-.html" class="link_page_passage">簡易速度測定サイト</a></li>
 <li><a href="E3-83-8D-E3-83-83-E3-83-88-E3-83-AF-E3-83-BC-E3-82-AF-BOOT.html" class="link_page_passage">ネットワークBOOT</a></li>
</ul>
<strong>2022-08-26</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E3-82-B3-E3-83-B3-E3-83-91-E3-82-A4-E3-83-AB-E3-83-99-E3-83-B3-E3-83-81-.html" class="link_page_passage">簡易コンパイルベンチ</a></li>
</ul>
<strong>2022-08-01</strong>
<ul class="recent_list">
 <li><a href="/ATMEL_AVR/html/" class="link_page_passage">FrontPage</a></li>
 <li><a href="20152D-04.html" class="link_page_passage">2015-04</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage">ＨＩＤａｓｐｘ</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage">ＨＩＤａｓｐ情報</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage">ＨＩＤａｓｐ</a></li>
 <li><a href="NEC78K.html" class="link_page_passage">NEC78K</a></li>
 <li><a href="AVRetc.html" class="link_page_passage">AVRetc</a></li>
 <li><a href="AVR_Monit.html" class="link_page_passage">AVR_Monit</a></li>
 <li><a href="20082D-08.html" class="link_page_passage">2008-08</a></li>
</ul>
<strong>2022-07-31</strong>
<ul class="recent_list">
 <li><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" class="link_page_passage">ＷｉｄｅＴｅｘｔ</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li class="selected" id="separate"><a href="">本文</a></li><li><a href="./?cmd=edit&amp;page=%E4%BB%8A%E5%BE%8C%E3%81%AE%E7%9B%AE%E6%A8%99">編集</a></li><li><a href="./?cmd=diff&amp;page=%E4%BB%8A%E5%BE%8C%E3%81%AE%E7%9B%AE%E6%A8%99">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">今後の目標</h1><div id="contentSub"></div>
    <p><del>今後の目標</del>というよりネタ帳</p>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage">ＨＩＤａｓｐ</a>の再現はうまくいった。</p>
<ul class="list1 list-indent1"><li>では、次は何を作りたい？
<ul class="list2 list-indent1"><li>とりあえずシリアルポートを作りたい。</li>
<li>実現方法としては
<ul class="list3 list-indent1"><li>ＣＤＣクラス（ＡＶＲ-ＣＤＣ）。ただし２５６バイト程度縮める必要がある。難しい。</li></ul></li></ul></li></ul>
<ul class="list3 list-indent3"><li>igorさんのような独自ドライバー（は自分では作れないのでたぶんigorさんの再現テストだけで終わると思う）方式</li>
<li>ＡＶＲ＿Ｍｏｎｉｔに埋め込む実装。---適当なコマンドでシリアルモードに突入する方式-普通のターミナルソフトが使えないのでＡＶＲ＿Ｍｏｎｉｔそのものを拡張して端末の代わりにする。--済</li></ul>
<ul class="list1 list-indent1"><li>ComEmulDrv経由のシリアル接続がうまくいきそうなので、やってみたい。--済
<ul class="list2 list-indent1"><li>これがうまくいけばＨ８ｗｒｉｔｅ.ｃを動かしてＨ８／３０４８Ｆのファーム書き換えが出来るかも。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>旧型ＡＤＢバス接続のAppleキーボードをＡＴ互換機（ＰＳ２バスかＵＳＢ）に繋ぎたい。</li></ul>
<ul class="list1 list-indent1"><li>ＰＣ８８０１のジャンクキーボードをＡＴ互換機に繋ぎたい。</li></ul>
<ul class="list2 list-indent2"><li>なんでそんな欲求があるのかと言えば、実は１０１（１０４でも良い）英語キーが地方のＰＣショップではもう入手できなくなってるから。</li></ul>
<ul class="list1 list-indent1"><li>壊れたＰＣＩカードから取り外した水晶を使ってＡＶＲ　ＵＳＢを動かしたい。
<ul class="list2 list-indent1"><li>豊富（？）にあるのが、２５ＭＨｚ（壊れた１００ＢＡＳＥのＮＩＣから外したもの）</li>
<li>ＡＴｔｉｎｙ２３１３では少しオーバークロックになる。</li>
<li>これで動かせるとめっぽう速い。（<strong>だから何なんだ？</strong>）</li>
<li>２５だと三倍オーバートーン発振なんだろうなぁ・・・・発振するかなぁ・・・不安だ。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>トラ技付録だったＦＰＧＡ評価基板にAVRコアみたいなのを突っ込んで９６ＭＨｚ駆動させると
<strong>LowSpeedでない</strong>ＳＯＦＴ　ＵＳＢが出来るかも（無理かも）
<ul class="list2 list-indent1"><li>そんなことするよりも素直にＵＳＢのＩＰを書き込んじゃったほうが良い？</li></ul></li></ul>
<hr class="full_hr" />
<p>ＰｏｗｅｒＳｗｉｔｃｈ</p>
<ul class="list1 list-indent1"><li><a href="http://www.obdev.at/products/avrusb/index.html" rel="nofollow">ＡＶＲＵＳＢ</a>のページにある、もっとも基本のアプリだ。</li>
<li>８つのスイッチ（ＬＥＤ）をＵＳＢから個別にＯｎ/Ｏｆｆ出来る。（専用のコマンドラインツールにて）</li>
<li>サイズは他と比べて小さいので、ｔｉｎｙ２３１３に焼いても空きエリアが２５６バイトくらいある。</li>
<li><strong>一応動作確認までＯＫ。</strong></li>
<li>ただし、コントロール転送でＳｗの値を転送している。</li>
<li>１０００回送るのに３秒くらい掛かるような気がする。</li>
<li>１回のパケットはＬｏｗＳｐｅｅｄでは最大８バイトなので８Ｋバイト送り込むのに３秒掛かっているわけだ。</li>
<li>逆算で、２ｋ弱／秒くらいしか転送出来ない？？？ＵＳＢってそんなに遅いのか</li></ul>
<hr class="full_hr" />
<p>ＨＩＤｋｅｙｓ</p>
<ul class="list1 list-indent1"><li><a href="http://www.obdev.at/products/avrusb/hidkeys.html" rel="nofollow">ＨＩＤｋｅｙｓ</a>
を試してみた。</li>
<li>これはＵＳＢキーボードと等価な動作をするデバイスだ。</li>
<li>キーボード、マウス、ＧａｍｅＰａｄといった人用対話型入力インターフェース（ＨＩＤ）クラスはマイクロソフトが定義したクラスなので専用デバイスドライバーがなくてもＷｉｎｄｏｗｓの標準デイバスドライバーが対応する。</li>
<li>つまり、デバイスドライバーの組み込みが不要なのだ。
<br /></li>
<li>ａｔｍｅｇａだったので、ｔｉｎｙ２３１３に書き換え。</li>
<li>タイマー０のプリスケーラーレジスタ名がすこし変わっていた。変更。</li>
<li>PortCは無いので削除。</li>
<li>USB接続ポートを変更。</li>
<li>実際にスイッチは繋がなかったが、ちゃんと動いたようだ。</li>
<li>改造crt.Sを使うと、
<pre>./checksize main.bin
ROM: 1828 bytes (data=4)
RAM: 61 bytes</pre>
なので、サイズ的には200バイトくらい余裕。</li>
<li>INPUTエンドポイント１は使っているみたい。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>これの応用で、ＣＴＲＬとＡＬＴとＤＥＬだけが付いたＳｗとか。</li>
<li>ＵＳＢメモリーに見せかけて、ＵＳＢに繋がれた瞬間にリセットとかＰｏｗｅｒＯｆｆを送り込む極悪ＵＳＢｋｅｙ。</li>
<li>一定時間ごとに無駄キーとかマウスムーブを送ってＰＣをスクリーンセーバーモードにしないキー。（これって、何に使うんだっけ？）</li>
<li>普通にＵＳＢＪｏｙＰａｄは作れるよな。うん。</li></ul>
<hr class="full_hr" />
<p><a href="http://www.recursion.jp/usbsfr/index.html" rel="nofollow">ＵＳＢ−ＳＦＲ</a></p>
<ul class="list1 list-indent1"><li>ＣＤＣクラスで仮想ＣＯＭポートをつくって、実際にはＲＳ２３２にせずにＡＶＲ内部の対話シェル（？）でＡＶＲ制御が出来るといった感じ？（で良い？）</li>
<li>当然ｔｉｎｙ２３１３には入らないコードサイズ。</li>
<li>だが、ＳＲＡＭサイズは足りている。</li></ul>
<p>だいぶ改造に慣れたのでｔｉｎｙ２３１３に入れるテスト</p>
<ul class="list1 list-indent1"><li>対話シェルのコマンドインタープリタをばっさり削る。</li>
<li>当然crt.Sで圧縮。</li>
<li>これでも、コードは足りたがデータを含めると２０４８を越える。</li>
<li>しかたなく、watchDogを削る。</li></ul>
<ul class="list1 list-indent1"><li>肝心の対話シェルは使えないが、ＣＤＣクラスとしてＷｉｎｄｏｗｓに認識させることは出来た。</li>
<li>ＣＯＭ３という仮想ポートが出来ていて、teratermから接続できた。</li>
<li>ＵＳＢスニファ <a href="http://sourceforge.net/projects/usbsnoop/" rel="nofollow">SnoopyPro</a> を使って、teratermとＡＶＲ間の交信が行われていることを確認した。
<br /></li>
<li>単なる仮想ＣＯＭポートのエコーバックサーバーならぎりぎり入る（？）かも
<ul class="list2 list-indent1"><li>やってみた。うそくさいがエコーバック出来た。速度は秒間８ｋＢで頭打ち。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>仮想ＣＯＭまで作らずに、ＨＩＤａｓｐのようにベンダーユニークのコントロール転送でコマンドを送り、ＡＶＲライターとしてではなく自分のＩＯポートの制御をさせることくらいならすぐにでも出来そうだ。</li>
<li>欠点は制御が１０ｍＳ単位になること。（なんで？）</li>
<li>１０ｍＳ毎にコマンドも含め８バイト送受することまでならＨＩＤクラスで十分だ。</li></ul>
<hr class="full_hr" />
<p>もうひとつ別のアイディア</p>
<ul class="list1 list-indent1"><li>ｔｉｎｙ２３１３をペアにした基板を用意して、ＡＴｍｅｇａ用の<a href="http://www.obdev.at/products/avrusb/bootloadhid.html" rel="nofollow">ＢｏｏｔＬｏａｄｅｒ</a>もどきをやる。</li>
<li>つまり、ａｓｐ不要の（というか自己書き換えな）ＵＳＢデバイスに近い。</li></ul>
<ul class="list1 list-indent1"><li>片方はＨＩＤａｓｐ兼低速ＵＳＢ　Ｉ/Ｆであり、もう片方はａｓｐに常に繋がれて何時でも焼けるターゲットみたいな感じ。焼かないときは自律して動作してＵＳＢでＰＣと交信可能だ。</li></ul>
<ul class="list1 list-indent1"><li>ＣｈａＮさんのシリアルポートのＩＳＰなら、ＡＶＲが自律動作中はそのままシリアルコンソールになりうるので、（シリアルが使えるパソコンとＩＳＰがあるのならば、）わざわざ作るかという話もある。</li></ul>
<ul class="list1 list-indent1"><li>ＡＴｍｅｇａの手持ちがあるのなら、わざわざｔｉｎｙ２３１３を２個実装することもなかろう。
（<strong>無いけど</strong>）</li></ul>
<hr class="full_hr" />
<p>igorさん（スロバキアの人）のＵＳＢ to ＲＳ２３２というやつを拝見した。</p>
<ul class="list1 list-indent1"><li>tiny2313で57600bpsを実現している。これは約８ＫＢ／秒だ。</li>
<li>ＵＳＢの１フレームは１ｍＳであり、ＬｏｗＳｐｅｅｄの最大パケットは８バイトなので、単純に考えると８ｋＢ／秒。</li>
<li>だが、ポーリング周期を１０ｍＳにしているとこの１／１０になるので８００バイト／秒（６４００ボー？？？暴れるぞコラ！ＵＳＢテメー１.５Ｍｂｐｓなんじゃなかったのか！￥バキッ）</li>
<li>igorさんのは、Windowsカーネルドライバーで仮想シリアルを実現している。だから速い？libusbではだめなのか？（不明）</li>
<li>ＵＳＢ２.０ ＰＤＦを見ると、１フレームに８バイトのインタラプト転送は最大６個、有意バイト数で４８バイトと書いてあるように見える（Table 5-6）のだが、目が悪いのか俺。</li>
<li>その後ろに、１２Ｍｂｐｓのフルスピードではインタラプト転送の周期は1〜255mSだが、ＬｏｗＳｐｅｅｄ
の場合10〜255mSになると書かれている。詐欺だー。</li>
<li>で、igorさんはどうやって高速化したのだろう。Windowsのドライバーは難しくてさっぱり訳が分からん。</li></ul>
<hr class="full_hr" />
<p>インタラプト転送のテストプログラム</p>
<ul class="list1 list-indent1"><li>速度計測</li></ul>
<hr class="full_hr" />
<p>独自ＵＳＢシリアルとＷｉｎｄｏｗｓ側クライアントの作成。</p>
<ul class="list1 list-indent1"><li>ＣＤＣが容量的に無理くさいので、独自で試す。</li>
<li>Ｗｉｎｄｏｗｓ版シリアルドライバーは作成可能か？</li></ul>
<hr class="full_hr" />
<h3 id="content_1_0">バルク転送のテストプログラム<a class="anchor_super" id="l07b1d63" href="#l07b1d63" title="l07b1d63" style="user-select:none;">&dagger;</a></h3>
<ul class="list1 list-indent1"><li><del>かなり無理そう</del>・・・。
<br /></li>
<li>実はUSB-Sfrのスケルトンを改造してＣＤＣではないベンダユニークなデバイスを作って速度計測をしてみた。
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">１回の送信バイト数</td><td class="style_td">コントロールWrite速度</td><td class="style_td">バルクWrite速度</td><td class="style_td">バイト数／フレーム</td></tr>
<tr><td class="style_td">８バイト</td><td class="style_td">８ｋバイト／秒</td><td class="style_td">８ｋバイト／秒</td><td class="style_td">８</td></tr>
<tr><td class="style_td">１６バイト</td><td class="style_td">１６ｋバイト／秒</td><td class="style_td">１６ｋバイト／秒</td><td class="style_td">１６</td></tr>
<tr><td class="style_td">３２バイト</td><td class="style_td">３２ｋバイト／秒</td><td class="style_td">３２ｋバイト／秒</td><td class="style_td">３２</td></tr>
<tr><td class="style_td">６４バイト</td><td class="style_td">３２ｋバイト／秒</td><td class="style_td">３２ｋバイト／秒</td><td class="style_td">３２</td></tr>
<tr><td class="style_td">１２８バイト</td><td class="style_td">４２.６ｋバイト／秒</td><td class="style_td">４２.６ｋバイト／秒</td><td class="style_td">４２</td></tr>
<tr><td class="style_td">２５６バイト</td><td class="style_td">４２.６ｋバイト／秒</td><td class="style_td">４２.６ｋバイト／秒</td><td class="style_td">４２</td></tr>
<tr><td class="style_td">５１２バイト</td><td class="style_td">４６.５ｋバイト／秒</td><td class="style_td">４６.５ｋバイト／秒</td><td class="style_td">４６</td></tr>
<tr><td class="style_td">１０２４バイト</td><td class="style_td">４６.６ｋバイト／秒</td><td class="style_td">４６.６ｋバイト／秒</td><td class="style_td">４６</td></tr>
</tbody></table></div>
なんだ。速いじゃん。<strong>ＬｏｗＳｐｅｅｄ</strong>でも</li>
<li>インタラプト転送はENDPOINT3がそれに相当するのだが、正しくハンドシェイクできていないようで、うまく動作してくれない。
<ul class="list2 list-indent1"><li>ＣＤＣクラスでは、ＲＳ２３２のステータス転送に使っているような気がする。</li></ul></li>
<li>ＬｏｗＳｐｅｅｄの物理的な速度は１.５Ｍｂｐｓ（約１８０ｋＢ／秒）だが、わずか８バイトのペイロードに対して、ＳＹＮＣ、ヘッダー、ビットスタッフ、ＣＲＣ等オーバヘッドのほうがむしろ大きいのでまあ５０ｋＢも出るなら<strong>御の字</strong>なのかもしれない。</li></ul>
<ul class="list1 list-indent1"><li>８バイト以上のパケットを送って計測したが、まだ本当に正しく転送されているかは調べていない。<strong>データがこけてたら悲すい</strong>・・・。</li></ul>
<p><br />
エンドポイント・デスクリプタをbulkからinterruptに変えて、同様のテスト
を行ってみた。</p>
<ul class="list1 list-indent1"><li>interrupt転送ではインターバルが10mS固定になっている。</li>
<li>ＣＤＣのENDPOINT3インターバルが2mSだったので、真似をしてみたが10mSより短くはならない。</li>
<li>それどころか、パケット長を増やすと応答時間が反比例して遅くなる。どうせ最大ペイロードは８バイトなので、ほんとに１０ｍＳに８バイトのパケットしか送らないようになっているようだ。</li>
<li>つまり、転送速度は１ｋＢ／秒に固定されている。（８００バイトでないのが不思議だが・・・なんらかの帯域制限に掛かったような感じ）</li></ul>
<p>これらの計測が正しいとしたら</p>
<ul class="list1 list-indent1"><li>ＬｏｗＳｐｅｅｄで帯域を稼ぎたいならコントロール転送かバルク転送が有利。</li>
<li>インタラプト転送はクソ。</li>
<li>但し、ＬｏｗＳｐｅｅｄでのバルク転送はＵＳＢ１.１規格違反なので現在のＷｉｎｄｏｗｓＸＰ以外で動く保障は無い。
<ul class="list2 list-indent1"><li>Ｌｉｎｕｘではカーネルパッチが必要らしい。</li></ul></li>
<li>コントロールWriteとバルクWriteはほぼ同じ速度が出る。
<ul class="list2 list-indent1"><li>しかも１回の転送長を３２バイトくらいにすればそこそこ速度は出る。</li>
<li>問題はＡＶＲのＲＡＭが少ないこと、か。</li></ul></li></ul>
<hr class="full_hr" />
<p>ＡＶＲ−ＣＤＣ</p>
<ul class="list1 list-indent1"><li>ｔｉｎｙ２３１３でＵＳＢシリアルに挑戦。</li>
<li>ＡＴＭＥＧＡ８では可能（というか公開されている）</li>
<li>ｔｉｎｙでやるにはコードサイズを２５６バイト以上縮める必要がある。</li></ul>
<p>そのまえに、基本的なインタラプト転送が出来るようにしたい。</p>
<hr class="full_hr" />
<p>バルク転送のテストプログラムその２</p>
<ul class="list1 list-indent1"><li>同じベンチマークをインテル８６５／Pen4のマザーでやってみたら、遅いことに気づいた。
<div class="ie5"><table class="style_table" cellspacing="1" border="0"><tbody><tr><td class="style_td">１回の送信バイト数</td><td class="style_td">コントロールWrite速度</td><td class="style_td">バルクWrite速度</td><td class="style_td">バルクバイト数／フレーム</td></tr>
<tr><td class="style_td">８バイト</td><td class="style_td">２ｋバイト／秒</td><td class="style_td">４ｋバイト／秒</td><td class="style_td">４</td></tr>
<tr><td class="style_td">１６バイト</td><td class="style_td">３.２ｋバイト／秒</td><td class="style_td">８ｋバイト／秒</td><td class="style_td">８</td></tr>
<tr><td class="style_td">３２バイト</td><td class="style_td">４.５ｋバイト／秒</td><td class="style_td">１５.８ｋバイト／秒</td><td class="style_td">１６</td></tr>
<tr><td class="style_td">６４バイト</td><td class="style_td">５.８ｋバイト／秒</td><td class="style_td">２１.３ｋバイト／秒</td><td class="style_td">２１</td></tr>
<tr><td class="style_td">１２８バイト</td><td class="style_td">６.７ｋバイト／秒</td><td class="style_td">２５.２ｋバイト／秒</td><td class="style_td">２５</td></tr>
<tr><td class="style_td">２５６バイト</td><td class="style_td">７.３ｋバイト／秒</td><td class="style_td">２８ｋバイト／秒</td><td class="style_td">２８</td></tr>
<tr><td class="style_td">５１２バイト</td><td class="style_td">７.６ｋバイト／秒</td><td class="style_td">２９.８ｋバイト／秒</td><td class="style_td">３０</td></tr>
<tr><td class="style_td">１０２４バイト</td><td class="style_td">７.８ｋバイト／秒</td><td class="style_td">３０.８ｋバイト／秒</td><td class="style_td">３１</td></tr>
</tbody></table></div>
だめじゃんＵＨＣＩ。</li>
<li>ちなみに前のテストで使ったマザーはＳｉＳ７４６Ｆ／Ｂａｒｔｏｎ１.８ＧＨｚ</li>
<li>どちらのテストも、マザボのバックパネルのＵＳＢコネクタを使用。ハブなし。ＯＳはＷｉｎＸＰで、ＯＳ環境はほぼ同じ。</li>
<li>これを見た感じでは、ＵＳＢは遅くて使い物にならない。<strong>秒間２ｋ〜４ｋＢでどうせいと</strong></li>
<li>なぜＯＨＣＩと比べて４倍以上も違うのか？特にコントロール転送遅いぞ！。</li>
<li>そもそもＵＳＢ２.０なんだからＥＨＣＩじゃなかったのかと小一時間。</li></ul>
<p>いろいろマザーを変えて試すしかないのか俺。</p>
<ul class="list1 list-indent1"><li>がびーん、Ｐ４Ｍ８９０Ｔ（ＶＩＡ）も遅かった。ｉ８６５と大体同じ傾向。</li></ul>
<ul class="list1 list-indent1"><li>もれなくインタラプト転送は常に１ｋ/Ｓだが。</li>
<li>このままでは、ここは<del>規格</del><strong>企画倒れ</strong>やー。</li></ul>
<p>ＶＩＡ ＫＭ４００Ａで試してみた。</p>
<ul class="list1 list-indent1"><li>上と大体同じだ。</li>
<li>駄目押しで、ｉ８１５（河童セレ）でも試してみた。まあインテルは皆一緒か。</li>
<li>結論：速いのはＳｉＳだけだった。</li></ul>
<p><span style="font-size:28px">ＬｏｗＳｐｅｅｄ終了</span></p>
<hr class="full_hr" />
<p>もうＬｏｗＳｐｅｅｄには飽きた。</p>
<ul class="list1 list-indent1"><li>コントロール転送を１ｍｓに１回処理できないようなら見切りをつけるしかない。</li>
<li>ＳｉＳ以外の大多数のＵＨＣＩでは４ｍｓに１回らしい。</li>
<li>規格外のＢｕｌｋで速度を稼ぐという手もあるが、それでも最大３０ｋＢ／秒くらい。</li>
<li>Ｂｕｌｋ受信がまだうまくいっていない。</li>
<li>Ｂｕｌｋ送信のバリデーションもまだだ。
<br />
<br />
<br />
<br />
<br />
と書いたが、まだやっている。</li>
<li>ターゲットをBulkに絞って、転送ルーチンを整理。</li>
<li>Win32側のベンチマークと連動させ、bulk-read とbulk-writeの速度計測。</li>
<li>おなじく、転送データのバリデーションもぼちぼち。</li></ul>
<ul class="list1 list-indent1"><li>ＡＶＲ側のサイズはコード＝1684bytes ＳＲＡＭ＝66byteまで縮めた。</li>
<li>代償にinterrupt転送とcontrolのベンダーユニーク処理を全部カット。
<ul class="list2 list-indent1"><li>問題は・・・bulk-read / write は非同期なのでハンドシェークには使えないってことが発覚。</li>
<li>ＲＳ２３２ＣのTx/Rxと同じやね。</li></ul></li></ul>
<hr class="full_hr" />
<p>ＵＳＢ以外に目を向けよう。</p>
<ul class="list1 list-indent1"><li>周波数カウンタ。（これは割りと簡単らしい）</li>
<li>ＲＣ計（デジタルテスターもどき）</li>
<li>時計。温度計。</li>
<li>赤外線リモコン。トランシーバー。</li>
<li>ＬＥＤゲーム。</li>
<li>電子オルゴール。電子ピアノ。</li>
<li>ＵＳＢ-ＭＩＤＩアダプタ。</li>
<li>ＭＩＤＩオルゴール。</li>
<li>ＳＤカードとの接続。</li></ul>
<ul class="list1 list-indent1"><li>液晶ドライバー。（Ｈ８のキットに付いてきた奴がまだ残っている）</li>
<li>データロガー。１秒間に１００サンプル以下とかならＵＳＢでも行けるか。</li>
<li>簡易オシロ、簡易ロジアナ。これもＵＳＢだと無理くさいが・・・。</li>
<li>ＵＳＢ-ＣＤＣは、結局ｔｉｎｙ２３１３にやらせないほうがよいのか、それともigorさんのやつを試すべきか？</li></ul>
<hr class="full_hr" />
<p>目次</p>
<div class="contents">
<a id="contents_1"></a>
<ul class="list2 list-indent1"><li><a href="#l07b1d63">バルク転送のテストプログラム</a></li></ul>
</div>

   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="http://">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2007-10-27 (土) 23:01:36<span class="page_passage" data-mtime="2007-10-27T23:01:36+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
