<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>2007-09 - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar">
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage">ＨＩＤａｓｐ高速化</a></li>
<li><strong><a href="Newest.html" title="Newest" class="link_page_passage">開発日記</a></strong> <a href="SiteMap.html" title="SiteMap" class="link_page_passage">ログ</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2024-06-26</strong>
<ul class="recent_list">
 <li><a href="Newest.html" class="link_page_passage">Newest</a></li>
 <li><a href="20222D-08.html" class="link_page_passage">2022-08</a></li>
 <li><a href="20242D-07.html" class="link_page_passage">2024-07</a></li>
</ul>
<strong>2024-06-21</strong>
<ul class="recent_list">
 <li><a href="SMRE3-81-AA-HDDE3-83-99-E3-83-B3-E3-83-81-E3-83-9E-E3-83-BC-E3-82-AF-.html" class="link_page_passage">SMRなHDDベンチマーク</a></li>
 <li><a href="UEFI_Basic.html" class="link_page_passage">UEFI_Basic</a></li>
</ul>
<strong>2024-06-20</strong>
<ul class="recent_list">
 <li><a href="MenuBar.html" class="link_page_passage">MenuBar</a></li>
</ul>
<strong>2022-12-06</strong>
<ul class="recent_list">
 <li><a href="MSE3-82-A2-E3-82-AB-E3-82-A6-E3-83-B3-E3-83-88-E3-81-AE-WindowsE3-81-AE-CE3-83-89-E3-83-A9-E3-82-A4-E3-83-96-E3-82-92-E4-BF-AE-E5-BE-A9-E3-81-99-E3-82-8B-.html" class="link_page_passage">MSアカウントのWindowsのCドライブを修復する</a></li>
</ul>
<strong>2022-09-29</strong>
<ul class="recent_list">
 <li><a href="AndroidE3-81-AB-SSLE8-87-AA-E5-B7-B1-E7-BD-B2-E5-90-8D-E8-A8-BC-E6-98-8E-E6-9B-B8-E3-82-92-E5-85-A5-E3-82-8C-E3-82-8B-.html" class="link_page_passage">AndroidにSSL自己署名証明書を入れる</a></li>
</ul>
<strong>2022-08-31</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E9-80-9F-E5-BA-A6-E6-B8-AC-E5-AE-9A-E3-82-B5-E3-82-A4-E3-83-88-.html" class="link_page_passage">簡易速度測定サイト</a></li>
 <li><a href="E3-83-8D-E3-83-83-E3-83-88-E3-83-AF-E3-83-BC-E3-82-AF-BOOT.html" class="link_page_passage">ネットワークBOOT</a></li>
</ul>
<strong>2022-08-26</strong>
<ul class="recent_list">
 <li><a href="E7-B0-A1-E6-98-93-E3-82-B3-E3-83-B3-E3-83-91-E3-82-A4-E3-83-AB-E3-83-99-E3-83-B3-E3-83-81-.html" class="link_page_passage">簡易コンパイルベンチ</a></li>
</ul>
<strong>2022-08-01</strong>
<ul class="recent_list">
 <li><a href="/ATMEL_AVR/html/" class="link_page_passage">FrontPage</a></li>
 <li><a href="20152D-04.html" class="link_page_passage">2015-04</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage">ＨＩＤａｓｐｘ</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage">ＨＩＤａｓｐ情報</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage">ＨＩＤａｓｐ</a></li>
 <li><a href="NEC78K.html" class="link_page_passage">NEC78K</a></li>
 <li><a href="AVRetc.html" class="link_page_passage">AVRetc</a></li>
 <li><a href="AVR_Monit.html" class="link_page_passage">AVR_Monit</a></li>
 <li><a href="20082D-08.html" class="link_page_passage">2008-08</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li class="selected" id="separate"><a href="">本文</a></li><li><a href="./?cmd=edit&amp;page=2007-09">編集</a></li><li><a href="./?cmd=diff&amp;page=2007-09">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">2007-09</h1><div id="contentSub"></div>
    <p><a href="E3-81-AB-E3-81-A3-E3-81-8D-.html" class="link_page_passage">にっき</a></p>
<p><a href="20072D-08.html" class="link_page_passage">2007-08</a></p>
<p>開発日記</p>
<hr class="full_hr" />
<h4 id="content_1_0">ぱどさんからの情報<a class="anchor_super" id="t428b35d" href="#t428b35d" title="t428b35d" style="user-select:none;">&dagger;</a></h4>
<p>＞ところでAVR-USBのスループット向上ですがホストとデバイス間にHi-SpeedUSBハブを挿んでみてはいかがでしょう？</p>
<p>＞ホストからはHSのハブに転送させてハブにHSからLSにTTさせてみると速くなったりしませんでしょうか。</p>
<ul class="list1 list-indent1"><li>確かに速くなりました。</li>
<li>コントロール転送が１５ｋＢ／秒になります。（ＳｉＳと比べて２倍、ｉｎｔｅｌ、ＶＩＡと比べて８倍速くなった）</li>
<li>ホストコントローラの種類に拠らず速くなります。</li>
<li>ＬｏｗＳｐｅｅｄバルク転送がうまくいきません。原因はまだわかりません。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>ＨＳハブをＰＣ（ＥＨＣＩホスト）とＡＶＲの間に挟むことで、どうやらマイクロフレーム（125μＳ単位でのトランザクション：スプリットトランザクション？）が使用可能になるようです。</li></ul>
<p><strong>これは美味しいかも</strong></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_1">ＵＳＢハブ実験<a class="anchor_super" id="kb2d0350" href="#kb2d0350" title="kb2d0350" style="user-select:none;">&dagger;</a></h4>
<p>ＡＶＲ-ＣＤＣ改（最小限のＣＤＣでエコーバックのみを行うもの）を試してみた。</p>
<ul class="list1 list-indent1"><li>ＵＳＢ１.１ハブに繋いだ場合はＣＯＭ３：になり、teratermでエコーバック出来た。</li>
<li>ＵＳＢ２.０ハブに繋いだ場合はＣＯＭ５：になり、teratermで接続は出来るもののエコーバックが帰ってこない。</li>
<li>やはりＬｏｗＳｐｅｅｄバルクが殺されているような気がする。
<ul class="list2 list-indent1"><li>ってやっぱりＳｎｏｏｐｙを動かして試さなきゃ！</li></ul></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_2">AVR_term<a class="anchor_super" id="qf50a535" href="#qf50a535" title="qf50a535" style="user-select:none;">&dagger;</a></h4>
<p>ここまで作った。</p>
<pre>bash ./checksize main.bin
ROM: 1696 bytes (data=6)
RAM: 95 bytes</pre>
<ul class="list1 list-indent1"><li>コントロール転送のみを使う。</li>
<li>エンドポイントなし。</li>
<li>EEPROMのread/writeを削除したモニタをそのまま残す。</li>
<li>最大４バイトの送信データを送信し、最大７バイトの受信データを受け取る。</li>
<li>ＰＣ側では簡単な送受テストを動作。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>サイズ的には余裕のよっちゃん、なのでigorさんのと同じようにirdaとか追加できそう。</li>
<li>monitに仕込んでおいたポート内容のダンプ機能がデバッグに思いのほか役立った。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_3">ToDo<a class="anchor_super" id="qef73068" href="#qef73068" title="qef73068" style="user-select:none;">&dagger;</a></h3>
<ul class="list1 list-indent1"><li><del>受信FIFOの正しい扱い</del> 済み</li>
<li><del>送信FIFOのFULLチェック</del> 済み</li>
<li><del>受信割り込みでの割り込み許可ポイント</del> 今のところポーリングで受信しているので不要</li>
<li><del>ボーレート設定</del> 済み</li></ul>
<ul class="list1 list-indent1"><li><del>送受テストばかりしてないでterminalとして動作させる</del> 済み</li>
<li>仮想com：のエコーバックを使用してcomポートに見せかける</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_4">ＵＳＢｔｏシリアルが出来た。<a class="anchor_super" id="x6683358" href="#x6683358" title="x6683358" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>これでやっと、昔作ってずっと放置していたＡＫＩ-Ｚ８０やらＳｕｐｅｒ-ＡＫＩ
をＵＳＢ接続出来るぞ、っと。</li>
<li>ジャンク箱をあさって、Ｚ８０なボードを掘り出した。</li></ul>
<p><a href="/ATMEL_AVR/upload/aki80.jpg" rel="nofollow"><img src="/ATMEL_AVR/upload/aki80.jpg" alt="/ATMEL_AVR/upload/aki80.jpg" /></a></p>
<ul class="list1 list-indent1"><li>なんか、珍しい石英ガラス窓付きのチップが載っているぞ！</li>
<li>これが、おとぎ話に出てくる紫外線消去型ＥＰ-ＲＯＭってやつか？</li></ul>
<p><strong>どうする、おい</strong></p>
<ul class="list1 list-indent1"><li>ＲＯＭライター持ってないぞ。</li></ul>
<p>ここからさらに強引な展開</p>
<ul class="list1 list-indent1"><li>ＡＶＲでＲＯＭライターを作る。
<ul class="list2 list-indent1"><li>いまさらＲＯＭライターかよ。</li></ul></li>
<li>多ピン品種のＡＶＲで２７Ｃ２５６っぽいＲＯＭの真似をする。
<ul class="list2 list-indent1"><li>ATMEGA644-DIP40があれば可能だ。</li>
<li>しかし、本末転倒ではないか？</li>
<li>ATMEGA644-DIP40があればＺ８０なんかいらんだろ？</li></ul></li></ul>
<p>部品が乗る前の写真（秋月）
<a href="http://img.akizukidenshi.com/images/org/k-123.jpg" rel="nofollow"><img src="http://img.akizukidenshi.com/images/org/k-123.jpg" alt="http://img.akizukidenshi.com/images/org/k-123.jpg" /></a></p>
<ul class="list1 list-indent1"><li>もちろん、ＥＰＲＯＭは載っていない。あとで載せたものだ。</li>
<li>いまさらＺ８０アセンブラかよ。
<ul class="list2 list-indent1"><li>（ＬＳＩ−Ｃってのも昔あったけれど、雑誌付録にいつも付いていてフリーなやつはＬＳＩ−Ｃ<strong>８６</strong>のほうだ）</li></ul></li>
<li>これ１枚買うのも結構高かったよ（現在も入手できる。３０００円）</li>
<li>今なら迷わずATMEGA644-DIP40を３個買う。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_5">仮想ＣＯＭエコーバックポートに対応中<a class="anchor_super" id="tf080109" href="#tf080109" title="tf080109" style="user-select:none;">&dagger;</a></h4>
<p>ここまで書いた。</p>
<ul class="list1 list-indent1"><li>CommEmuDrvをＤＬしてインストール。</li>
<li>ＣＯＭ５：とＣＯＭ９：を仮想ポートペア(エコーバック対)として作成。</li>
<li>AVRterm.exeを改造したcomm.exe で、ＣＯＭ９を開く。
<br /></li>
<li>ＣＯＭ９：から受け取ったデータはＡＶＲに流す。</li>
<li>ＡＶＲからの受信データをＣＯＭ９：に流す。
<br />
こうすることで、ＣＯＭ５：に接続したteratermは、ＡＶＲのシリアルポートに繋がったことと等価になる（予定）</li></ul>
<ul class="list1 list-indent1"><li>一応書いてみた。</li>
<li>一応動いたが・・・ごにょごにょ・・・反応が２Ｖ、じゃなかった鈍い。</li>
<li>キーをバタバタ打った後で１秒くらい置いて、ドカドカっと文字が帰ってくる。</li></ul>
<p><strong>なんで？</strong></p>
<ul class="list1 list-indent1"><li>どうやらＡＶＲ側はシロだ。</li>
<li>ＡＶＲと交信せずに、ＷＩＮ３２内で完結するエコーバックを書いて回しても反応は同じ。</li>
<li>ところがWriteFile(Ex)せずに直接printfする場合はすんなりと速い。</li>
<li>COM9:に対するWriteFile(Ex)が発生すると長時間(0.5秒くらい)待たされているような感じだ。</li>
<li>これは同一ファイルハンドルCOM9を使ったReadFileExとWriteFileが競合するパターンのようだ。</li>
<li>単体テストのときはうまく回避する術を見つけたような気がしたのだが・・・（気がしただけだったのか？）</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_6">この、どうしようもない閉塞感は何なんだ・・・<a class="anchor_super" id="o0975369" href="#o0975369" title="o0975369" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li><strong>ＡＫＩ−Ｈ８/３０４８Ｆ</strong>とそのライターボードをジャンク箱から発掘。</li>
<li>ＵＳＢにつなげてやろうと思った。</li>
<li>あれ？何これ？１２Ｖいるやん。</li>
<li>２００ｍＡだと？大飯食いめ！</li>
<li>とりあえず通電してみた。動かない。なんで？ＦＬＡＳＨ消えたのか？</li>
<li>まあよい、開発環境は残っているかな？うーんＷｉｎ９５以前かな？だめだこりゃ。</li>
<li>ＲＳ２３２Ｃが２５ＰＩＮ　ＤーＳＵＢだ（ＰＣ９８仕様）</li></ul>
<p>というか最密充填両面印刷で７００ページもあるＨＩＴＡＣＨＩのマニュアルは何なんだろう。</p>
<ul class="list1 list-indent1"><li>たしかに機能てんこ盛り。</li>
<li>いちいちアセンブラでコーディングしろと・・・。</li>
<li>複雑すぎるんだよなー。このＨ８は。その割遅い。</li>
<li>手間掛かりすぎるんだよなー。１２Ｖ要るし。</li>
<li>まあ、当時ワンチップで１２８ＫのＦＬＡＳＨが乗っているマイコンは他になかったような気がするが。</li>
<li>もう、いまさら使おうとは思わないんだよなー。</li>
<li>ＡＶＲに繋ぐのめんどくせーなー。やめよっかなー。</li></ul>
<p>日の丸マイコンが凋落の日々となった理由の一端がすこしわかったような気がする。</p>
<ul class="list1 list-indent1"><li>だせーんだよ。何もかもが。</li></ul>
<p>そう、いまさらＨ８を復活させて何か作ろうというわけではない。</p>
<ul class="list1 list-indent1"><li>単に動態保存したいだけなんだ。</li>
<li>ビンテージパソコンコレクターと同じだな。</li></ul>
<ul class="list1 list-indent1"><li>あと、コンパイラー揃えるの面倒だなー。<strong>ＡＶＲだけでいいや</strong>もう。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_7">仮想ＣＯＭエコーバックポートにて、手詰まり<a class="anchor_super" id="p662e697" href="#p662e697" title="p662e697" style="user-select:none;">&dagger;</a></h4>
<p>手詰まりとなった。</p>
<ul class="list1 list-indent1"><li>ＡＶＲとは接続しない状態で、ＣＯＭポートをオープンし、１バイトづつ文字を読み書きする。</li>
<li>すなわち、ごく単純な無手順ターミナルすら作れないという謎現象だ。</li></ul>
<ul class="list1 list-indent1"><li>突き詰めていったところ、WriteFile()でＣＯＭに書き込むと、それが反対側のＣＯＭポート（ｔｅｒａｔｅｒｍ）に表示されるまでに０.５秒くらいのラグが出来るのだ。</li>
<li>ReadFileもスレッドも一切使わない状態でもそうなる。</li>
<li>OVERLAPPEDをやめてもそうなる。</li>
<li>送信文字数が１バイトだろうが１００バイトだろうが、０.５秒後にしか出現しない。</li>
<li>さらにたちがわるいのは、その期間内のReadFileが一切ブロックされることだ。</li></ul>
<p>これがCommEmuDrv作成の仮想ＣＯＭにだけそうなるのか、リアルのＣＯＭでそうなるのかもまだ分からない。</p>
<ul class="list1 list-indent1"><li>ｔｅｒａｔｅｒｍ同士を仮想ＣＯＭで繋いで手打ちする限りはラグは起きない。</li></ul>
<ul class="list1 list-indent1"><li>プログラムを使わずにコマンドライン上から
<pre>C:&gt; copy file.txt COM5</pre>
などとしても同様の現象に見舞われ、さらに悪いことにファイルの先頭しか送信されない。
<ul class="list2 list-indent1"><li>ちなみに受信側はｔｅｒａｔｅｒｍ</li></ul></li></ul>
<p><br />
<span style="font-size:32px">激しく謎すぎて</span>WIN32のCOMx:はようわからん・・・・。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_8">ComEmulDrvへの対応を断念した。<a class="anchor_super" id="b5134741" href="#b5134741" title="b5134741" style="user-select:none;">&dagger;</a></h4>
<p>症状：</p>
<ul class="list1 list-indent1"><li>ＣＯＭポートに送信(writeFile)して、０.５秒くらいのラグがあって文字が(teraterm側に)表示される問題。</li>
<li>受信はまったく問題ない。</li>
<li>あと、問題は、空白の０.５秒の間にteratermで打った文字がぜんぜん受信できずに捨てられることだ。</li></ul>
<ul class="list1 list-indent1"><li>まったく原因がつかめない。</li></ul>
<p>じゃあteraterm同士では大丈夫なのか？</p>
<ul class="list1 list-indent1"><li>試してみた。</li>
<li>ポートの方向によって、だめなときがある。
<ul class="list2 list-indent1"><li>わりと、最後の１文字が０.５秒遅れで出たり、もう１文字書いたときに遅れて出たりする。</li>
<li>これはどちらかというとWindowsのカーネルのタイムスライスがおかしいんじゃぁ？</li></ul></li>
<li>teratermでは文字が捨てられることはなさそう。</li>
<li>リアルＲＳ２３２Ｃポートではこのようになるというのは聞いたことない。
<ul class="list2 list-indent1"><li>ComEmulDrvの癖なのかもしれない。</li>
<li>ソースを見たが、よく分からない。</li>
<li>Google先生にも聞いてみたが、使用例はごく少ないらしく、症例を発見できず。</li></ul></li></ul>
<p>Win32上でのComm関係でかれこれ３日くらい悩んだがもうあきらめよう。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_9">Ｈ８/３０４８Ｆ（季節柄秋なので、秋の月、秋月）のその後<a class="anchor_super" id="kff9aabb" href="#kff9aabb" title="kff9aabb" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>２５ＰＩＮのパラレルコネクタは使わないっぽいので外して、そこにＵＳＢのＢコネクタ
を実装してみた。</li>
<li>Ｈ８/３０４８Ｆ本体基板の３端子レギュレータを外して、ＵＳＢの＋５を直接Ｈ８の５Ｖに繋いだ。（本来はＨ８/３０４８Ｆ本体基板に１２Ｖが印加される仕様）</li>
<li>ＵＳＢ盗電システム成功。Ｈ８モニタ起動ＯＫ。</li>
<li>ついでに、ＡＴｔｉｎｙ２３１３を実装。</li>
<li>部品は１００Ω×２、１.５ｋΩ×１、１２ＭＨｚＸｔａｌ、０.１μＦパスコン、ＡＶＲチップ、とたったこれだけで製作。</li>
<li>何を省略したかというと減圧レギュレータ、Ｘｔａｌの負荷コンデンサ。</li>
<li>ＡＶＲは５Ｖ動作。</li>
<li>これで何の問題もなくＡＶＲ＿Ｍｏｎｉｔ入りのＡＶＲ＿ｔｅｒｍが起動した。</li></ul>
<p>まだ、ＵＳＢシリアルからＨ８には繋いでいない。</p>
<ul class="list1 list-indent1"><li>というのは、Ｈ８/３０４８Ｆ本体基板のＲＳ２３２Ｃは、リアルＲＳ２３２ＣのＴｘＤ、ＲｘＤなので、レベル変換とインバータが必要だからだ。</li>
<li>Ｈ８/３０４８Ｆ本体基板上のＡＤＭ２３２を外して直結すればいいのだが、あんまり触りたくない。（配線が細いので・・・）</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_10">さらにＡＫＩ８０接続した。<a class="anchor_super" id="c2ff4816" href="#c2ff4816" title="c2ff4816" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>実はレベルコンバータが面倒だったので、いきなりＺ８０　ＳＩＯのほうに接続してみた。
<pre>#d 8000
8000 ff ff ff ff 0000 00 00 ff ff ff ff 0 00 00 00
8010 ff ff f df 00 00 00 0 ff ff ff fd 00 00 00 00
8020 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
8030 ff ff ff ff 00 00 00 0 ff ff ff ff 00 00 0000
8040 00 00 00 00 f ff ff ff 00 00 00 01 f ff ff ff
8050 00 0040 00 ff ff ff ff 00 0 00 00 ff ff f ff
8060 00 00 00 00 ff ff ffff 00 0 00 00 ff ff ff ff
800 00 00 00 00 ff ff ffff 00 00 00 00 ff ff f ff
8080 ff f ff ff 00 00 00 00 ff f ff ff00 00 00 00
80a0 ff f ff ff 00 0000 00 ff f ff ff 00 0 00 00
8b0 ff ff ff f 00 0000 00 ff ff ffff 00 00 0 00
80c0 0 00 00 0 ff ff ff ff 0000 0000 ff ff ff ff
80d0 00 0 00 00 ff f ff ff 0000 00 0 ff ff ff ff
0e0 00 0 00 00 ff f ff ff 0000 00 00 ff f ff ff
0f0 00 00 0000 ff ff f ff 00 00 00 0 ff f ff ff</pre></li></ul>
<p>惨敗。受信欠落多すぎ。</p>
<p>ＡＶＲの負け。</p>
<p>Ｚ８０の勝ち。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_11">直ったぜ！<a class="anchor_super" id="t834953c" href="#t834953c" title="t834953c" style="user-select:none;">&dagger;</a></h4>
<pre>#d 8000
8000 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
8010 ff ff ff df 00 00 00 00 ff ff ff fd 00 00 00 00
8020 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
8030 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
8040 00 00 00 00 ff ff ff ff 00 00 00 01 ff ff ff ff
8050 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
8060 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
8070 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
8080 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
8090 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
80a0 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
80b0 ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00
80c0 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
80d0 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
80e0 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff
80f0 00 00 00 00 ff ff ff ff 00 00 00 00 ff ff ff ff</pre>
<p>ハイスピードハブを挟んだだけで直った。</p>
<ul class="list1 list-indent1"><li>ワンダフル！</li>
<li>ボーレートは３８４００bps</li>
<li>ＲＳ２３２Ｃ受信がポーリングによるものなので、直結だと開放タイミングがうまく確保できないのだろう。</li>
<li>割り込み受信にするしかない？</li></ul>
<p>モニタはこんな奴が入っていた。</p>
<ul class="list1 list-indent1"><li><a href="/ATMEL_AVR/upload/silver.zip" rel="nofollow">/ATMEL_AVR/upload/silver.zip</a></li>
<li>aslink.exe が見当たらない・・・。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_12">Ｈ８には勝った。<a class="anchor_super" id="s43bfa38" href="#s43bfa38" title="s43bfa38" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>秋月Ｈ８/３０４８Ｆのマザーボード（兼ライターボード）に乗っていたＩＣ　ＮＥＣ２００３
の空きピンを利用してインバータ兼レベルコンバーターを実装。</li>
<li>２００３はダーリントン接続の２Ｔｒが８個入っている。</li>
<li>まるでＬＥＤドライバーみたいなやつ。</li>
<li>これをＲＳ２３２ＣのＴｘＤにつないで、出力をプルアップしたのちＡＶＲのＲｘＤに繋ぐ。</li>
<li>逆も同様。</li>
<li>どうやらＲＳ２３２Ｃから直結するとうまく行かない。</li>
<li>ＲＳ２３２Ｃラインがー１０Ｖに振れたときに逆流ダイオードに引っかかって死亡。</li>
<li>３ｋオームを入れてとりあえずＯＫ。</li></ul>
<p>結果</p>
<ul class="list1 list-indent1"><li>Ｈ８は１９２００ＢＰＳのモニターが起動する。</li>
<li>ＡＶＲも１９２００に合わせてＡＶＲ＿ｔｅｒｍを起動。</li>
<li>今回はハイスピードハブがなくても受信文字欠落は無かった。</li></ul>
<p>ＯＫ。出来上がり。</p>
<p><strong>現在のステータス</strong></p>
<ul class="list1 list-indent1"><li>ＡＶＲ＿ｔｅｒｍ経由でＡＫＩ-８０との接続に成功。（３８４００ＢＰＳ）
<ul class="list2 list-indent1"><li>ただし、ハイスピードハブを挟まないと受信文字欠落が生じる。</li></ul></li>
<li>ＡＶＲ＿ｔｅｒｍ経由でＨ８/３０４８Ｆとの接続に成功。（１９２００ＢＰＳ）
<ul class="list2 list-indent1"><li>ＲＳ２３２ＣからＡＶＲへは余ったダーリントンでインバート接続した。</li>
<li>ハイスピードハブを挟まなくてもＯＫ。</li></ul></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_13">Ｈ８を勉強中<a class="anchor_super" id="w7fb74de" href="#w7fb74de" title="w7fb74de" style="user-select:none;">&dagger;</a></h4>
<p>Ｈ８のブートモードのおさらい。</p>
<p>ブートモード、ユーザープログラムモードともに、ＶＰＰに１２Ｖを印加。<br />
ブートモードではさらにＭＤ２にも１２Ｖを印加。</p>
<ul class="list1 list-indent1"><li>ホストは00を何回か送る。</li>
<li>Ｈ８はそれを見てボーレートを調整する。</li>
<li>Ｈ８は調整できたら00をエコーバックする。</li>
<li>ホストは00を受け取ったら、次に55を送る。</li>
<li>Ｈ８は55に対してAAを返す。</li>
<li>ホストは、ＨＩ，ＬＯの順に転送プログラムサイズを送る。</li>
<li>ホストは、転送プログラム本体を送る。</li>
<li>Ｈ８は、それぞれをバイトごとにエコーバックする。</li>
<li>転送が終わったら、Ｈ８はＦＬＡＳＨを全消去する。</li>
<li>全消去が済んだらAAを返す。消去に失敗するとFFを返し、停止する。</li>
<li>Ｈ８は転送されたユーザープログラム(FF300もしくはFFF300からサイズ最大C00バイト)を実行する。
<ul class="list2 list-indent1"><li>FFF300 はモード６のとき（１６ＭＢ）FF300はモード5,7のとき(１ＭＢ空間）</li></ul></li></ul>
<p>以上。</p>
<p>これらを実行してくれるツールがh8write.c なのだが、AVR_termに組み込むのは無理。</p>
<ul class="list1 list-indent1"><li>というのは、AVR_termには１バイト単位でのsend/recvをサポートしている論理層がないのだ。</li>
<li>基本的にポーリングで（キー入力処理/ＡＶＲとの交信/文字表示）のループを回しているだけなのだ。</li>
<li>こいつをバイト志向のインターフェースにするには、ＡＶＲとの交信を別スレッドで回して、そのスレッドとメインスレッドのインターフェースをバイト志向のＦＩＦＯなりＰＩＰＥに改造しなければならない。（今はそうなっていない）</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_14">PuTTYを試す。<a class="anchor_super" id="t585a53b" href="#t585a53b" title="t585a53b" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>PuTTYはフリーなssh / telnetクライアント。</li>
<li>serialもサポートされている。</li>
<li>Windows / Linux と動作範囲は広い。</li>
<li>なぜだかわからないが PuTTYだと、ComEmulDrvとの相性が良い。
<br />
<span style="font-size:32px">不思議だ。</span>
<br /></li>
<li>不思議なことにOVERLAPPED引数エリアをReadFile() WriteFile() 直前に毎回ゼロクリアしている。</li>
<li>そんなことWIN32HELPに書いてないぞ。</li>
<li>やってみたが・・・今一つだ。</li>
<li>むしろ、readfileのthreadでsleep(1)しているのが悪いらしい。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_15">自分が馬鹿であることに気づいた（もっと早く気づけよ）<a class="anchor_super" id="ic5a4d00" href="#ic5a4d00" title="ic5a4d00" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>Sleep(1mS)が悪い、と書いたが、実はそうではなくて。</li>
<li>ReadFile( ... OVERLAPPED &amp;ovl );でIO_PENDINGじゃないときは、既に読み込み完になっている。</li>
<li>そのときはGetOverlappedResultとかWaitForなんとかとかは、一切不要で。</li>
<li>すでに受信できてるわけ。</li>
<li>なのに、そのデータを捨てちゃだめだよなー。＞アホ。</li></ul>
<p>どうりで、teratermからのuploadをReadFileスレッドでぜんぜん受信できないわけだ。</p>
<ul class="list1 list-indent1"><li>Sleep(1)を外すと、「のほほん」タイムが省略されて、常にIO_PENDING状態になり、</li>
<li>たまたま受信できていたわけ。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_16">最近の思うところ<a class="anchor_super" id="u4a39dde" href="#u4a39dde" title="u4a39dde" style="user-select:none;">&dagger;</a></h4>
<p>OLIMEXのこれが欲しいんだな。</p>
<ul class="list1 list-indent1"><li><a href="http://strawberry-linux.com/catalog/items?code=15005" rel="nofollow">http://strawberry-linux.com/catalog/items?code=15005</a></li></ul>
<ul class="list1 list-indent1"><li>made in ブルガリーだが、どう考えてもＨ８の２０ＭＨｚに対してクロック比３倍、ＣＰＩ比４倍、
<strong>計１２倍は軽く速い</strong></li></ul>
<ul class="list1 list-indent1"><li>ＳＨ−２と比べてもこっちのほうが良さげ。消費電力でもＳＨより少ない。</li></ul>
<ul class="list1 list-indent1"><li>フラッシュ５１２Ｋ、ＲＡＭ４２ＫＢと、十分な容量。</li></ul>
<ul class="list1 list-indent1"><li>おまけにＵＳＢ　ＦｕｌｌＳｐｅｅｄ内蔵だな。</li></ul>
<ul class="list1 list-indent1"><li>ＡＲＭなのでコンパイラには不自由しないし、アセンブラで書いても速い。</li></ul>
<p>こうなってくると、もうるねさすなんかいらないという感じ。</p>
<ul class="list1 list-indent1"><li>というか秋月さん、Ｈ８はもういいからこんなナイスなボード売って。（OLIMEXのデッドコピーじゃないやつね）
<ul class="list2 list-indent1"><li>意訳：ＣＰＩの悪いコストパフォーマンスの悪いＨ８はもう保守品種にしてしまっていい。</li>
<li>ＵＳＢとかＬＡＮは欲しい。あとは適度にクールなＣＰＵを安く載せて。</li>
<li>ＥｚＵＳＢ　ＦＸ２はいくらＨｉＳｐｅｅｄでも（８０５１だから）嫌だ。</li></ul></li></ul>
<p><br />
<span style="font-size:22px">じゃあ<strong>何かい？</strong>。今までのＡＶＲとＨ８は回り道</span>だったってこと？
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_17">ＭＩＰＳも面白いかも。<a class="anchor_super" id="t71e468b" href="#t71e468b" title="t71e468b" style="user-select:none;">&dagger;</a></h4>
<p>こっちはOLIMEXじゃないけれど、１００ＢａｓｅＴが４ポートとシリアルとＵＳＢが付いて３８００円だ。</p>
<ul class="list1 list-indent1"><li><a href="http://www.fenix.ne.jp/~thomas/memo/bbr4/" rel="nofollow">http://www.fenix.ne.jp/~thomas/memo/bbr4/</a></li></ul>
<p>ＭＩＰＳの１７５ＭＨｚ、８Ｍ　ＲＡＭ　２Ｍ　ＦＬＡＳＨだ。ＯＬＩＭＥＸを超えている。</p>
<p>しかも、Ｂｕｆｆａｌｏだぜ。普通のパソコンショップに売ってるし。</p>
<p>改造するなら、ジャンクで入手すべきだが。</p>
<ul class="list1 list-indent1"><li>ひとつ注意しておくと、ＵＳＢはデバイスではなくてホストだ。</li>
<li>だが、Ｌｉｎｕｘ化出来るので、各種ドライバーは揃うわけで、楽だろ。</li></ul>
<p>下手に実用品として使おうとしないこと（たとえばＷｅｂサーバーとかＦＴＰサーバーとかインターネットに晒すとか）</p>
<ul class="list1 list-indent1"><li>実用品なら玄箱買っとけ。あっちはＲＡＭがこの１６倍はある。</li>
<li>実用品じゃなくて、マイコンボードと考えると、なんなんだろうこの高機能っぷりは！１７５Ｍｈｚのボードなんて１万円でも買えないぜ。しかもＬｉｎｕｘ動いてるし。</li>
<li>EtherNetのハブ(もしくはルーター)＋αとして実用に使うは善し。＋αの部分はあまり多くを望まないこと。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_18">Win32 Commポートリベンジ！<a class="anchor_super" id="zf70a73e" href="#zf70a73e" title="zf70a73e" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>なんかほんとにteraterm--&gt;ComEmulDrv--&gt;自作Comm通信は相性が悪いようだ。</li>
<li>症状としては、Commに対するReadFileとWriteFileの発行（オーバーラップも含め）が重なるだけでダメダメになる。</li>
<li>teratermの代わりにPuTTYだと、割といい感じ。</li>
<li>なぜだかわからない。</li>
<li>文字欠けの問題は、Commに対するReadFileとWriteFileの発行（オーバーラップも含め）が重ならないようにセマフォとかMutexで制御することで回避は出来るが、送信が起きると受信文字が妙に遅れてくる問題はそのままのようだ。</li></ul>
<ul class="list1 list-indent1"><li>ちなみにWriteFileせずにconsole printするような（半二重通信）アプリにすると、どちらのtermでも快調だ。</li></ul>
<p>Win32のCommはほんとにようわからん。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_19">結局のところ、半二重でよいからとっととやっつけてしまおう的なソリューションを取ることにした。<a class="anchor_super" id="t66500c0" href="#t66500c0" title="t66500c0" style="user-select:none;">&dagger;</a></h4>
<p>要はh8write.cが動けば（AVR tiny2313経由でH8/3048Fに書ければ）いいというそれだけなのだ。</p>
<ul class="list1 list-indent1"><li>だから、文字欠けさえなければ、応答が遅かろうがどうでもよい。</li>
<li>h8write.cのやりかたが、けっこう投槍的なので、真似しようかと。（ERROR_IO_PENDINGなんか見てないし）</li></ul>
<p>結果、成功。</p>
<ul class="list1 list-indent1"><li>わざわざWIN32用の無手順端末を書いた。</li>
<li>投槍的にはせずに、普通に書いてみた。</li>
<li>RS232C受信文字があるかどうかをポーリングする関数ClearCommError()を使って、結局スレッドは用いなかった。</li>
<li>さらに、無手順端末モードの他にエコーバックサーバーモードを追加した。</li>
<li>２つのtermを立ち上げ、片方をエコーバックサーバーにして、もう片方を無手順端末にする。</li></ul>
<p>ばっちりだ。</p>
<ul class="list1 list-indent1"><li>無手順端末でなくteratermを使ったときだけ、応答が遅い現象が起きる。</li>
<li>PuTTYでは起きないので、teratermだけ本物のRS232Cポートを仮定した何かのエラーチェックがあるのではないか？？？</li>
<li>ComEmulDrvのCOMポートに対して、GetCommProperties()を発行すると、COMPROP構造体がオールゼロのままで何も情報を返さないので、やはり実在COMポートとは異なるようだ。</li></ul>
   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="http://">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2008-08-25 (月) 23:11:05<span class="page_passage" data-mtime="2008-08-25T23:11:05+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
