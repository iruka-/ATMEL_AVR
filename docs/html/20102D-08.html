<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <title>2010-08 - PukiWiki</title>

<!---
 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/180wiki-sp.css" />

 --->

 <link rel="stylesheet" media="screen and (max-width:768px)" href="../skin/monobook/mobile.css" />
 <link rel="stylesheet" media="screen and (min-width:769px)" href="../skin/monobook/monobook.css" />

 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="./?cmd=rss" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="globalWrapper">
 <div id="menubar">
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/html/" title="FrontPage" class="link_page_passage" data-mtime="2022-08-01T12:48:11+09:00">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></p>
<ul class="list1 list-indent1"><li><a href="EF-BC-A4-EF-BD-8F-EF-BD-97-EF-BD-8E-EF-BC-AC-EF-BD-8F-EF-BD-81-EF-BD-84-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li>
<li><strong><a href="http://ddip.net/ATMEL_AVR/html/20222D-08.html" rel="nofollow">開発日記</a></strong> <a href="SiteMap.html" title="SiteMap" class="link_page_passage" data-mtime="2022-07-31T15:21:46+09:00">過去ログ</a></li></ul>
<p><a href="E5-88-B6-E4-BD-9C-.html" class="link_page_passage" data-mtime="2013-04-29T09:29:29+09:00">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">ＡＶＲ関係</a></p>
<ul class="list1 list-indent1"><li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
<li><a href="AVR_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVR_term</a></li>
<li><a href="W32_term.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">W32_term</a></li>
<li><a href="HIDmon88.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon88</a></li>
<li><a href="HIDtester.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDtester</a></li>
<li><a href="usbRS232.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbRS232</a></li>
<li><a href="Arduino2313.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino2313</a></li>
<li><a href="E3-83-87-E3-82-B8-E3-82-BF-E3-83-AB-E3-83-86-E3-82-B9-E3-82-BF-E3-83-BC-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">デジタルテスター</a></li>
<li><a href="ATmega88E7-94-9F-E6-B4-BB-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ATmega88生活</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニア</a></li>
<li><a href="KeyBoardE3-83-9E-E3-83-8B-E3-82-A2-II.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="E8-B5-A4-E5-A4-96-E7-B7-9A-E3-83-AA-E3-83-A2-E3-82-B3-E3-83-B3-.html" class="link_page_passage" data-mtime="2014-12-01T23:50:24+09:00">赤外線リモコン</a></li></ul>
<p><a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></p>
<ul class="list1 list-indent1"><li><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-Discovery改造</a></li>
<li><a href="stm8s_blaster.html" title="stm8s_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM8S-OpenOCDライター</a></li>
<li><a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></li>
<li><a href="lpc2D-armon.html" title="lpc-armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">NXP用ブートローダー</a></li>
<li><a href="LPC1114.html" title="LPC1114" class="link_page_passage" data-mtime="2012-09-12T22:43:19+09:00">MARY基板</a></li>
<li><a href="LPC1114FN28.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPC1114FN28</a></li>
<li><a href="arm_blaster.html" title="arm_blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">OpenOCD　JTAGアダプター</a></li>
<li><a href="openocd2D-build.html" title="openocd-build" class="link_page_passage" data-mtime="2011-11-25T22:47:41+09:00">OpenOCDビルド方法</a></li>
<li><a href="arm2D-gcc.html" title="arm-gcc" class="link_page_passage" data-mtime="2011-11-27T16:31:48+09:00">arm-gccビルド方法</a></li>
<li><a href="mapleIDE.html" title="mapleIDE" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mapleIDEの改造</a></li>
<li><a href="libmapleE3-81-A7-E4-BB-AE-E6-83-B3-COM.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">libmapleで仮想COM</a></li></ul>
<p>PIC32</p>
<ul class="list1 list-indent1"><li><a href="PIC32MX.html" class="link_page_passage" data-mtime="2015-05-02T16:17:40+09:00">PIC32MX</a></li>
<li><a href="Pinguino.html" title="Pinguino" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">Pinguinoで遊ぼう</a></li>
<li><a href="HIDBootX.html" title="HIDBootX" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">ブートローダーを作る</a></li>
<li><a href="uartflash32.html" title="uartflash32" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">シリアルブートローダー</a></li>
<li><a href="PIC32MX_USBCDC.html" title="PIC32MX_USBCDC" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB仮想シリアル</a></li>
<li><a href="USB_CUSTOM.html" title="USB_CUSTOM" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBカスタムデバイス</a></li>
<li><a href="PIC32mon.html" title="PIC32mon" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">USB簡易モニター</a></li>
<li><a href="USBE3-82-AA-E3-82-B7-E3-83-AD-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBオシロスコープ</a></li>
<li><a href="USB_HOST.html" title="USB_HOST" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBホスト</a>　</li>
<li><a href="Bluetooth.html" title="Bluetooth" class="link_page_passage" data-mtime="2014-09-27T22:53:38+09:00">PIC32でBluetooth</a>　</li>
<li><a href="USBAudio.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">USBAudio</a>　</li>
<li><a href="USBStudy.html" class="link_page_passage" data-mtime="2014-11-20T22:01:19+09:00">USBStudy</a>　</li>
<li><a href="pic32vga.html" title="pic32vga" class="link_page_passage" data-mtime="2015-02-01T14:32:31+09:00">VGA出力に挑戦</a></li>
<li><a href="tinyBasic2.html" title="tinyBasic2" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">BASICを動かす</a></li>
<li><a href="WinUSB.html" class="link_page_passage" data-mtime="2013-05-10T22:28:35+09:00">WinUSB</a>　</li>
<li><a href="PIC32MXcust.html" title="PIC32MXcust" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">勝手に改蔵*PIC32</a></li></ul>
<p>PIC18F</p>
<ul class="list1 list-indent1"><li><a href="pic18boot.html" title="pic18boot" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ARMライター</a></li>
<li><a href="pic18monit.html" title="pic18monit" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usb汎用クラス</a></li>
<li><a href="usbserial.html" title="usbserial" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc" class="link_page_passage" data-mtime="2009-09-25T17:26:22+09:00">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">mcc18を使いこなす</a></li>
<li><a href="HIDmon2D-2550.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-2550</a></li>
<li><a href="HIDmon2D-14K50.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul class="list1 list-indent1"><li><a href="UBW.html" title="UBW" class="link_page_passage" data-mtime="2009-04-16T22:42:14+09:00">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550" class="link_page_passage" data-mtime="2010-02-17T16:23:41+09:00">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550" class="link_page_passage" data-mtime="2009-05-06T01:05:20+09:00">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul class="list1 list-indent1"><li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
<li><a href="RX62N.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">RX62N</a></li>
<li><a href="SH2A.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">SH2A</a></li>
<li><a href="EF-BC-A8-EF-BC-98-.html" class="link_page_passage" data-mtime="2010-04-28T09:27:01+09:00">Ｈ８</a></li>
<li><a href="FM3.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">FM3</a></li>
<li><a href="ubuntuXP.html" title="ubuntuXP" class="link_page_passage" data-mtime="2014-06-22T14:58:37+09:00">XPからubuntuに乗り換え</a></li>
<li><a href="Android.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">Android</a></li>
<li><a href="Xen2D-hypervisor.html" class="link_page_passage" data-mtime="2015-01-22T18:20:53+09:00">Xen-hypervisor</a></li>
<li><a href="Windows8E3-82-AB-E3-82-B9-E3-82-BF-E3-83-9E-E3-82-A4-E3-82-BA-.html" class="link_page_passage" data-mtime="2012-12-06T13:25:35+09:00">Windows8カスタマイズ</a></li></ul>
<p>開発日記</p>
<ul class="list1 list-indent1"><li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul class="list1 list-indent1"><li><a href="AVRUSB_Tips.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">AVRUSB_Tips</a></li>
<li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
<li><a href="E6-B1-8E-E7-94-A8-EF-BC-B5-EF-BC-B3-EF-BC-A2-2D-EF-BC-A9-EF-BC-AF-.html" class="link_page_passage" data-mtime="2008-10-13T03:47:40+09:00">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink" class="link_page_passage" data-mtime="2010-11-02T22:35:53+09:00">リンク</a></p>
<p>フリースペース</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" title="ＷｉｄｅＴｅｘｔ" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">旧コンテンツ</a><br />
<a href="EF-BC-B7-EF-BD-89-EF-BD-8E-EF-BC-B6-EF-BD-89-EF-BD-93-EF-BD-94-EF-BD-81-.html" class="link_page_passage" data-mtime="2008-05-17T00:51:37+09:00">ＷｉｎＶｉｓｔａ</a><br />
<a href="E3-82-A4-E3-83-B3-E3-82-BF-E3-83-BC-E3-83-95-E3-82-A7-E3-83-BC-E3-82-B9-E8-80-83-.html" class="link_page_passage" data-mtime="2007-08-28T23:52:40+09:00">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2022-08-05</strong>
<ul class="recent_list">
 <li><a href="MenuBar.html" class="link_page_passage" data-mtime="2022-08-05T09:31:59+09:00">MenuBar</a></li>
</ul>
<strong>2022-08-01</strong>
<ul class="recent_list">
 <li><a href="20222D-08.html" class="link_page_passage" data-mtime="2022-12-06T14:55:12+09:00">2022-08</a></li>
 <li><a href="http:/ATMEL_AVR/html/" class="link_page_passage" data-mtime="2022-08-01T12:48:11+09:00">FrontPage</a></li>
 <li><a href="20152D-04.html" class="link_page_passage" data-mtime="2022-08-01T10:41:06+09:00">2015-04</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-EF-BD-98-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:55+09:00">ＨＩＤａｓｐｘ</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E6-83-85-E5-A0-B1-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:45+09:00">ＨＩＤａｓｐ情報</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-.html" class="link_page_passage" data-mtime="2022-08-01T10:38:34+09:00">ＨＩＤａｓｐ</a></li>
 <li><a href="NEC78K.html" class="link_page_passage" data-mtime="2022-08-01T10:38:19+09:00">NEC78K</a></li>
 <li><a href="AVRetc.html" class="link_page_passage" data-mtime="2022-08-01T10:38:10+09:00">AVRetc</a></li>
 <li><a href="AVR_Monit.html" class="link_page_passage" data-mtime="2022-08-01T10:38:01+09:00">AVR_Monit</a></li>
 <li><a href="20082D-08.html" class="link_page_passage" data-mtime="2022-08-01T10:37:50+09:00">2008-08</a></li>
</ul>
<strong>2022-07-31</strong>
<ul class="recent_list">
 <li><a href="EF-BC-B7-EF-BD-89-EF-BD-84-EF-BD-85-EF-BC-B4-EF-BD-85-EF-BD-98-EF-BD-94-.html" class="link_page_passage" data-mtime="2022-07-31T15:28:50+09:00">ＷｉｄｅＴｅｘｔ</a></li>
 <li><a href="RecentDeleted.html" class="link_page_passage" data-mtime="2022-07-31T15:25:08+09:00">RecentDeleted</a></li>
 <li><a href="SiteMap.html" class="link_page_passage" data-mtime="2022-07-31T15:21:46+09:00">SiteMap</a></li>
</ul>
<strong>2022-07-25</strong>
<ul class="recent_list">
 <li><a href="20082D-10.html" class="link_page_passage" data-mtime="2022-07-25T22:19:24+09:00">2008-10</a></li>
 <li><a href="EF-BC-A8-EF-BC-A9-EF-BC-A4-EF-BD-81-EF-BD-93-EF-BD-90-E9-AB-98-E9-80-9F-E5-8C-96-.html" class="link_page_passage" data-mtime="2022-07-25T21:56:43+09:00">ＨＩＤａｓｐ高速化</a></li>
 <li><a href="H8EF-BC-8F-3048F.html" class="link_page_passage" data-mtime="2022-07-25T21:46:43+09:00">H8／3048F</a></li>
 <li><a href="AutoTicketLinkName.html" class="link_page_passage" data-mtime="2022-07-25T16:51:44+09:00">AutoTicketLinkName</a></li>
</ul>
<strong>2021-12-11</strong>
<ul class="recent_list">
 <li><a href="FormattingRules.html" class="link_page_passage" data-mtime="2021-12-11T00:40:03+09:00">FormattingRules</a></li>
</ul>
<strong>2020-02-23</strong>
<ul class="recent_list">
 <li><a href="WikiWikiWeb.html" class="link_page_passage" data-mtime="2020-02-23T22:51:43+09:00">WikiWikiWeb</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li id="wn_main" class="selected"><a href="" title="2010-08" class="link_page_passage" data-mtime="2010-08-28T23:54:56+09:00">本文</a></li><li id="wn_note"><span class="noexists"><a href="./?cmd=edit&amp;page=note%2F2010-08">ノート</a></span></li><li><a href="./?cmd=edit&amp;page=2010-08">編集</a></li><li><a href="./?cmd=diff&amp;page=2010-08">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">2010-08</h1><div id="contentSub"></div>
    <p><a href="20102D-07.html" class="link_page_passage" data-mtime="2010-07-28T17:22:24+09:00">2010-07</a>←　→<a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a>　<a href="stm32f103.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">stm32f103</a>　<a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">ＡＶＲ／ＰＩＣ両用ライター</a>　<a href="usbserial.html" title="usbserial" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbシリアル変換 </a>　<a href="pic18hidkey.html" title="pic18hidkey" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">usbキーボード </a>　<a href="pic18spx.html" title="pic18spx" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">簡易ロジアナ、赤外線リモコン信号観測</a></p>
<h3 id="content_1_0">８月：脱皮したばかりのセミ＝セミヌード　という妄想が頭をよぎって離れない。ミーン<a class="anchor_super" id="eb731191" href="#eb731191" title="eb731191" style="user-select:none;">&dagger;</a></h3>
<p><br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_1">先月のまとめ<a class="anchor_super" id="r452ccbc" href="#r452ccbc" title="r452ccbc" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>JTAGケーブル(ライター)に挑戦。 --FT2232Dを使ったものは、ばっちりＯＫ。</li>
<li>OpenOCDを使ってみる。 --- うまくいった。</li>
<li>ついでにSTM8S-DiscoveryのST-Linkのファームまで書き換えてしまった。</li></ul>
<p><br /></p>
<p><strong>今月の<del>暇つぶし</del>目標</strong></p>
<ul class="list1 list-indent1"><li>ARM用のHID Bootloaderをでっちあげてみる。</li></ul>
<p><br /></p>
<p><br /></p>
<div class="contents">
<a id="contents_1"></a>
<ul class="list2 list-indent1"><li><a href="#eb731191">８月：脱皮したばかりのセミ＝セミヌード　という妄想が頭をよぎって離れない。ミーン</a></li></ul>
<ul class="list1 list-indent1"><li><a href="#r452ccbc">先月のまとめ</a></li>
<li><a href="#sfb4a15f">ubuntu10.4を快適に使う。</a>
<ul class="list2 list-indent1"><li><a href="#j38a1ba1">（１）メニューバーを全部下に持ってくる。</a></li>
<li><a href="#vdcf6f05">（２）当然Ext4でフォーマットする。</a></li></ul></li>
<li><a href="#h86439aa">アマゾン新 Kindle 発表、WiFi版 139ドル・3G版189ドル</a></li>
<li><a href="#v9bc4042">STM32:GPIOポートの続き。</a>
<ul class="list3 list-indent2"><li><a href="#y74f9c1e">で、良く見たら、JUMPER OPEN時に0x0800_2000番地のファームに飛ぶ処理が入ったままだった。</a></li>
<li><a href="#d5bcbf5c">0x0800_2000番地のファームを起動する処理は少しだけ気持ちが悪い。</a></li>
<li><a href="#l295721d">とりあえず、HIDブートローダーが出来た。</a></li></ul></li>
<li><a href="#ec3e62eb">Orange Computer(SC/MP-II)</a></li>
<li><a href="#x821188c">トランジスタ技術 2010年9月号増刊</a></li>
<li><a href="#v24ef934">筍Pad</a></li>
<li><a href="#kc024c82">STM32:やっとＬチカができるようになった。</a>
<ul class="list3 list-indent2"><li><a href="#a657a9a5">stm32 ToDo List</a></li></ul></li>
<li><a href="#l879d7c3">STBeeが来た。</a>
<ul class="list3 list-indent2"><li><a href="#f655ebbe">stm32 続き</a></li>
<li><a href="#t7adfcbc">即実行</a></li></ul></li>
<li><a href="#na3e94db">STM32:コンパイラをCodeSourcery にしたら、かなり縮んだ。</a></li>
<li><a href="#z2ae0c6c">コード品質？？？</a>
<ul class="list3 list-indent2"><li><a href="#q190d3b6">なんかswi命令の先あたりでハングする。</a></li></ul></li>
<li><a href="#r639d025">え？５兆桁って、日本人が達成したの？</a>
<ul class="list3 list-indent2"><li><a href="#ff649f5c">y-cruncherというPiの計算ソフト（x86/x64バイナリー含む）は、以下のサイトからＤＬ出来る。</a></li>
<li><a href="#t77383af">こっちは、半年前の２.７兆桁の記事。</a></li></ul></li>
<li><a href="#mbd4cfbd">ひと目でわかる、アニメーションで説明したメキシコ湾・原油流出100日間</a></li>
<li><a href="#jab4c34f">Cortex-M3:浮動小数演算でハング</a>
<ul class="list3 list-indent2"><li><a href="#nc7364f9">_sbrkの動作そのものがおかしいことが分かった。</a></li>
<li><a href="#o227940b">とりあえず、動くようにはなったが・・・</a></li>
<li><a href="#jac1456e">現在の問題点</a></li>
<li><a href="#a5b1094a">sbrkだけ、static変数の初期値がおかしくなるのは何故か？</a></li></ul></li>
<li><a href="#d197668d">さて、次なるターゲットは・・・</a></li>
<li><a href="#jff29336">Cortex-M3:浮動小数演算でハングは解決</a></li>
<li><a href="#lb2b23cc">300MHzのARM9搭載ノート風PDA:14,970円。</a></li>
<li><a href="#q85b6aef">玄箱: lenny化失敗</a></li>
<li><a href="#c9e5be00">ARMプロセッサの系譜</a></li>
<li><a href="#qaf7856b">作りかけのARM用HID bootloader</a>
<ul class="list3 list-indent2"><li><a href="#t66a55bc">原因はJTAGのDISABLE忘れだった。</a></li></ul></li>
<li><a href="#ec3fed6b">ARMマイコン パーフェクト学習基板</a></li>
<li><a href="#p2ff4fc2">次なるターゲット</a>
<ul class="list3 list-indent2"><li><a href="#q7241b1d">とりあえず結線だけはほぼ終了。</a></li>
<li><a href="#e0bbad2f">あれ？次なるターゲットLPC-1343って、ROMもRAMも少ないな(32k+8k)</a></li>
<li><a href="#ecf3d79c">あらびっくり、ほんとにUSBマスストレージデバイスが出現</a></li>
<li><a href="#n905e69e">ほんとうにやってみた。</a></li></ul></li>
<li><a href="#m4ea5c05">armon:ARM用HID bootloader</a></li>
<li><a href="#d0fd11eb">次なるターゲット・・・</a></li>
<li><a href="#i415d295">Oracle、Java 特許侵害で Google を提訴、Android 配布中止求める</a></li>
<li><a href="#i8d772d7">次なるターゲット・・・</a>
<ul class="list3 list-indent2"><li><a href="#leb92cbe">MicroBasic</a></li></ul></li>
<li><a href="#k59e62d4">armon:ARM用HID bootloader</a></li>
<li><a href="#k89407fc">準天頂衛星初号機「みちびき」</a></li>
<li><a href="#u159ac24">LPC1343:不思議なことに・・・</a>
<ul class="list3 list-indent2"><li><a href="#a45ba62a">これも、ほんとに試してみた。</a></li></ul></li>
<li><a href="#e038ea26">LPC1343:TRZ1010Nのバカヤロー</a></li>
<li><a href="#v6175687">LPC1343:続：ありえない展開</a></li>
<li><a href="#d9631e0f">LPC1343:続：いったん収束</a></li>
<li><a href="#lecd80d6">TRZ1010N基板：念のためusbhid_rom_tinyも!</a></li>
<li><a href="#a22ed199">ARM関連：Apple A4プロセッサを分解</a></li>
<li><a href="#zda4b73f">LPC1343:usbhidのビルドを試みる。</a>
<ul class="list2 list-indent1"><li><a href="#z4ecf9e5">ついでだから、usbhid_romもビルドしてみた。</a></li></ul></li>
<li><a href="#b0bd8771">LPC1343:armonの移植に取り掛かる</a></li>
<li><a href="#yf185441">LPC1343用: HID簡易モニター（armon） .(LPCXpresso / TRZ1010N 両対応)</a></li></ul>
</div>

<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_2">ubuntu10.4を快適に使う。<a class="anchor_super" id="sfb4a15f" href="#sfb4a15f" title="sfb4a15f" style="user-select:none;">&dagger;</a></h2>
<p><strong>カスタマイズヒント</strong></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_3">（１）メニューバーを全部下に持ってくる。<a class="anchor_super" id="j38a1ba1" href="#j38a1ba1" title="j38a1ba1" style="user-select:none;">&dagger;</a></h3>
<ul class="list1 list-indent1"><li>デフォルトインストール時はメニューバーが上と下で２本ある。</li>
<li>別にそれでも構わないのだが、最近の横長液晶だと上下が狭いのにさらに狭苦しく感じる。</li></ul>
<p>動かし方。</p>
<ul class="list1 list-indent1"><li>上のメニューのパーツを右クリックして、「□　ロック」にチェックが入っていたら解除する。</li>
<li>もう一度右クリックして、移動メニューがあったらそれを選択する。</li>
<li>そうするとカーソルが手のアイコン化するので、メニューパーツを１個づつ下のメニューバーに移動する。</li>
<li>移動した後で配置を変更したいときも同様に移動メニューを選んで手のアイコンでドラッグする。</li></ul>
<p>全部移動したら、上のメニューバーを削除する（これも右クリックメニューにある）</p>
<ul class="list1 list-indent1"><li>微妙に移動できなさそうなアイコンも、近くの仕切り記号を右クリックで移動できるっぽい。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_4">（２）当然Ext4でフォーマットする。<a class="anchor_super" id="vdcf6f05" href="#vdcf6f05" title="vdcf6f05" style="user-select:none;">&dagger;</a></h3>
<ul class="list1 list-indent1"><li>新規インストールするときはExt4にする。</li></ul>
<p>さらに高速化の呪文を唱える。</p>
<ul class="list1 list-indent1"><li>/boot/grub/grub.cfgを編集。</li></ul>
<pre>    linux   /boot/vmlinuz-2.6.32-24-generic root=UUID=5b1400da-b09d-423b-a305-ae8f15e7417b ro   quiet splash rootflags=data=writeback
   initrd  /boot/initrd.img-2.6.32-24-generic</pre>
<p>つまり、splash のあとに、rootflags=data=writeback　を追加する。</p>
<ul class="list1 list-indent1"><li>/etc/fstabを編集。</li></ul>
<pre>/dev/sda3  /   ext4    errors=remount-ro,noatime,data=writeback  0       1
                                        ~~~~~~~~~~~~~~~~~~~~~~~</pre>
<ul class="list1 list-indent1"><li>errors=remount-ro　のあとにそのまま続けて、「,noatime,data=writeback」を追加する。</li></ul>
<ul class="list1 list-indent1"><li>rootパーティション以外にパーティションを切っている場合も、それらに「,noatime,data=writeback」オプションを追加しておく。</li></ul>
<ul class="list1 list-indent1"><li>再起動すると、起動がかなり速くなっている。</li></ul>
<ul class="list1 list-indent1"><li>ちなみにnoatime はディレクトリやファイルの最終アクセス時刻を打刻しない、というオプション。</li>
<li>data=writebackは、Ext3やExt4のジャーナルの書き込みモードをwritebackキャッシュありにするというオプション。</li></ul>
<p>もちろん、Linuxマシンが頻繁にクラッシュするような使い方（カーネルいじってるとか）をする人はwritebackはおすすめしない（けれど、そういうひとはここの説明を読むまでもないので・・・）</p>
<p><br />
<br />
<br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_5">アマゾン新 Kindle 発表、WiFi版 139ドル・3G版189ドル<a class="anchor_super" id="h86439aa" href="#h86439aa" title="h86439aa" style="user-select:none;">&dagger;</a></h2>
<p>engadget日本版</p>
<ul class="list1 list-indent1"><li><a href="http://japanese.engadget.com/2010/07/28/kindle-wifi-139-3g-189/" rel="nofollow">http://japanese.engadget.com/2010/07/28/kindle-wifi-139-3g-189/</a></li>
<li>139ドルって、円に換算したら１万円ちょっと。</li>
<li>Linuxが走るなら（Linux端末として使えるなら）、ちょっと欲しい。
<ul class="list2 list-indent1"><li>テキストエディタjedの端末として。</li></ul></li></ul>
<p>もうここまで来たんだから、次はカラーの電子ペーパーになって、紙の教科書は消滅する？</p>
<ul class="list1 list-indent1"><li>未来はすぐそこだ。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_6">STM32:GPIOポートの続き。<a class="anchor_super" id="v9bc4042" href="#v9bc4042" title="v9bc4042" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>RCCの関数を呼んで、GPIOにクロックを供給するようにしたら、ポートの読み書きが出来るようになった。</li>
<li>SWIMのRESET#端子をBOOTMODE JUMPERに流用して、JUMPER OPENだったらユーザー側のファーム(0x0800_2000)に飛ぶようにしてみた。</li>
<li>USBが「不明なデバイス」になった。</li></ul>
<p>試しに焼いているユーザー側ファームはHID BOOTLOADERのアドレスを変えただけの同一コード。</p>
<ul class="list1 list-indent1"><li>JUMPER CLOSEの場合はHID BOOTLOADERは正しく初期化され、BOOTLOADERのコマンドを受け付けたり、ポートアクセスなどが可能になった。</li></ul>
<p>なぜ「不明なデバイス」になるのか分からない。</p>
<ul class="list1 list-indent1"><li>とりあえずＬチカでもやるか・・・。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_7">で、良く見たら、JUMPER OPEN時に0x0800_2000番地のファームに飛ぶ処理が入ったままだった。<a class="anchor_super" id="y74f9c1e" href="#y74f9c1e" title="y74f9c1e" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>つまり、0x0800_0000番地で最初に起動するHID BOOTLOADERはJUMPERを見てユーザーファームに飛んでも良いが、</li>
<li>0x0800_2000番地で起動する（アプリケーションとしての）HID BOOTLOADERに同じ処理が残っていたので、</li>
<li>無限に0x0800_2000番地側の起動が行われていただけだった。</li></ul>
<p><strong>３秒で修正完了！</strong></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_8">0x0800_2000番地のファームを起動する処理は少しだけ気持ちが悪い。<a class="anchor_super" id="d5bcbf5c" href="#d5bcbf5c" title="d5bcbf5c" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>RCCの初期化やPLLの初期化を行ったあとで jmp [0x0800_2004] に飛んでいること。</li>
<li>Reset vector [0x0800_2004]の内容は奇数であること。（Thumbモードなので、プログラムカウンタのLSBが立つていた）</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_9">とりあえず、HIDブートローダーが出来た。<a class="anchor_super" id="l295721d" href="#l295721d" title="l295721d" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>HIDブートローダーを使って別の番地のHIDブートローダーを書き換えることも（たぶん）可能。</li>
<li>なので、もうJTAGライターは（マスターのブートローダーをバグらせた時以外は）不要になった。</li></ul>
<p>read more : <a href="stm32f103.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">stm32f103</a></p>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_10">Orange Computer(SC/MP-II)<a class="anchor_super" id="ec3e62eb" href="#ec3e62eb" title="ec3e62eb" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>Googleで検索してみたけれど画像はないなぁ・・・。</li>
<li>Apple ][ 似だったと思う。</li>
<li>創刊されたばっかりの雑誌I/Oの広告ページに写真を見たような気がする。</li>
<li>Orange Basicという（ファームウェアROM?）があったらしい。</li>
<li>しかし、SC/MP-IIは4MHzで駆動したとしても、8080Aと比べて1/18くらいの処理速度。（内部がマイクロコードでまどろっこしい）</li>
<li>ついでにメモリー空間は64Kあるけれど、プログラムカウンタは4kBでクルクル回る（mod 4096って奴）</li>
<li>CALL / RET がないのでBasicインタープリターを書くのも大変だったんじゃないかな。</li>
<li>（当時のミニコンのように、リターンアドレスをサブルーチンの手前のStaticなワークエリアに（PC相対STORE命令で）保存するしかない。リエントランシがない。ROM上で動かせない・・・）</li>
<li>そもそもどうやってCALLするかって？
<pre>LDI #SUBR_ADDRESS_L
XPAL P1   ;; AccとPointer#1Lowの交換.
LDI #SUBR_ADDRESS_H
XPAH P1   ;; AccとPointer#1Highの交換.
XPPC P1   ;; PCとPointer#1の交換.</pre></li></ul>
<ul class="list1 list-indent1"><li>CALLするのに（7byte）必要だな。</li></ul>
<ul class="list1 list-indent1"><li>RETURNは、１レベル関数（中で別の関数を呼ばない）ならば、
<pre>XPPC P1   ;; PCとPointer#1の交換.</pre>
だけでＯＫだ。</li>
<li>もういちど呼び主がXPPC P1を実行すると、さっき呼んだ関数の戻り場所の次から実行してくれる。（コルーチン？）</li>
<li>１レベル関数でない場合は関数のプロローグでP1を保存(PC相対でRAMに保管)して、エピローグでP1を復帰する必要がある。</li></ul>
<ul class="list1 list-indent1"><li>これでポインタが１つ潰れるから、残り２本しかない。</li>
<li>16bitポインタは３本ある。４本目がPCだ。</li>
<li>しかし、全てのメモリーアクセスはその４本のポインタ相対(±128byte offset)でしかアクセス出来ない。</li>
<li>6800のゼロページのようなワークが欲しければ、そこを指すポインタが１つ必要。</li></ul>
<p>なので、</p>
<ul class="list1 list-indent1"><li>サブルーチンを呼ぶためのテンポラリポインタ</li>
<li>ゼロページを参照するためのベースポインタ</li>
<li>スタックポインタ（必要に応じて）
の３つで終了だ。</li></ul>
<p>ちなみに、３本のポインタは演算には使えない。</p>
<p>表引きとか、どうすんだろうね。</p>
<p>ある意味、PIC16Fより悲惨。</p>
<p>当時の16bitタイプのミニコンのALUとかレジスタが仮に8bitだったらこうなる、という地獄のアーキテクチャーだ。</p>
<p>このころからNSのあだ名はナショナル・セミデストラクター（半ぶち壊し屋）だったのだ。</p>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_11">トランジスタ技術 2010年9月号増刊<a class="anchor_super" id="x821188c" href="#x821188c" title="x821188c" style="user-select:none;">&dagger;</a></h2>
<p>USBに挿すだけ！OPアンプ/センサ/カレンダIC搭載！<br />
ARMマイコン パーフェクト学習基板</p>
<ul class="list1 list-indent1"><li><a href="http://shop.cqpub.co.jp/hanbai/books/MTR/MTRZ201009.html" rel="nofollow">http://shop.cqpub.co.jp/hanbai/books/MTR/MTRZ201009.html</a></li></ul>
<p>CD-ROM&amp;基板付き 定価3,780円(税込)</p>
<p>2010年8月16日発売予定！</p>
<ul class="list1 list-indent1"><li>こいつはやっぱり温度計なんだろうか。</li></ul>
<ul class="list1 list-indent1"><li>なぜに<span class="noexists"><a href="./?cmd=edit&amp;page=MicroBasic&amp;refer=2010-08">MicroBasic</a></span>? LuaとかSquirrelとか組み込みC#とかいろいろあるだろーに。</li></ul>
<ul class="list1 list-indent1"><li>LPCXpresso持ってるからとりあえずパスかなー。なんかNXPの石は（JTAG書き込みがないので）興味湧かないなぁ。</li></ul>
<ul class="list1 list-indent1"><li>SWDでの書き込み方法をマスターすれば、また違うんだろうけれど。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_12">筍Pad<a class="anchor_super" id="v24ef934" href="#v24ef934" title="v24ef934" style="user-select:none;">&dagger;</a></h2>
<p>Android 2.1搭載のタブレット端末が来週発売、予価2.5万円</p>
<ul class="list1 list-indent1"><li><a href="http://akiba-pc.watch.impress.co.jp/hotline/20100731/etc_ramos.html" rel="nofollow">http://akiba-pc.watch.impress.co.jp/hotline/20100731/etc_ramos.html</a></li>
<li><a href="http://akiba-pc.watch.impress.co.jp/hotline/20100731/etc_epad.html" rel="nofollow">http://akiba-pc.watch.impress.co.jp/hotline/20100731/etc_epad.html</a></li></ul>
<p>全部中国製。パチモン、というか粗悪品？安いけど。（実はiPadだって中国製だし）</p>
<ul class="list1 list-indent1"><li>液晶やデザイン、ソフトのクォリティなど、総合的に見てAppleのほうがはるかに上を
行っているのは確かなので、他の品物がパチモンだと見られるのはあるていどしかたないことかも。</li></ul>
<ul class="list1 list-indent1"><li>なんか、昔のApple製品(Apple ][とか68000 Macintosh)がとても高価だったころを思い出す。
（まるで高級車、対普及車みたいな）、てゆーかApple  ][とか車１台買える値段だったし。</li></ul>
<ul class="list1 list-indent1"><li>つまり、将来的には中国製iPadもどきが席巻する時代になるのか。</li></ul>
<ul class="list1 list-indent1"><li>だけど、ARMでuni*x系なOSを積んだMID(モバイル端末)って、一般人にそもそも需要はないと思ってたんだけど・・・あったんだね。
<br />
<br />
<br />
<br /></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_13">STM32:やっとＬチカができるようになった。<a class="anchor_super" id="kc024c82" href="#kc024c82" title="kc024c82" style="user-select:none;">&dagger;</a></h2>
<p><a href="stm32f103.html" title="stm32f103" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">例のHIDなARM_Bootloader_兼モニターのこと</a></p>
<ul class="list1 list-indent1"><li>同一ソースから、ブートローダー(0x800_0000)とアプリ(0x800_2000)の両方をビルドするようにした。</li></ul>
<ul class="list1 list-indent1"><li>こうしておくと、お互いに、相手をアップデート出来る。</li>
<li>アプリのほうは、サイズ制限が緩い（56KB)ので、いくらでも機能追加できる。</li></ul>
<p>もう、JTAGライターは使わなくなった。</p>
<ul class="list1 list-indent1"><li>アプリ側を少し拡張して、Ｌチカしながら、HIDmonが動作するようになった。</li></ul>
<ul class="list1 list-indent1"><li>printを実装しようとしたけれど、なぜか_sbrkがない、と言われる。</li>
<li>Linuxのarm-eabi-gccを使ったときは大丈夫だったんだけど、WinARMだと駄目っぽい。</li></ul>
<ul class="list1 list-indent1"><li>WinARMに決めうちするなら、適当な_sbrkとか_lseekとかをソースに埋めておけば動くけれど、</li>
<li>こんどはLinuxでビルドするときに変なことが起きるのだろう。</li></ul>
<ul class="list1 list-indent1"><li>やっぱりWinARMとかnewlibを自分でビルドしないと駄目だな。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_14">stm32 <span class="noexists"><a href="./?cmd=edit&amp;page=ToDo&amp;refer=2010-08">ToDo</a></span> List<a class="anchor_super" id="a657a9a5" href="#a657a9a5" title="a657a9a5" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>□　ブート完了後、'-r'オプションにより、USB disconnectが出来るようにする.(今はdisconnectしないで実行されるようだ)</li>
<li>□　バスエラーへの対処</li>
<li>□　Flash read処理の最適化</li>
<li>□　armon.exeからのbootコマンド</li>
<li>□　printfの実装</li>
<li>□　逆アセンブラをPIC用から差し替える</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_15">STBeeが来た。<a class="anchor_super" id="l879d7c3" href="#l879d7c3" title="l879d7c3" style="user-select:none;">&dagger;</a></h2>
<p>read more : <a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></p>
<p><br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_16">stm32 続き<a class="anchor_super" id="f655ebbe" href="#f655ebbe" title="f655ebbe" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>Linuxでビルドしたarm-eabi-gccを使うと、printfのコードはちゃんとビルドしてくれる。</li>
<li>しかし、SVC_Handlerを書いていないので、当然ながらハングする。</li></ul>
<ul class="list2 list-indent2"><li>正確には、SVC_Handlerは何もせずreturnするだけなので、printしないだけでハングしないのが正しいと思う。</li></ul>
<ul class="list1 list-indent1"><li>それよりも、fputsを入れただけでバイナリーサイズが32kBに膨れ上がるのはどうにかならないのか。</li>
<li>stdioの実装が大げさなのはわかるが、それにしても追っかけるの大変だな。</li></ul>
<ul class="list1 list-indent1"><li>PIC18Fのstdio周りなんて、すごくシンプルなんだけど。</li></ul>
<ul class="list1 list-indent1"><li>K&amp;R本の実装みたいなシンプルなので十分なんだけどな。</li></ul>
<p>選択肢としては、</p>
<ul class="list1 list-indent1"><li>（１）このままnewlibの実装を受け入れて、なんとか動かしてみる。</li>
<li>（２）μCLibcのようなもっと別の実装を探す。</li>
<li>（３）独自の（newlibに頼らない）もっと小さなstdioを書く。</li></ul>
<p>（３）だとたいていサブセットになっちゃって書式指定とか簡略化されるのがオチだけど。</p>
<ul class="list1 list-indent1"><li>昔WindowsCE用の簡易コンソールにX68000のLibcを借りてきたけど、あれくらいが丁度良い。</li></ul>
<p>あれ？そもそもprintを動かす目的って、何だっけ？</p>
<ul class="list1 list-indent1"><li>float演算がちゃんとできるかどうか確認したかった？</li></ul>
<p><br />
だんだん、面倒くさくなってきたので、既製のコンパイラでお茶を濁そうかな。</p>
<ul class="list1 list-indent1"><li><a href="http://www.lineo.co.jp/modules/codesourcery/editions.html" rel="nofollow">http://www.lineo.co.jp/modules/codesourcery/editions.html</a></li>
<li>ところで、こいつだと、SVC_Handlerとか書かなくてもprintf出来るのかな？</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_17">即実行<a class="anchor_super" id="t7adfcbc" href="#t7adfcbc" title="t7adfcbc" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>ありゃ？WinARMと挙動は同じだなぁ・・・</li></ul>
<pre>Linking: main-2000.elf
arm-none-eabi-gcc -mthumb -mcpu=cortex-m3 -mthumb -I. -gdwarf-2 -DROM_RUN -DUSE_
STDPERIPH_DRIVER -DSTM32F10X_MD  -D__WinARM__ -D__WINARMSUBMDL_STM32F103__ -D_RO
MADRS=0x2000 -I../HW/Libraries/STM32F10x_StdPeriph_Driver/inc/ -I../HW/Libraries
/CMSIS/Core/CM3/ -I../HW/Libraries/STM32_USB-FS-Device_Driver/inc/ -I../inc/ -I.
./HW/STM32_EVAL/ -I../HW/STM32_EVAL/STM3210B_EVAL  -Os -Wall -Wcast-align -Wimpl
icit  -Wpointer-arith -Wswitch -ffunction-sections -fdata-sections -Wredundant-d
ecls -Wreturn-type -Wshadow -Wunused -Wa,-adhlns=../HW/Libraries/CMSIS/Core/CM3/
startup/gcc/startup_stm32f10x_md.lst  -ICommon/inc -MD -MP -MF .dep/main-2000.el
f.d ../HW/Libraries/CMSIS/Core/CM3/startup/gcc/startup_stm32f10x_md.o    main.o
monit.o usercmd.o print.o stm32f10x_it.o usb_desc.o usb_endp.o usb_istr.o usb_pr
op.o usb_pwr.o hw_config.o ../HW/Libraries/STM32F10x_StdPeriph_Driver/src/stm32f
10x_exti.o ../HW/Libraries/STM32F10x_StdPeriph_Driver/src/stm32f10x_flash.o ../H
W/Libraries/STM32F10x_StdPeriph_Driver/src/stm32f10x_adc.o ../HW/Libraries/STM32
F10x_StdPeriph_Driver/src/stm32f10x_rcc.o ../HW/Libraries/STM32F10x_StdPeriph_Dr
iver/src/stm32f10x_dma.o ../HW/Libraries/STM32F10x_StdPeriph_Driver/src/stm32f10
x_usart.o ../HW/Libraries/STM32F10x_StdPeriph_Driver/src/stm32f10x_gpio.o ../HW/
Libraries/STM32F10x_StdPeriph_Driver/src/misc.o ../HW/Libraries/STM32_USB-FS-Dev
ice_Driver/src/usb_int.o ../HW/Libraries/STM32_USB-FS-Device_Driver/src/usb_core
.o ../HW/Libraries/STM32_USB-FS-Device_Driver/src/usb_sil.o ../HW/Libraries/STM3
2_USB-FS-Device_Driver/src/usb_mem.o ../HW/Libraries/STM32_USB-FS-Device_Driver/
src/usb_regs.o ../HW/Libraries/STM32_USB-FS-Device_Driver/src/usb_init.o ../HW/L
ibraries/STM32_USB-FS-Device_Driver/src/otgd_fs_int.o ../HW/Libraries/STM32_USB-
FS-Device_Driver/src/otgd_fs_dev.o ../HW/Libraries/STM32_USB-FS-Device_Driver/sr
c/otgd_fs_cal.o ../HW/Libraries/STM32_USB-FS-Device_Driver/src/otgd_fs_pcd.o ../
HW/Libraries/CMSIS/Core/CM3/core_cm3.o ../HW/Libraries/CMSIS/Core/CM3/system_stm
32f10x.o      --output main-2000.elf -nostartfiles -Wl,-Map=main-2000.map,--cref
,--gc-sections -lc  -lm -lc -lgcc     -T./STM32F103-ROM2000.ld</pre>
<pre>d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-sbrkr.o): In function `_sbrk_r':
sbrkr.c:(.text+0x12): undefined reference to `_sbrk'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-writer.o): In function `_write_r':
writer.c:(.text+0x16): undefined reference to `_write'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-closer.o): In function `_close_r':
closer.c:(.text+0x12): undefined reference to `_close'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-fstatr.o): In function `_fstat_r':
fstatr.c:(.text+0x14): undefined reference to `_fstat'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-isattyr.o): In function `_isatty_r':
isattyr.c:(.text+0x12): undefined reference to `_isatty'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-lseekr.o): In function `_lseek_r':
lseekr.c:(.text+0x16): undefined reference to `_lseek'
d:/browser/codesourcery/sourcerylite/bin/../lib/gcc/arm-none-eabi/4.4.1/../../..
/../arm-none-eabi/lib/thumb2\libc.a(lib_a-readr.o): In function `_read_r':
readr.c:(.text+0x16): undefined reference to `_read'
collect2: ld returned 1 exit status
make: *** [main-2000.elf] Error 1</pre>
<ul class="list1 list-indent1"><li>stdio周りの関数がリンクエラーになる。</li>
<li>組み込み向けによくやる、 --nostartfilesが悪い？</li>
<li>いや、--nostartfilesを外してもだめなようだ。stdioはlibc (-lc)じゃない？</li></ul>
<p>あ、そうか。</p>
<ul class="list1 list-indent1"><li>libc.a はちゃんと _sbrk_r を持っている。</li>
<li>_sbrk_r が 一番下位のシステムコール _sbrk とか _lseek とか _read を要求している。</li>
<li>一番下位のシステムコール _sbrkは libc.a から呼び出されるべきものであり、中身はたいていの場合、int xxとか svc xxになっている。</li>
<li>そのシステムコールの実装がないだけのようだ・・・。どこから持ってくるのかな？</li></ul>
<p>Linuxでnewlibをビルドしたディレクトリを見たら、</p>
<pre>newlib/libc/sys/arm/syscalls.c:31:caddr_t _sbrk     _PARAMS ((int));</pre>
<p>みたいなところにあった。</p>
<pre>caddr_t
_sbrk (int incr)
{
 extern char   end asm (&quot;end&quot;);    /* Defined by the linker.  */
 static char * heap_end;
 char *        prev_heap_end;
 if (heap_end == NULL)
     heap_end = &amp; end;
 prev_heap_end = heap_end;
 if (heap_end + incr &gt; stack_ptr)
   {
     /* Some of the libstdc++-v3 tests rely upon detecting
    out of memory errors, so do not abort here.  */
     errno = ENOMEM;
     return (caddr_t) -1;
   }
 heap_end += incr;
 return (caddr_t) prev_heap_end;
}</pre>
<p>そもそもこいつらは libc.a には含まれないのか？</p>
<ul class="list1 list-indent1"><li>CodeSourceryやWinARMのlibc.aには含まれないようだ。</li></ul>
<ul class="list1 list-indent1"><li>しかし、Linuxでビルドしたnewlibには含まれている<span style="font-size:28px">謎</span></li></ul>
<pre>$ arm-eabi-nm /usr/local/arm/arm-eabi/lib/libc.a</pre>
<pre>lib_a-syscalls.o:
         U __errno
         U __sinit
000005dc T _close
00000110 T _exit
00000930 T _fstat
00000130 T _getpid
00000144 T _gettimeofday
         U _impure_ptr
00000534 T _isatty
000000bc T _kill
00000138 T _link
000007d8 T _lseek
00000434 T _open
00000140 T _raise
00000830 T _read
00000218 T _rename
00000454 T _sbrk
000008d8 T _stat
00000570 T _swiclose
000006e0 T _swilseek
00000350 T _swiopen
000007f0 T _swiread
000005f4 T _swiwrite
00000274 T _system
0000018c T _times
00000308 T _unlink
00000634 T _write</pre>
<ul class="list1 list-indent1"><li>なんかもう、この辺になると、<strong>ＬチカだけしかやらないようなLiteなArduino野郎</strong>
には手におえない領域になってくる。</li>
<li>ARM/Thumbへのsyscallのポーティング屋とか、newlibのメンテナになることを要求してくるわけだから。</li></ul>
<ul class="list1 list-indent1"><li>この辺がお手軽に出来ないとAVR-&gt;ARMへの移行は難しいな。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>実はWinARMで再度試したところ、リンクエラーになるのは _sbrkのほうではなくて _sbrk_r のほうだった。</li>
<li>たぶん _r 付きはリエントラントなやつなので、ここのレベルで欠落しているとなると話はやっかいだ。</li>
<li>足を踏み入れないほうがよかったかな。</li>
<li>WinARMのnewlibを入れ替えるかLinux版のnewlibをコピーしてきたほうが少し楽だろう。</li></ul>
<p><br />
しかしあれだな。</p>
<ul class="list1 list-indent1"><li>WinAVRで同様にprintfを呼び出してみると、全然リンクエラーもしないし、FILE構造体も
シンプルでわかりやすいに、</li>
<li>WinARMのstdioのほうは、やたらと複雑で無駄にコードサイズも大きくなっているようだ。</li></ul>
<p><br />
<br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_18">STM32:コンパイラを<span class="noexists"><a href="./?cmd=edit&amp;page=CodeSourcery&amp;refer=2010-08">CodeSourcery</a></span> にしたら、かなり縮んだ。<a class="anchor_super" id="na3e94db" href="#na3e94db" title="na3e94db" style="user-select:none;">&dagger;</a></h2>
<p><span class="noexists"><a href="./?cmd=edit&amp;page=CodeSourcery&amp;refer=2010-08">CodeSourcery</a></span> G++ Lite</p>
<ul class="list1 list-indent1"><li><a href="http://www.lineo.co.jp/modules/codesourcery/editions.html" rel="nofollow">http://www.lineo.co.jp/modules/codesourcery/editions.html</a></li></ul>
<ul class="list1 list-indent1"><li>バイナリーサイズが、WinARMだと0x1f80 くらいあったのに、同一ソースが0x1d64にまで縮んだ。</li></ul>
<ul class="list1 list-indent1"><li>Makefileの変更箇所はただの１箇所
<pre>#TCHAIN = arm-eabi     ・・・WinARM:gcc version 4.3.0 (WinARM March 2008)
TCHAIN = arm-none-eabi　・・・CodeSourcery:gcc version 4.4.1 (Sourcery G++ Lite 2010q1-188)</pre></li></ul>
<ul class="list1 list-indent1"><li>コンパイルオプション等は変更していないのに、<strong>こんなに縮むと嬉しいなぁ</strong></li>
<li><strong>半信半疑</strong>だったが、焼いたファームは正しく動いた。</li></ul>
<ul class="list1 list-indent1"><li>ついでなので、_sbrkとか_writeとか_swiwriteとかのコードも追加しておいた。
<ul class="list2 list-indent1"><li>とはいえ、まだprintfが動くわけではない。</li></ul></li></ul>
<p>read more : <a href="stm32f103.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">stm32f103</a></p>
<ul class="list1 list-indent1"><li>あとで、コード品質の比較をする必要性は<strong>大ありだ。</strong></li></ul>
<p><br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_19">コード品質？？？<a class="anchor_super" id="z2ae0c6c" href="#z2ae0c6c" title="z2ae0c6c" style="user-select:none;">&dagger;</a></h2>
<pre>WinARM:gcc version 4.3.0 (WinARM March 2008)</pre>
<p>と</p>
<pre>CodeSourcery:gcc version 4.4.1 (Sourcery G++ Lite 2010q1-188)</pre>
<p>を比較してみた。</p>
<ul class="list1 list-indent1"><li>コンパイルオプションは同一。(-Os)</li></ul>
<ul class="list1 list-indent1"><li>本質的な違いはない。</li></ul>
<p>ただ、コンパイラの癖として、</p>
<ul class="list1 list-indent1"><li>4.3.0のほうは、関数をインライン化したがる傾向にある。</li>
<li>条件分岐より、条件スキップを使いたがる傾向にある。</li>
<li>中身のない関数に対するコードが、WinARMでは&quot; bx lr ; nop &quot;なのに対し、CSでは &quot;bx lr&quot;だけで、4byteの関数アラインメントがない。</li>
<li>WinARMの関数エントリーは4byteアラインメントされていて、CSではされていないということか。</li></ul>
<p>それから、WinARMの、アドレス定数をひねりだすコードは変だ。</p>
<pre>void SetEPTxCount(uint8_t bEpNum, uint16_t wCount)
{
 _SetEPTxCount(bEpNum, wCount);
8001d44:	4b06      	ldr	r3, [pc, #24]	(8001d60 &lt;SetEPTxCount+0x1c&gt;)
8001d46:	681a      	ldr	r2, [r3, #0]
8001d48:	f103 4360 	add.w	r3, r3, #3758096384	; 0xe0000000
8001d4c:	b292      	uxth	r2, r2
8001d4e:	f5a3 5330 	sub.w	r3, r3, #11264	; 0x2c00
8001d52:	eb02 02c0 	add.w	r2, r2, r0, lsl #3
8001d56:	3b4e      	subs	r3, #78
8001d58:	4413      	add	r3, r2
8001d5a:	005b      	lsls	r3, r3, #1
8001d5c:	6019      	str	r1, [r3, #0]
}
8001d5e:	4770      	bx	lr
8001d60:	40005c50 	.word	0x40005c50</pre>
<p>CSではこうなる。</p>
<pre>void SetEPTxCount(uint8_t bEpNum, uint16_t wCount)
{
 _SetEPTxCount(bEpNum, wCount);
8001b3c:	4b04      	ldr	r3, [pc, #16]	; (8001b50 &lt;SetEPTxCount+0x14&gt;)
8001b3e:	4a05      	ldr	r2, [pc, #20]	; (8001b54 &lt;SetEPTxCount+0x18&gt;)
8001b40:	681b      	ldr	r3, [r3, #0]
8001b42:	b29b      	uxth	r3, r3
8001b44:	eb03 03c0 	add.w	r3, r3, r0, lsl #3
8001b48:	189a      	adds	r2, r3, r2
8001b4a:	0052      	lsls	r2, r2, #1
8001b4c:	6011      	str	r1, [r2, #0]
}
8001b4e:	4770      	bx	lr
8001b50:	40005c50 	.word	0x40005c50
8001b54:	20003002 	.word	0x20003002</pre>
<p>CSのほうは0x20003002を32bit定数として置いているけれど、WinARMではまったく別のアドレス定数0x40005c50
から、むりやりひねり出そうとしている。そのコードが無駄に長くなる。</p>
<p><br /></p>
<ul class="list1 list-indent1"><li>バグなんじゃないか？</li>
<li>もしかしたら変数の配置が違うのでアドレスがずれるせいかもしれないけれど・・・<strong>素直じゃない</strong>ことだけは確かだ。</li></ul>
<p><br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_20">なんかswi命令の先あたりでハングする。<a class="anchor_super" id="q190d3b6" href="#q190d3b6" title="q190d3b6" style="user-select:none;">&dagger;</a></h4>
<p>OpenOCDで追っかければいいのだろうけれど・・・</p>
<ul class="list1 list-indent1"><li>swi命令を発行すると、SVC_Handler()に来るのだろうか？？？
<ul class="list2 list-indent1"><li>Cortex-M3に、SWI_Handlerがないんだけど・・・？？？？なんで？</li></ul></li></ul>
<ul class="list1 list-indent1"><li>SVC_Handler()は 普通に bx lr; でリターンしてるけれどいいのかな？
<ul class="list2 list-indent1"><li>普通、特権とかスーパバイザーとかあるはずなので、RTEのような命令で戻るべきなんだけど、</li>
<li>ARM(Cortex-M3)では、どう書けばいいのか不明。</li></ul></li></ul>
<ul class="list2 list-indent2"><li>PICでは #pragma interrupt &lt;FUNCNAME&gt;か、#pragma interruptlow  &lt;FUNCNAME&gt;だったし、</li>
<li>AVRはISR(Vector_Name) で関数を書けばいいはずだった。</li>
<li>ARMで
<pre>void SVC_Handler() __attribute__((interrupt(&quot;SWI&quot;)));</pre>
とか書いてみたけどよくわからない・・・・</li></ul>
<ul class="list1 list-indent1"><li>解説書きぼんぬ。</li></ul>
<ul class="list1 list-indent1"><li><a href="http://www.kimura-lab.net/wiki/index.php/CMSIS:_Cortex_Microcontroller_Software_Interface_Standard" rel="nofollow">http://www.kimura-lab.net/wiki/index.php/CMSIS:_Cortex_Microcontroller_Software_Interface_Standard</a></li></ul>
<p><br />
<br /></p>
<hr class="full_hr" />
<p>なんかCortex-M3の例外復帰は、普通じゃないな。</p>
<ul class="list1 list-indent1"><li><a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.ddi0337gj/DAFCDHGG.html" rel="nofollow">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.ddi0337gj/DAFCDHGG.html</a></li></ul>
<ul class="list1 list-indent1"><li>PC=0xfffffffX の Xの値でどうのこうのと・・・。</li>
<li>つまり、４ＧＢの最後の16byteはリザーブなのか。</li></ul>
<ul class="list1 list-indent1"><li>割り込みが連続した場合のpopとpushをサボるようなinterrupt chainも持ってるし、ハード割り込み後に遅延ソフト割り込みの予約が出来たりと、いろいろ変なことができるらしいので、マニュアルをちゃんと読まないと駄目か。</li></ul>
<p><br /></p>
<hr class="full_hr" />
<p>ARMのサイトを見る限りだと、</p>
<ul class="list1 list-indent1"><li><a href="http://www.jp.arm.com/document/whitepater/pdf/fin_IntroToCortex-M3%20reviewed.pdf" rel="nofollow">http://www.jp.arm.com/document/whitepater/pdf/fin_IntroToCortex-M3%20reviewed.pdf</a></li></ul>
<pre>例外が発生すると、プログラム・カウンタ、プログラム・ステータス・レジスタ、
リンク・レジスタ、R0〜R3、R12 の汎用レジスタがスタックにプッシュされます。
データ・バスがレジスタをスタックする一方、命令バスはベクタ・テーブルから
例外ベクタを特定し、例外コードの最初の命令をフェッチします。</pre>
<pre>スタッキングと命令フェッチが終了すると、割り込みサービス・ルーチンまたは
フォールト・ハンドラが実行され、割り込まれたプログラムが通常実行を再開できるよう、
レジスタが自動的に復元されます。</pre>
<pre>ハードウェアでスタック操作を処理することにより、Cortex-M3 プロセッサは、
従来のCベースの割り込みサービス・ルーチンにおけるスタック操作に必要な
アセンブラ・ラッパの記述を不要にし、アプリケーション開発を大幅に容易にします。 </pre>
<ul class="list1 list-indent1"><li>と、書いてあるので、68000のような RTS / RTE の使い分けすら不要な感じ。</li>
<li>つまりレジスタ退避とか特権チェンジとかさえ、意識しないで、単純にＣの関数がそのまま
割り込みハンドラーに登録できるというのか？</li></ul>
<ul class="list1 list-indent1"><li><strong>半信半疑</strong>だな。</li></ul>
<p><br /></p>
<hr class="full_hr" />
<p>しかし、Cortex-M3のマニュアルを見ると、</p>
<ul class="list1 list-indent1"><li><a href="https://www.jp.arm.com/document/manual/files/fin_1226_DDI0337.pdf" rel="nofollow">https://www.jp.arm.com/document/manual/files/fin_1226_DDI0337.pdf</a></li></ul>
<ul class="list1 list-indent1"><li>例外発生時には、【xPSR,PC,LR,R12,R3,R2,R1,R0】の８本のレジスタを積んだ後、</li>
<li>LRに 0xfffffffX (最後のXは例外からの退出方法が書かれている)を代入する、とある。</li></ul>
<ul class="list1 list-indent1"><li>なので、普通に、割り込みハンドラーは、Ｃ言語の関数のままで良いのか。</li>
<li>関数リターンでPCに0xfffffffX という値が代入されたら、ハードウェアが自動的に例外退出シーケンスを実行するので、</li>
<li>上記８本のレジスタはきれいに元通りになるというわけだ。</li></ul>
<hr class="full_hr" />
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_21">え？５兆桁って、日本人が達成したの？<a class="anchor_super" id="r639d025" href="#r639d025" title="r639d025" style="user-select:none;">&dagger;</a></h2>
<p>円周率５兆けた、ＰＣで計算　長野の会社員、３カ月かけ</p>
<ul class="list1 list-indent1"><li><a href="http://www.asahi.com/science/update/0804/TKY201008040488.html?ref=rss" rel="nofollow">http://www.asahi.com/science/update/0804/TKY201008040488.html?ref=rss</a></li>
<li><a href="http://slashdot.jp/science/10/08/04/0740221.shtml" rel="nofollow">http://slashdot.jp/science/10/08/04/0740221.shtml</a></li></ul>
<pre>５兆＝ 5 x 10^12 ＝ 5 Tera</pre>
<ul class="list1 list-indent1"><li>なので、到底オンメモリーに入りません。</li>
<li>HDDが２２ＴＢ要るんだ。</li></ul>
<ul class="list1 list-indent1"><li>いまどき、1TB＝5千円 とはいえ、１１万円掛かるんだよなーストレージだけでも。</li></ul>
<p>google先生がその気になれば、クラウドパワーで簡単に記録を抜けるんだろうけれど・・・</p>
<ul class="list1 list-indent1"><li>超多桁のπの使い道がない・・・。</li></ul>
<p><br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_22">y-cruncherというPiの計算ソフト（x86/x64バイナリー含む）は、以下のサイトからＤＬ出来る。<a class="anchor_super" id="ff649f5c" href="#ff649f5c" title="ff649f5c" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li><a href="http://www.numberworld.org/y-cruncher/#Download" rel="nofollow">http://www.numberworld.org/y-cruncher/#Download</a></li>
<li>計算公式はChudnovsky Formula</li>
<li>手元のパソコンで試してみた。（誰でも試せる）</li></ul>
<p>２５００万桁</p>
<pre>Decimal Digits    :   25,000,000  
Hexadecimal Digits:   Disabled

Threads:    1
Mode   :    Ram Only

Start Time: Fri Aug 06 06:42:12 2010


Allocating and Reserving Memory...       167 MB
Constructing FFT lookup tables...


Begin Computation:

Summing Series:  1,762,845 terms
Time:    106.343 seconds  ( 0.030 hours )
InvSqrt...
Time:    5.250 seconds  ( 0.001 hours )
Final Multiply...
Time:    3.392 seconds  ( 0.001 hours )

Pi:  114.987 seconds  ( 0.032 hours )</pre>
<ul class="list1 list-indent1"><li>CPUはPentiumE5200(2.5GHz)シングルスレッド。</li></ul>
<ul class="list1 list-indent1"><li>なんかこんな結果。</li></ul>
<pre>Total Computation Time:             131.814 seconds  ( 0.037 hours )
Total Time (with output + verify):  137.509 seconds  ( 0.038 hours )

CPU Utilization:        99.5843 %
Multi-core Efficiency:  49.7922 %

Last Digits:  Pi
3803750790 9491563108 2381689226 7224175329 0045253446  :  24,999,950
0786411592 4597806944 2455112852 2554677483 6191884322  :  25,000,000 

Version:          0.5.4 Build 9148 (fix 1) (x86 SSE3 - Windows)
Processor(s):     Pentium(R) Dual-Core CPU E5200 @ 2.50GHz
Logical Cores:    2
Physical Memory:  1,542,631,424 ( 1.43 GB )
CPU Frequency:    2,493,810,399 Hz  (frequency may be inaccurate)

Benchmark Successful. The digits appear to be OK.

Result File: Validation - Pi - 25,000,000.txt</pre>
<p>５兆桁計算した人は、アマ無線の人だった。</p>
<ul class="list1 list-indent1"><li><a href="http://ja0hxv.calico.jp/pai/start.html" rel="nofollow">http://ja0hxv.calico.jp/pai/start.html</a></li></ul>
<ul class="list1 list-indent1"><li>計算プログラムは日本人のオリジナルではなくて、<a href="http://www.numberworld.org/nagisa_runs/default.html" rel="nofollow">米国のアレクサンダー・Ｊ・イー</a>という人のものらしい。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>Xeonが２個刺さるマザーでやったのね。
<pre>2 x Intel Xeon X5680 @ 3.33 GHz
96 GB DDR3 @ 1066 MHz
16 x 2 TB</pre></li>
<li>これだけのマシンとなると、メモリーやＨＤＤも当然高価だけれど、</li>
<li>Windows2008のOSが高そう・・・。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>軽く４Ｇで回りそうな石を定格で回して求めているところが<strong>男らしい</strong></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_23">こっちは、半年前の２.７兆桁の記事。<a class="anchor_super" id="t77383af" href="#t77383af" title="t77383af" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li><a href="http://slashdot.jp/science/10/01/06/0336215.shtml" rel="nofollow">http://slashdot.jp/science/10/01/06/0336215.shtml</a></li>
<li><a href="http://science.slashdot.org/article.pl?sid=10/01/05/006243" rel="nofollow">http://science.slashdot.org/article.pl?sid=10/01/05/006243</a></li></ul>
<p>２.７兆桁計算したFabrice Bellardさんは、<strong>QEMUの作者</strong>らしい。</p>
<ul class="list1 list-indent1"><li><a href="http://bellard.org/" rel="nofollow">http://bellard.org/</a></li></ul>
<p>しかも、スパコンですらない、<strong>普通のパソコンで！</strong></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_24">ひと目でわかる、アニメーションで説明したメキシコ湾・原油流出100日間<a class="anchor_super" id="mbd4cfbd" href="#mbd4cfbd" title="mbd4cfbd" style="user-select:none;">&dagger;</a></h2>
<p>らばＱ</p>
<ul class="list1 list-indent1"><li><a href="http://labaq.com/archives/51486901.html" rel="nofollow">http://labaq.com/archives/51486901.html</a></li></ul>
<ul class="list1 list-indent1"><li>悲惨</li>
<li>そもそもこれは試掘井だったらしい。</li>
<li>まだ止まってないという情報もある。</li>
<li><a href="http://ytaka2011.blog105.fc2.com/blog-entry-182.html" rel="nofollow">http://ytaka2011.blog105.fc2.com/blog-entry-182.html</a></li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_25">Cortex-M3:浮動小数演算でハング<a class="anchor_super" id="jab4c34f" href="#jab4c34f" title="jab4c34f" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>とりあえず、インチキprintを実装した。
<ul class="list2 list-indent1"><li>ＰＩＣで使われていた、_user_putc()と_user_puts()だ。</li>
<li>ARMのnewlibのprintは、まだ動かない。</li></ul></li>
<li>それで、sprintfは使えるはずなので、適当な浮動小数点数をsprintfしようとするとハングする。</li></ul>
<ul class="list1 list-indent1"><li>理由は良く分からない。</li></ul>
<p>これから調べる。</p>
<ul class="list1 list-indent1"><li>浮動小数演算のみではハングしない。</li>
<li>演算結果をメモリーダンプすると正常っぽい。</li>
<li>sprintfで&quot;%g&quot;とか&quot;%f&quot;が全滅だ。</li></ul>
<p><strong>なんで？</strong></p>
<ul class="list1 list-indent1"><li>malloc()を呼び出しただけでハングしているので、おそらく_sbrk()のアドレスがおかしいのだろうと
仮定を立ててみる。</li>
<li>_sbrk()は、最初に呼び出されると、 endというラベルの値を返す。</li>
<li>が、ARM(STM32)では、微妙にendが_bss_endでもなくてuser_stackとかぶっていたりする。</li>
<li>試しに手動で空き番地を返すようにしてみたのだが・・・やっぱりハングする。</li></ul>
<p>真面目にmalloc()を読むしかないか。</p>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_26">_sbrkの動作そのものがおかしいことが分かった。<a class="anchor_super" id="nc7364f9" href="#nc7364f9" title="nc7364f9" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>staticな変数が０初期化されていないため、初回のsbrkの戻り値が、とんでもない値（バスエラーするアドレス）
になっている。</li></ul>
<ul class="list1 list-indent1"><li>かといって、他の場所のstatic変数はちゃんと初期化できている謎・・・。</li></ul>
<p>_sbrk()関数にprint文を埋め込んで調べることが出来るようになった。</p>
<ul class="list1 list-indent1"><li>大きな進歩だ。</li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_27">とりあえず、動くようにはなったが・・・<a class="anchor_super" id="o227940b" href="#o227940b" title="o227940b" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>原因は、malloc()が悪いのではなくて、あくまでも_sbrk()が持つ<strong>staticなポインタの初期値が悪い</strong>、ということが分かった。</li>
<li>何故なのか分からない。</li></ul>
<ul class="list1 list-indent1"><li>static な変数に初期値０を与えているのは自明なのだけれど、その初期値はとんでもない数値が入っているのだ。</li></ul>
<ul class="list1 list-indent1"><li>回避策は、初期値０チェックのところに、異常値チェックも入れて、ともかくheapの先頭の値に初期化するようにした。</li>
<li>そうしたところ、malloc()は正しいポインタを返すようになり、sprintfの&quot;%g&quot;も正常に動作するようになった。</li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_28">現在の問題点<a class="anchor_super" id="jac1456e" href="#jac1456e" title="jac1456e" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>Flashの書き込みが遅い。(コードサイズが３２ｋより大きくなったので、書き込みに１０秒くらいかかる)</li>
<li>Flash書き込み後、自動スタートしない。---直さなきゃ。</li>
<li>アプリケーションをスタートさせたあとで、BOOTLOADERに戻すのが面倒くさい。
<ul class="list2 list-indent1"><li>ジャンパーをCLOSEして、USB挿抜を１回。</li></ul></li></ul>
<p><br />
とりあえず、浮動小数点は使えるし、printも出来るようにはなったのだが、</p>
<ul class="list1 list-indent1"><li>なぜ、sbrk(というかsyscall.c)だけ、static変数の初期値がおかしくなるのかを調査しなければ・・・。</li></ul>
<p><br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_29">sbrkだけ、static変数の初期値がおかしくなるのは何故か？<a class="anchor_super" id="a5b1094a" href="#a5b1094a" title="a5b1094a" style="user-select:none;">&dagger;</a></h4>
<p>gccのスマートリンク機構にバグ？</p>
<ul class="list1 list-indent1"><li>gccのオプション -fdata-sections を入れると、以下のようなmain.lssファイル
が生成される。</li></ul>
<pre>Sections:
Idx Name          Size      VMA       LMA       File off  Algn
 0 .isr_vector   0000010c  08002000  08002000  00002000  2**0
                 CONTENTS, ALLOC, LOAD, READONLY, DATA
 1 .ARM.exidx    00000008  0800210c  0800210c  0000210c  2**2
                 CONTENTS, ALLOC, LOAD, READONLY, DATA
 2 .text         00007534  08002118  08002118  00002118  2**3
                 CONTENTS, ALLOC, LOAD, READONLY, CODE
 3 .data         000005e4  20000000  0800964c  00010000  2**2
                 CONTENTS, ALLOC, LOAD, DATA
 4 .bss          000002b8  200005e4  08009c30  000105e4  2**2
                 ALLOC
 5 .bss.led_cnt.4435 00000004  2000089c  08009ee8  000105e4  2**2
                 ALLOC
 6 .bss.sbrk_heap_end.2983 00000004  200008a0  08009eec  000105e4  2**2
                 ALLOC
 7 .bss.bIntPackSOF 00000001  200008a4  08009ef0  000105e4  2**0
                 ALLOC
 8 .bss.bDeviceState 00000004  200008a8  08009ef4  000105e4  2**2
                 ALLOC
 9 .bss.Data_Mul_MaxPacketSize 00000001  200008ac  08009ef8  000105e4  2**0
                 ALLOC
10 ._usrstack    00000103  200008ad  08009ef9  000105e4  2**0
                 ALLOC
                 ・・・・</pre>
<ul class="list1 list-indent1"><li>.bssセクションは０クリアされるが、 .bss.sbrk_heap_end セクションは .bssセクションの外だと
認識されていて、０クリアの対象外になっているのが、不定値を取る原因だ。</li></ul>
<ul class="list2 list-indent2"><li>なぜ、他のセクション （.text.funcname とか .data.xxxxとか）は、正しく統合されているのに
.bssセクションだけ、中途半端にバラけるのだろう？？？</li></ul>
<p>理由はわりと簡単だった。</p>
<pre>リンカースクリプトの
.bss :
{
       ・・・
       *(.bss)    
       ・・・
}</pre>
<p>の中に、</p>
<pre>       *(.bss.*)</pre>
<p>を追加し忘れているようだ。（犯人は俺じゃない！）</p>
<ul class="list2 list-indent2"><li>sbrk以外にも、上記 .bss.ナントカ と付いた変数も全て０クリアされないので、<strong>バグの原因</strong>になる。</li></ul>
<ul class="list1 list-indent1"><li>-fdata-sectionsを外せば、全部 .bssに統合され、バグらなくなる。（ので、そうした）</li>
<li>-ffunction-sectionsだけでも、充分に不要コードを削除してくれているので、これでもＯＫ。</li></ul>
<hr class="full_hr" />
<ul class="list1 list-indent1"><li>そもそも、-ffunction-sectionsと-fdata-sections、そして、リンカオプションの -gc-sections　の役割は、
<ul class="list2 list-indent1"><li>.text , .data , .bss の各セクションをさらに関数名（や、配列名）で細分化して、.text.funcname とか .data.arrayname のような細かいセクションに分割した後、リンク時に、未参照セクションをガベージコレクションで取り外すことによって、実行ファイルのサイズを小さくするオプションだ。</li>
<li>普通は、「スマート・リンク」などと呼ばれているし、Visual-C++などでも標準的にそのようなリンクになっている。</li>
<li>（けれど、gccとldでは、上記のように明示的にオプションを入れない限り、スマートリンクしてくれないことになっている）</li></ul></li></ul>
<p><br /></p>
<p>とりあえず、<strong>解決!!</strong></p>
<p><br />
read more : <a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_30">さて、次なるターゲットは・・・<a class="anchor_super" id="d197668d" href="#d197668d" title="d197668d" style="user-select:none;">&dagger;</a></h2>
<p>LPCXpresso(LPC3154+LPC1343)</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" alt="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" /></a></li></ul>
<ul class="list1 list-indent1"><li>２つに割ってみた。</li>
<li>普通にＰカッターで少し溝を掘ったあとで、普通のカッターナイフで深く切ってみた。</li>
<li>ベークならそれですぐパキッと割れるんだけど、ガラエポなんで中の繊維が意外としつこい。</li></ul>
<ul class="list1 list-indent1"><li>LPC3154はFlashが載っていない。</li>
<li>このため、接続時に毎回DFUでファームを送り込む必要があるはず。（未確認）</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_31">Cortex-M3:浮動小数演算でハングは解決<a class="anchor_super" id="jff29336" href="#jff29336" title="jff29336" style="user-select:none;">&dagger;</a></h2>
<p>とりあえず、<strong>解決!!</strong></p>
<ul class="list1 list-indent1"><li>ついでに、printf(&quot;%g&quot;)もＯＫになった。</li></ul>
<p><br />
read more : <a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_32">300MHzのARM9搭載ノート風PDA:14,970円。<a class="anchor_super" id="lb2b23cc" href="#lb2b23cc" title="lb2b23cc" style="user-select:none;">&dagger;</a></h2>
<p>1万5千円のネットブック風PDA発売、WinCE</p>
<ul class="list1 list-indent1"><li><a href="http://akiba-pc.watch.impress.co.jp/hotline/20100619/ni_cnote7.html" rel="nofollow">http://akiba-pc.watch.impress.co.jp/hotline/20100619/ni_cnote7.html</a></li>
<li>RAM 256MB,Flash 2GBだそうな。</li>
<li>Android動作も辛そうなクロック。</li>
<li>ubuntu動作も辛そうなRAMサイズ。</li>
<li>じゃあTinyCoreのようなLinuxでも乗せる？</li></ul>
<p>キーボードが<strong>英語キー!!</strong></p>
<ul class="list1 list-indent1"><li>一応USBは2.0だな。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_33">玄箱: lenny化失敗<a class="anchor_super" id="q85b6aef" href="#q85b6aef" title="q85b6aef" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>debian etchでは、知らん間にapt-get出来なくなっている。</li>
<li>しかたないのでlenny化を模索中。</li></ul>
<p>試したこと</p>
<ul class="list1 list-indent1"><li>まず、backup。てきとーに。</li>
<li>fdiskでパーティションを見かけ上全部消して再起動。</li></ul>
<ul class="list1 list-indent1"><li>起動してもBusyBoxが反応しない。192.168.11.150もだめ。DHCPのアドレスっぽいのも全部試したけれどだめ。</li></ul>
<ul class="list2 list-indent2"><li>もちろん、別のLinuxBox上で以下のおまじないは実行してある。
<pre># ifconfig eth0:0 192.168.11.10 netmask 255.255.255.0 broadcast 192.168.11.255</pre></li></ul>
<ul class="list1 list-indent1"><li>RESET５秒押しもだめ。</li></ul>
<p>別のx86なPCに繋いで、適当なCDROM-Linuxから起動し、パーティションテーブルを元に戻す。</p>
<ul class="list1 list-indent1"><li>一応元通りのdebian etchは起動する。</li>
<li>/dev/mtd3をマウントして、０バイトのファイル２個（ChangeMeDevHDD    <span class="noexists"><a href="./?cmd=edit&amp;page=ChangeMyUbootEnv&amp;refer=2010-08">ChangeMyUbootEnv</a></span>）を消してみる。</li>
<li>ブート。だめ。</li></ul>
<ul class="list1 list-indent1"><li>それでもdebian etchに戻っている。</li></ul>
<p>netを探していたら、大抵はシリアルコンソールで切り替えているようだ。</p>
<pre>◆Flash Bootモードへの切り替え
Marvell&gt;&gt; setenv bootargs_root root=/dev/mtdblock2 rw panic=5
Marvell&gt;&gt; setenv vootcmd 'nboot $(default_kernel_addr) 0 $(nand_uImage_offset);  bootm $(default_kernel_addr)'
Marvell&gt;&gt; setenv nand_boot yes
Marvell&gt;&gt; setenv bootargs $(bootargs_base) $(bootargs_root) $(buffalo_ver)
Marvell&gt;&gt; saveenv
Marvell&gt;&gt; reset </pre>
<pre>◆HDD Bootモードへの切り替え
Marvell&gt;&gt; setenv bootargs_root 'root=/dev/sda4 rw panic=5'
Marvell&gt;&gt; setenv vootcmd 'ide reset; ext2load ide 0:1 $(default_kernel_addr) / $(kernel); bootm $(default_kernel_addr)'
Marvell&gt;&gt; setenv nand_boot no
Marvell&gt;&gt; setenv bootargs $(bootargs_base) $(bootargs_root) $(buffalo_ver)
Marvell&gt;&gt; saveenv
Marvell&gt;&gt; reset </pre>
<p>シリアル繋ぐの面倒くさいなぁ・・・。</p>
<p>なんでDIP-SWくらい実装しないんだろう・・・。</p>
<pre>Linux の nvram コマンドを使う 
  nvram は KURO-BOX/PRO 特有のコマンドです。 
 環境変数を書き込むには以下のようにします。 setenv と違い、変更内容は直ちに書き込みされます。 
# nvram -c set [環境変数名] [環境変数の内容]
以下のようにコマンド発行すると、環境変数の全リストが表示されます。上記の変更に入力誤りはないか、このコマンド操作でチェックします。 
# nvram -c printenv</pre>
<p>という方法もあるみたいだが、/dev/mtd2/をマウントした/mnt/mtd2/usr/local/sbin/nvram というコマンド(elf)は残念ながらdebian(etch)上では動かない。</p>
<ul class="list1 list-indent1"><li>ということはシリアルコンソール確定なのだろうか？？？</li></ul>
<ul class="list1 list-indent1"><li>HDDを物理的に外してみてBusyBoxが立ち上がればいいのだが・・・。</li></ul>
<ul class="list1 list-indent1"><li>それでもだめなら、ダミーの空HDDを用意してBusyBoxの立ち上げをこころみる・・・。</li></ul>
<p>面倒臭いなぁ・・・。</p>
<p><br /></p>
<ul class="list1 list-indent1"><li>結局、アーキテクチャーarm-oabiのまま、dist-upgradeしてしまった。</li>
<li>とりあえずapt-get出来るようにはなった。</li>
<li>lennyの次でarm-oabi(arm-elf)は切り捨てられるのだろう・・・。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_34">ARMプロセッサの系譜<a class="anchor_super" id="c9e5be00" href="#c9e5be00" title="c9e5be00" style="user-select:none;">&dagger;</a></h2>
<p><span class="noexists"><a href="./?cmd=edit&amp;page=WikiPedia&amp;refer=2010-08">WikiPedia</a></span></p>
<ul class="list1 list-indent1"><li><a href="http://ja.wikipedia.org/wiki/ARM%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" rel="nofollow">http://ja.wikipedia.org/wiki/ARM%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3</a></li></ul>
<p>IT Media</p>
<ul class="list1 list-indent1"><li><a href="http://plusd.itmedia.co.jp/mobile/news/0108/22/arm2.html" rel="nofollow">http://plusd.itmedia.co.jp/mobile/news/0108/22/arm2.html</a></li></ul>
<ul class="list1 list-indent1"><li>こうなると、Cortexなんてごく最近のアーキテクチャーなのか。</li>
<li>組み込み用途ではCortex-M0,M3なんてのがある。<a href="ARM.html" class="link_page_passage" data-mtime="2014-06-23T17:20:51+09:00">ARM</a></li>
<li>Cortex-M4は、なんとDSP機能とかFPU付きとかSIMDとか言っているらしい。クロックも多少上がるのか。</li>
<li>ならば、もう他のマイコン(H8/AVR/PIC/PIC32/AVR32/SH2)は今後いらなくなるかも・・・。</li></ul>
<p>EE TIMES</p>
<ul class="list1 list-indent1"><li><a href="http://eetimes.jp/news/3709" rel="nofollow">http://eetimes.jp/news/3709</a></li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_35">作りかけのARM用HID bootloader<a class="anchor_super" id="qaf7856b" href="#qaf7856b" title="qaf7856b" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>CQ-STARMとSTBEEで仮バージョンが動くようになった。</li>
<li>しかし、STBEE Miniで全く動かない。</li>
<li>理由は不明。</li>
<li>一応JTAGはOFFったつもり。</li>
<li>USBのPULL-UPポートは全部バラバラに違っているし、Miniだけ正論理(HでPULL-UP)なはず。</li>
<li>そこまでは対応したのだけれど、そもそもＬチカしないって何だよ。</li></ul>
<p>意味わかんない。</p>
<ul class="list1 list-indent1"><li>とりあえず、純正Ｌチカでも試すか・・・。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_36">原因はJTAGのDISABLE忘れだった。<a class="anchor_super" id="t66a55bc" href="#t66a55bc" title="t66a55bc" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>STBEE MiniではJTAG機能PinをUSBのpull-up(PA14=TCK)やLED(PA13=TMS)で使う(PA14)ので、JTAGをDisableしないとトラブルが起きるようになっている。（<strong>地雷</strong>）</li>
<li>で、DISABLEコードを埋め込んだつもりがビルドエラーしているのに気づかず古いHEXを焼いて動かない動かないと・・・。アホか。</li></ul>
<p><br />
read more : <a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_37">ARMマイコン パーフェクト学習基板<a class="anchor_super" id="ec3fed6b" href="#ec3fed6b" title="ec3fed6b" style="user-select:none;">&dagger;</a></h2>
<p><a href="http://www.cqpub.co.jp/hanbai/books/mtr/mtrz201009.htm" rel="nofollow">http://www.cqpub.co.jp/hanbai/books/mtr/mtrz201009.htm</a></p>
<ul class="list1 list-indent1"><li>買うべき？それとも・・・</li></ul>
<p>LPCXpressoとの抱き合わせ販売まである。</p>
<ul class="list1 list-indent1"><li><a href="http://shop.cqpub.co.jp/hanbai/books/I/I000021.html" rel="nofollow">http://shop.cqpub.co.jp/hanbai/books/I/I000021.html</a></li>
<li>3780 + 2800 = 6580 かあ・・・まあ秋月の送料が要らないというだけ。</li></ul>
<ul class="list1 list-indent1"><li>LPCXpressoは基板を切り離しただけで、飽きて放置していたり。</li>
<li><a href="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" alt="http:/ATMEL_AVR/jpg/ARM/lpc1343.jpg" /></a>
LPCXpresso(LPC3154+LPC1343)</li></ul>
<p>ARMマイコンのダメなところを吐露してしまおう。</p>
<ul class="list1 list-indent1"><li>チップ単体で買っても、基板を起こすのが大変というか面倒。</li>
<li>開発環境が（gccとかEclipseのくせに）オープンソースでもなくフリーでもない制限つき。（無償版はいくつか制限がついている）<strong>微妙にセコい。</strong></li>
<li>複数の開発環境ベンダーがあって、それぞれに互換性がない。
<ul class="list2 list-indent1"><li>まあ自分でクロスgccをビルドする人には関係ないが。</li></ul></li>
<li>いわゆるJTAGデバッグケーブルが高い。（LPCXpressoは例外的に安いけれど、実はJTAGじゃなかったりする）</li>
<li>同じCortex-M3アーキテクチャーを謳いながら、STMicroとNXPでペリフェラルが全然違うし、</li>
<li>同じNXPでもLPCxxxxのxxxxが違うとペリフェラルが全然違っていて、<strong>あのMicroChipでさえ</strong>、きちんと互換になるようなヘッダーやライブラリを提供しているのにNXPにはその気配がない。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_38">次なるターゲット<a class="anchor_super" id="p2ff4fc2" href="#p2ff4fc2" title="p2ff4fc2" style="user-select:none;">&dagger;</a></h2>
<p>LPCXpresso(LPC3154+LPC1343)</p>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/jpg/ARM/xpresso2.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/jpg/ARM/xpresso2.jpg" alt="http:/ATMEL_AVR/jpg/ARM/xpresso2.jpg" /></a></li></ul>
<ul class="list1 list-indent1"><li>２つに割った基板をこんどは連結できるようにピンヘッダーを立ててみた。</li>
<li>連結方法は、適当なＩＣソケットをひっくり返して差し込むという投槍的なヤツを作ってみた。（ケーブルを作るのが面倒だから）</li></ul>
<ul class="list1 list-indent1"><li>そして、LPC1343側にUSB-Bコネクタを結線して、インチキ臭いＬＤＯレギュレータ（嘘。2SC1815だよーん）を載せた。</li>
<li>そしたら、ファームを焼いた覚えは全くないのに、勝手にＬチカが走っているようだ。</li>
<li>最初からテストが焼かれているのかな？</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_39">とりあえず結線だけはほぼ終了。<a class="anchor_super" id="q7241b1d" href="#q7241b1d" title="q7241b1d" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>実はUSBのpull-up回路だけ未配線。--- USB-VBUS(0-3)とUSB-CONNECT(0-6)を配線した。（但しUSB-CONNECT pullupは正論理つまり抵抗へ直結）</li></ul>
<ul class="list1 list-indent1"><li>これでもう<a href="http://www.cqpub.co.jp/hanbai/books/mtr/mtrz201009.htm" rel="nofollow">トラ技</a>はパスかなー。</li></ul>
<p>最初+5Vの接続場所を間違えて、3V3に4V強を入れてしまったのは内緒だ。（それでも妙に明るいＬチカしてたけど）</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_40">あれ？次なるターゲット<strong>LPC-1343</strong>って、ROMもRAMも少ないな(32k+8k)<a class="anchor_super" id="e0bbad2f" href="#e0bbad2f" title="e0bbad2f" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li><a href="http://akizukidenshi.com/catalog/g/gM-03598/" rel="nofollow">http://akizukidenshi.com/catalog/g/gM-03598/</a></li>
<li>printfも試せないくらい。</li>
<li>てゆーかPIC18F2550とおんなじじゃないか。(Flash ROM)</li>
<li><strong>それどころじゃない</strong>。Flashのアドレスは０始まりだし、RAMは1000_0000だし、GPIOも5000_0000で全然違うやん。</li>
<li>RCCもないようだ。これじゃあ<strong>STM32とは全くの別物</strong></li></ul>
<ul class="list1 list-indent1"><li>おなじCortex-M3なんだから、<strong>統一しろ!!</strong>と言いたい。</li></ul>
<p>2800円の割りに全然おいしくないぞ＞NXP</p>
<ul class="list1 list-indent1"><li>むしろ<strong>LPC3154</strong>のほうを攻略すべきなのか？そうなのか？</li>
<li>そうすると、またLPC1343が焼けなくなる？というわけではない。だって3154側にはFlash-ROMは一切載ってないし、ハードウェア改造もしないし。</li>
<li>STM8S-DiscoveryのST-LINK側だって、JTAGのピンヘッダーを立てただけで、パターンカットや配線追加は行ってはいない。</li></ul>
<p><br />
<br />
<br />
・・・</p>
<ul class="list1 list-indent1"><li>ところが、こいつ(LPC1343)、マニュアルによると、CPU内部に16kBものBOOT ROMを持っていて、
UARTかUSB(MSCデバイス)からブートする機能があるらしい。
<ul class="list2 list-indent1"><li>PIO0-1がboot選択で、PIO0-3がUART/USBの選択になっているっぽい。</li>
<li>MSCデバイスって、何？--- たぶんMass Strage Classのことなんだろうな。</li>
<li>じゃあ、とりあえずシリアルからブートさせよっかなー。</li></ul></li>
<li>内蔵Flashが32kしかないのにBOOT-ROMを16k持っているとは、なかなか手ごわい。</li></ul>
<p><br />
実際に試してみた。</p>
<ul class="list1 list-indent1"><li>PIO0-1をGNDに繋ぐとＬチカせずにＬ点灯固定になり、USBは不明なデバイスになった。</li>
<li>PIO0-3は一応USB-VBUS(5V)に繋いだつもり。（直結でよかったのかな？？？やばいのかな）</li></ul>
<ul class="list1 list-indent1"><li>もう一度配線を確認すると、USB D-に2kΩpullupを繋いでいた。（AVRの回路を参考にしたもが間違いだった）</li>
<li>良く考えたら、ARMはUSB FullSpeedであり、AVRはLowSpeedなので、ARMの場合はUSB D+をpullupしなければならないのだ。</li></ul>
<p>で、配線を直して試してみると、</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_41">あらびっくり、ほんとにUSBマスストレージデバイスが出現<a class="anchor_super" id="ecf3d79c" href="#ecf3d79c" title="ecf3d79c" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>32kB容量のCRP DISABLDというドライブが出来て、そのなかにfirmware.binという32kBのバイナリーが現れた。</li>
<li>hex dumpすると、どうやらファームウェアＲＯＭが見える。</li>
<li>ということはこのMSCデバイスに書き込めればファーム更新まで出来るというのか？？？？</li></ul>
<p><strong>へぇー。ブートローダー書かなくてよくなった。</strong></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_42">ほんとうにやってみた。<a class="anchor_super" id="n905e69e" href="#n905e69e" title="n905e69e" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>firmware.bin をWindowsにコピーする。</li>
<li>Bzエディタ（兵藤さん作）で空き領域に落書きする。</li>
<li>こんどはそれを32kBのMSC（マスストレージクラス）のドライブに書き戻す。</li></ul>
<ul class="list1 list-indent1"><li>USBケーブルを一回抜いて挿しなおす。</li></ul>
<ul class="list1 list-indent1"><li>もいっかいfirmware.bin をBzエディタで開いて落書きが残っているのを確認。</li></ul>
<p><strong>ＯＫだった</strong></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_43">armon:ARM用HID bootloader<a class="anchor_super" id="m4ea5c05" href="#m4ea5c05" title="m4ea5c05" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>一応、手持ちのSTM32全ての基板をarmon化して、動作確認を行った。</li></ul>
<p><strong>問題ない</strong></p>
<p>サポートする基板は４種類</p>
<ul class="list1 list-indent1"><li>STM8S-Discovery</li>
<li>CQ-STARM</li>
<li>STBEE</li>
<li>STBEE Mini</li></ul>
<p><br />
HIDクラスのbootloaderとして機能する。</p>
<ul class="list1 list-indent1"><li>bootloaderのサイズは８ｋＢ。</li>
<li>いずれの基板においても、0x0800_2000〜にユーザーアプリケーション(HEX)を焼いて、即時起動する機能がある。</li>
<li>ユーザーアプリケーションがUSBを使用する場合でもUSBデバイスは再接続されて機能する。</li>
<li>書き込みは(DFUと比較する限り)充分高速だ。</li></ul>
<p><br /></p>
<p>Thumb2の逆アセンブラ機能も実装した。</p>
<ul class="list1 list-indent1"><li>これまではPIC18Fの恥ずかしい逆アセンブラが動作していた。</li></ul>
<p><br />
I/Oポートの名称解決機能はない。</p>
<p><br />
read more : <a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_44">次なるターゲット・・・<a class="anchor_super" id="d0fd11eb" href="#d0fd11eb" title="d0fd11eb" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>LPCXpresso(NXP全般)は、もういいや。</li>
<li><a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a>の改良はぼちぼちやっていくとして、</li>
<li>次なにしょぅ。</li></ul>
<ul class="list1 list-indent1"><li>とりあえずOpenOCDをcygwinでビルド出来るようにしようかなとか考えているけれど、</li>
<li>うまくできることがわかったら、例の<a href="http://hp.vector.co.jp/authors/VA000177/html/2010-06.html#v208ec5f" rel="nofollow">USB-Blasterもどき</a>の続きでもやるかなぁ・・・。</li></ul>
<p>なんかARM系全般的に需要がないんだなぁ・・・。なんでだろ。</p>
<p>まあ、今頃DWM2008-5付録基板なんか引っ張りだしてもねぇ・・・。</p>
<p>今月の<a href="http://www.cqpub.co.jp/hanbai/books/mtr/mtrz201009.htm" rel="nofollow">トラ技</a>なんて、その2008年5月の付録よりもだいぶ劣化したCPU積んでるし。もうネタ尽きたのかな。</p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_45">Oracle、Java 特許侵害で Google を提訴、Android 配布中止求める<a class="anchor_super" id="i415d295" href="#i415d295" title="i415d295" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://slashdot.jp/it/10/08/20/0147235.shtml" rel="nofollow">http://slashdot.jp/it/10/08/20/0147235.shtml</a></li>
<li>ついにOracleは特許ゴロになったか。</li>
<li>というかAndroidもこれを機に別の仮想バイトコードにするとかARMネィテイブちっくな仮想マシンコードにするとかJavaやめてgolangにするとかきっぱりJavaと手を切ればいいのに。</li></ul>
<ul class="list1 list-indent1"><li>そうして<strong>Javaの死</strong></li>
<li>Sunもこの世に存在しないんだし。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_46">次なるターゲット・・・<a class="anchor_super" id="i8d772d7" href="#i8d772d7" title="i8d772d7" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/jpg/ARM/1343.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/jpg/ARM/1343.jpg" alt="http:/ATMEL_AVR/jpg/ARM/1343.jpg" /></a></li></ul>
<p>本屋で見かけたので、買ってしまった。</p>
<p><br />
<br />
<br />
<br /></p>
<ul class="list1 list-indent1"><li>今は、後悔している。</li></ul>
<ul class="list1 list-indent1"><li>ちなみに、ＰＣに繋ぐと、MSCデバイス（32kBのストレージデバイス）として認識された。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>USB D+は、1.5kΩで3.3Vに問答無用pull-upされている。</li>
<li>と同時に、読者が2SA1015を実装するとPIO0_6をLレベルにすることでさらに1.5kΩアクティブpull-up出来るようになる。</li>
<li>ただし、問答無用側のpull-up抵抗（表面実装されている米粒）を読者が除去する必要がある。</li>
<li>除去しない場合は、0.75kΩ/1.5kΩ切り替えという全く意味のない回路が構成されてしまう。</li></ul>
<ul class="list1 list-indent1"><li>USBに挿すだけで、温度計とかタッチセンサとか時計とかOPAMPに繋がると思ったら<strong>大間違い</strong>
<ul class="list2 list-indent1"><li>第一に、プログラムを書かなきゃならない。</li>
<li>第二に、基板上に所定のピンヘッダーを自分でハンダ付けして、ジャンパーでピン間を接続しなければLPCマイコンと他のICは接続されないのだ。（プログラム書くのも面倒だが、いちいちジャンパー挿すほうも面倒だと思うよ。おまい<strong>電子ブロック（電子ボード）基板かよ</strong>とか言いたくなる）</li>
<li>まあ、逆に言うと、ピンヘッダー間をショートさせるかわりに別の用途先に接続すれば、JTAGライターにするとかAVR/PICライターにするとかそういう応用は利く。</li>
<li>それから、時計ICは実装されているけれど32.768kHzの水晶は実装されていないので、<strong>適当な壊れた互換機のマザーボード</strong>などからもぎとってハンダ付けせねばならない。</li></ul></li></ul>
<p><br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_47"><span class="noexists"><a href="./?cmd=edit&amp;page=MicroBasic&amp;refer=2010-08">MicroBasic</a></span><a class="anchor_super" id="leb92cbe" href="#leb92cbe" title="leb92cbe" style="user-select:none;">&dagger;</a></h4>
<ul class="list1 list-indent1"><li>昔のGame言語のままみたいな（だけど劣化している）、<strong>残念な言語</strong>。</li>
<li>コードサイズは19kもある。昔のGame言語はZ80でも1K以内とか、えらく小さかった。(整数BASICは4kくらいだったし、実数Basicは8kくらいでどれも実装されていた時代)</li>
<li>変数はA-Z(32bit整数)</li>
<li>テキストエリア4kまで</li>
<li>１行80字まで</li></ul>
<p>このままじゃあ、Gameコンパイラ書いてThumb2のコードを落とすとかいう遊びにすら、<strong>使えないレベル</strong></p>
<ul class="list1 list-indent1"><li>ていうかBasicいらない。</li>
<li>せめてLuaとかSquirrelとかＣ言語風じゃないと。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>おまけはてんこ盛り。</li></ul>
<ul class="list1 list-indent1"><li><a href="http:/ATMEL_AVR/jpg/ARM/1343a.jpg" rel="nofollow"><img src="http:/ATMEL_AVR/jpg/ARM/1343a.jpg" alt="http:/ATMEL_AVR/jpg/ARM/1343a.jpg" /></a></li></ul>
<p>結局何なの、この基板</p>
<ul class="list1 list-indent1"><li>やっぱり、<strong>温度計。</strong></li>
<li>温度計なんだけど、I2Cの勉強して温度計ICにアクセス出来るようにならないと温度を教えてくれない<strong>ツンデレ温度計</strong></li></ul>
<ul class="list1 list-indent1"><li><a href="http://www.cqpub.co.jp/toragi/lpc1343/" rel="nofollow">関連情報</a>の<del>やる気なさ具合は、半端ねぇぜ。</del> --- 最近すこしづつ増えてるような気がする。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>STM32のA/D分解能は12bitあるけれどLPC1343とかは10bitしかない。</li>
<li>STM32はオンチップの温度センサーがあるけれどLPC1343にはない。</li></ul>
<ul class="list1 list-indent1"><li>あーそれからGPIOの(AVRで言うところの)DDR相当レジスタ周りがSTM32と全然違ってる。</li>
<li>Arduino風に使いたいなら、このメーカー差異が相当ガンだと思う。CMSISなんかで矯正不能なレベル。</li>
<li>それに、Flash32kなんて(Arduinoマニア系)ユーザー舐めてるとしか思えない。printfと書いただけで軽く32kオーバーするlibcっていったい・・・。</li>
<li>今時のArduinoでさえATMega32実装が当たり前なのに。</li>
<li>ちょっとしたスケッチを書くのに必要な最低容量はFlash128k,RAM 32kくらいは欲しいところ。</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_48">armon:ARM用HID bootloader<a class="anchor_super" id="k59e62d4" href="#k59e62d4" title="k59e62d4" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>USBフレームワークとCMSISを最新のものに差し替えてみた。</li>
<li>いろいろディレクトリ配置が替わっていて、手直しが面倒だった。</li>
<li>システム周りのソースを差し替えたので一時的に動かなくなった。
<ul class="list2 list-indent1"><li>STのソースはEVALボード用なので、CQ-STARMなどと少し違う。</li>
<li>そのあたりの修正が上書きされて消滅したため、こちらの基板で動かなくなった。</li></ul></li></ul>
<p><br /></p>
<p>一応リカバリーしてみた。</p>
<ul class="list1 list-indent1"><li>まだ全部の基板で試してないのでソースはUPしていない。</li></ul>
<p><br />
read more : <a href="armon.html" title="armon" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">STM32ブートローダー</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_49">準天頂衛星初号機「みちびき」<a class="anchor_super" id="k89407fc" href="#k89407fc" title="k89407fc" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li><a href="http://www.jaxa.jp/countdown/f18/overview/orbit_j.html" rel="nofollow">http://www.jaxa.jp/countdown/f18/overview/orbit_j.html</a></li></ul>
<ul class="list1 list-indent1"><li>すげー。</li>
<li>そもそもＧＰＳの補完情報とか勝手に流していいのかな。</li></ul>
<ul class="list1 list-indent1"><li>もちろん、こいつも一緒に受信して補正計算するようなファームにVerUpしない限り、現存するＧＰＳの精度が上がるわけではないけれど。</li></ul>
<ul class="list1 list-indent1"><li>一種のＧＰＳのガラパゴス化？</li></ul>
<ul class="list1 list-indent1"><li>（軌道をずらして）８機くらい上げればもう米国に頼らなくても済むようになるのかな？</li></ul>
<ul class="list1 list-indent1"><li>日本国近辺でしか使えないＧＰＳというのもどうかと思うけど。（国産車カーナビに限定すればそれでも良いけど）</li></ul>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_50">LPC1343:不思議なことに・・・<a class="anchor_super" id="u159ac24" href="#u159ac24" title="u159ac24" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>NXPのサンプルを見てみたら、面白いものを見つけた。</li></ul>
<p>_LPCXpresso1343_readme% cat readme.txt</p>
<pre>LPCXpresso LPC1343 Examples V1.30
Build date: 3/11/2010
---------------------------------</pre>
<pre>This package of examples is designed to run on the LPCXpresso LPC1343
board with the LPCXpresso IDE by Code Red. Many of the examples will
also benefit from the Embedded Artists' LPCXpresso base board.</pre>
<pre>Here is a list of the examples and a brief description of what they
do:</pre>
<pre>adc                    Demonstrates using the ADC to read voltages</pre>
<pre>autoisp                        Shows how to enter ROM in-circuit programming
                       and use the watchdog timer to reset back into
                       the new code</pre>
<pre>blinky                 Blinks an LED using a 32-bit timer</pre>
<pre>CMSISv1p30_LPC13xx     CMSIS library- defines all of the I/O registers
                       on the LPC1343</pre>
<pre>crp                    Demonstrates how to add Code Read Protect (CRP)
                       to a project</pre>
<pre>extint                 Shows how to configure external interrupt pins</pre>
<pre>gpio                   Shows how to set up the gpio</pre>
<pre>i2c                    Implements an i2c master that communicates with
                       the slave project</pre>
<pre>i2cslave               Implements an i2c slave that communicates with
                       master project</pre>
<pre>pwm                    Initializes two timers to output PWM waveforms</pre>
<pre>rs485                  Shows use of the UART in RS485 mode</pre>
<pre>ssp                    Shows use of the SSP in SPI mode</pre>
<pre>systick                        Shows how to use the Cortex core systick timer</pre>
<pre>uart                   Demo of the UART</pre>
<pre>usbcdc                 USB example that implements a virtual UART and
                       routes characters to the hardware UART on the
                       LPC1343</pre>
<pre>usbhid                 USB example that implements a Human Interface
                       Device allowing control of I/O pins</pre>
<pre>usbhid_rom             USB example using the on-chip ROM USB driver
                       that implements a USB HID device.
★
usbhid_rom_tiny        USB example showing several techniques to reduce
                       the flash size of code. The compiled project takes
                       404 bytes of flash.</pre>
<pre>usbmsd                 USB example that implements a Mass Storage Class
                       device with a readme.txt file on it.</pre>
<pre>usbmsd_rom             USB example that implements a Mass Storage Class
                       device using the on-chip ROM USB driver.</pre>
<pre>wdt                    Initializes the watchdog timer. It is set to
                       generate an interrupt that increments a timer
                       upon timeout. The wdt can be made to timeout
                       by stopping the code in the debugger.</pre>
<ul class="list1 list-indent1"><li>HIDデバイスをわずか４０４バイトで実装できるらしい。</li>
<li>もちろん、16kBの(USB-MSD)BOOTROMをライブラリとして利用する。</li></ul>
<ul class="list1 list-indent1"><li>これは凄いかも。</li>
<li>コードもあまり書かなくてよいらしい。</li>
<li>Flash 32kで足りないよーとか言ってたけれど、BIOS ROMが 16kもあって、USBのフレームワークを自前で持たなくてよい、というんだったら、結構いけてるかも。</li></ul>
<ul class="list1 list-indent1"><li>まあ、RAMが8Kしかない、というのがつらいことに変わりは無いけど。</li></ul>
<p><br />
<br />
<br /></p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_51">これも、ほんとに試してみた。<a class="anchor_super" id="a45ba62a" href="#a45ba62a" title="a45ba62a" style="user-select:none;">&dagger;</a></h4>
<p>わずか４０４バイトで、HIDデバイスとして使用できた。</p>
<p>read more : <a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></p>
<p><br />
<br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_52">LPC1343:TRZ1010Nのバカヤロー<a class="anchor_super" id="e038ea26" href="#e038ea26" title="e038ea26" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>LPCXpressoと同じバイナリーを転送してみた。</li>
<li>不明なデバイスになった。</li></ul>
<p>理由はわからない。</p>
<p>まさかBOOT-ROMの互換性がない、なんてことはないよね。</p>
<ul class="list1 list-indent1"><li><strong>ありえない展開に。</strong></li></ul>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_53">LPC1343:続：ありえない展開<a class="anchor_super" id="v6175687" href="#v6175687" title="v6175687" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>TRZ1010N基板は、別のＰＣに接続したところ、HIDデバイスとして認識され、ＰＣ側のクライアントソフトから制御することができた。</li></ul>
<ul class="list1 list-indent1"><li>しかし、それは、<strong>たまたま</strong>だった。</li>
<li>その後USBの挿抜では、ついに認識されることは無かった。</li></ul>
<ul class="list1 list-indent1"><li>同じファームを入れて、同じＰＣ上でLPCXpresso基板はほぼ９０％くらいの確率でちゃんとHIDデバイスとして認識する。</li></ul>
<ul class="list1 list-indent1"><li>また、FT/GPIOをGNDに落とした状態(MSDデバイス)でＰＣがUSBドライブとして認識するかのテストでもLPCXpresso基板の
ほうはほぼ確実に認識するけれど、</li>
<li>TRZ1010N基板は、認識しない場合がけっこうある。（３割くらいが駄目な感じ）</li></ul>
<p>やっぱり、ＣＱ基板は電源周りが弱いというのは定説だな。</p>
<ul class="list1 list-indent1"><li>今のところ基板をいじった箇所は、
<ul class="list2 list-indent1"><li>ブートジャンパーを実装。</li>
<li>ＬＥＤを実装。</li></ul></li>
<li>の２つのみ。</li></ul>
<p>最初のＰＣで認識しなかった時点では、基板は一切の加工を行っていなかったので、上記実装に関しては犯人ではないことがわかっている。</p>
<ul class="list1 list-indent1"><li>いつのまにかＣＱ基板は<strong>トラブルシュートを楽しむもの</strong>と化してしまっている。</li></ul>
<p>それって、かなり<strong>駄目じゃないか。</strong></p>
<ul class="list1 list-indent1"><li>少なくとも、入門者向けではないような気がする・・・</li></ul>
<p><br />
もうひとつ問題が・・・</p>
<ul class="list1 list-indent1"><li>usbhid_romのビルドでは、libcr_c.aが必要とか言われるけれど、そんなもの無い。</li>
<li>usbhidのビルドがはたして正しいかどうか判定できない。
<ul class="list2 list-indent1"><li>LPCXpressoに転送したところ、正しく動かない。</li></ul></li></ul>
<ul class="list1 list-indent1"><li>なんかどうもLPCXpressoと相性悪いな。</li></ul>
<p>このチップ(LPC1343)、きっぱり切り捨てるかも。</p>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_54">LPC1343:続：いったん収束<a class="anchor_super" id="d9631e0f" href="#d9631e0f" title="d9631e0f" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>全く使ったことが無かったけれど、eclipseを起動。</li>
<li>QuickStartというWindowにある、「Import Example Project(s)」のようなメニューをクリック。</li>
<li>LPCXpressoをインストールしたディレクトリのExamples/LPC1000/にある、LPC13xxExamples.zipのようなファイルを指定。</li>
<li>すると、サンプルプロジェクトを全部展開してくれる。</li></ul>
<p>試行錯誤している間は、zipファイルを手動で展開したディレクトリのプロジェクトファイルのようなものを指定しようとしても
全然駄目（開いてくれない）だったのに。</p>
<ul class="list1 list-indent1"><li>Build Allのようなプルダウンメニューを選ぶと、とりあえず全部コンパイルしてくれる。</li></ul>
<ul class="list1 list-indent1"><li>さて、hexファイルはどこ？</li></ul>
<p>あれ、ない。</p>
<ul class="list1 list-indent1"><li>調べたところ、拡張子axfファイルが、elfだと分かった。</li>
<li>なので、CodeSourceryについてきた arm-none-eabi-objcopyを使って、こんどはelfをバイナリーにする。
<pre>D:&gt; arm-none-eabi-objcopy -O binary usbhid.axf firmware.bin
D:&gt; srec2bin.exe -w firmware.bin</pre></li></ul>
<ul class="list1 list-indent1"><li>srec2binというのはちっぽけな自作ツールで、リセットベクターの０番から７番までの整数和がゼロになるように、７番目の
ベクター値を補正するプログラム。</li></ul>
<ul class="list1 list-indent1"><li>これをかまさないと、ブートローダーはアプリケーションを実行してくれない。</li></ul>
<p>出来たfirmware.bin (13kBほど)をMSDデバイスのドライブにコピー。</p>
<ul class="list1 list-indent1"><li>こんどは、ほぼ１００％の確率でHIDデバイスとして動作するようになった。（TRZ1010N基板にて）

結論：</li>
<li>TRZ1010N基板は何故かusbhid_rom_tinyが動かない疑惑中。</li></ul>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_55">TRZ1010N基板：念のためusbhid_rom_tinyも!<a class="anchor_super" id="lecd80d6" href="#lecd80d6" title="lecd80d6" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>eclipseでビルドしたaxfファイルからfirmware.binを作り、TRZ1010N基板に転送。</li>
<li>HIDデバイスとしての認識率はやはり１０％以下。（というか試行１０回中認識ゼロ）全部不明なデバイスになる。</li></ul>
<p>これはどう解釈すべきなんだろうか。</p>
<ul class="list1 list-indent1"><li>BOOT-ROMを実行時ライブラリとして（呼び出して）使うタイプのUSBデバイスサンプルは</li>
<li>TRZ1010N基板では全滅。</li>
<li>LPCXpressoのターゲット基板では、大体動作する。</li></ul>
<ul class="list1 list-indent1"><li>しかし、回路的に大きな違いはない。</li>
<li>念のためUSBケーブル側に10μFの電解コンデンサを入れてケーブル挿抜を繰り返してみたが、TRZ基板は駄目なことに変わりはなかった。</li></ul>
<p>お前の信頼度はそんなものなのか＞<strong>LPC1343</strong></p>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_56">ARM関連：Apple A4プロセッサを分解<a class="anchor_super" id="a22ed199" href="#a22ed199" title="a22ed199" style="user-select:none;">&dagger;</a></h2>
<p>「革命」ではなく「進化」の産物　EE Times</p>
<ul class="list1 list-indent1"><li><a href="http://eetimes.jp/content/4153" rel="nofollow">http://eetimes.jp/content/4153</a></li>
<li>Cortex-A8がそのまま入ってた。</li></ul>
<p><br /></p>
<p>【Hot Chips 22レポート】
ARM、次期ハイエンドコア「Eagle」の内容を一部公表</p>
<ul class="list1 list-indent1"><li><a href="http://pc.watch.impress.co.jp/docs/news/event/20100825_389138.html" rel="nofollow">http://pc.watch.impress.co.jp/docs/news/event/20100825_389138.html</a></li>
<li>物理アドレス拡張(40bit)と仮想化</li>
<li>サーバー用途なのか。</li></ul>
<p><br />
<br /></p>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_57">LPC1343:usbhidのビルドを試みる。<a class="anchor_super" id="zda4b73f" href="#zda4b73f" title="zda4b73f" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>usbhid_rom_tinyと同じ要領でビルドツリーを作成。</li>
<li>ビルドはＯＫ。コードは4Kくらい。</li>
<li>LPCXpresso側に転送すると、「不明なデバイス」</li></ul>
<ul class="list1 list-indent1"><li>eclipseでビルドされたコードは12kもあり、こっちだとちゃんと動作する。</li>
<li>CDEFSに
<pre>-D__USE_CMSIS=CMSISv1p30_LPC13xx</pre>
を加えてやったら、やっと動作するバイナリーが得られた。</li>
<li>でもコードは4kくらい。</li>
<li>eclipseはgc-sectionしないのかな。</li></ul>
<p><br /></p>
<ul class="list1 list-indent1"><li>TRZ1010N基板でも正しく動作した。</li></ul>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_58">ついでだから、usbhid_romもビルドしてみた。<a class="anchor_super" id="z4ecf9e5" href="#z4ecf9e5" title="z4ecf9e5" style="user-select:none;">&dagger;</a></h3>
<ul class="list1 list-indent1"><li>TRZ1010N基板でも正しく動作した。</li>
<li>こっちはコードサイズが1.2kB程度。</li></ul>
<ul class="list1 list-indent1"><li>サイズ404バイトのやつはストリングディスクリプタが腐っている様子なので、デバイス認識しない理由はそのへんにあるのかも知れない。</li></ul>
<p>read more: <a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></p>
<p><br />
結論：コードサイズ的には僅か1.2kBでHIDデバイスが書けるならそれで充分。</p>
<ul class="list1 list-indent1"><li>それ以上縮める意味無いんじゃないか。</li>
<li>まさかATtiny2313じゃあるまいし。</li>
<li>（Flashは32kBもあるんだし。）</li></ul>
<p><br />
今更ながらV-USB(AVR-USB)のコードサイズには驚愕する。</p>
<ul class="list1 list-indent1"><li>純粋なSoftware-USBなのに、HIDデバイス、AVRライターの実装も含め、わずか2kBのATtiny2313のFlash容量に入ってしまうんだから。</li>
<li>対するLPC1343のHIDデバイスは実際のところ、16kBのBOOT-ROMを呼び出しているわけ
なので、1.2kBの解釈は、リセットベクター、マイコンデバイス初期化とHIDディスクリプタで消費されているわけだ。USBプロトコルエンジン自体はハードウェア実装だし、割り込みハンドラーの多くはBOOT-ROM内実装なので1.2kBの内容には一切含まれない。</li></ul>
<p><br />
<br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_59">LPC1343:armonの移植に取り掛かる<a class="anchor_super" id="b0bd8771" href="#b0bd8771" title="b0bd8771" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>切り捨てようかと思っていたLPC1343だが、一応HIDデバイスにはなりそうなので、<a href="armon.html" class="link_page_passage" data-mtime="2014-11-17T14:44:27+09:00">armon</a>を移植することにした。</li>
<li>やはり、USB周りの定義や処理が全然違う。</li>
<li>そればかりでなく、Flashの書き換え関数も違ってるような気がする。
<ul class="list2 list-indent1"><li>というか、Flash書き換え関数なんてない。</li></ul></li>
<li>autoispというサンプルは、BOOT-ROMに制御を戻すためのサンプルのような気がする。</li></ul>
<p>やっぱり切り捨てよう。</p>
<p><br /></p>
<ul class="list1 list-indent1"><li>usbhid-romのサンプルはBOOT-ROM内蔵のUSB関数を使用することでUSBデバイス記述を簡易にしてコードサイズも節約する狙いがあるようであるが、</li>
<li>残念なことにエンドポイントの細かい制御が出来ないのでarmonには使えないことが判明した。</li>
<li>また、ストリングディスクリプタを登録できるところまではよいが、文字数が決めうちになっていて、文字数を変えると正しいストリングを返さなくなってしまう欠点がある。</li></ul>
<p><br />
抜け道としては、</p>
<ul class="list1 list-indent1"><li>BOOTROMのサービス関数エントリーは使わずに、usbhidサンプルに含まれる関数のうち、ROM内に同じ形で残っている関数をリストアップして、そっちを呼び出す方法がある。</li>
<li>まるで、昔の８ビットパーソナルコンピュータのBASIC-ROMを解析して、サブルーチンとして使うような手法だ。</li>
<li>BOOT-ROMが更新されてアドレスがずれたらアウトだ。</li></ul>
<p><strong>そんなことしなくてもHIDデバイスは書ける</strong>からしないけど。</p>
<p><br /></p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h2 id="content_1_60">LPC1343用: HID簡易モニター（armon） .(LPCXpresso / TRZ1010N 両対応)<a class="anchor_super" id="yf185441" href="#yf185441" title="yf185441" style="user-select:none;">&dagger;</a></h2>
<ul class="list1 list-indent1"><li>とりあえず、作ってみた。</li>
<li>やっぱり、STM32とはUSB周りが全く違っている。</li>
<li>Flash書き換え方法が分からないので、ブートローダーにはならない。</li>
<li>printfを使うと、32kBを越えるので、焼けない・・・（この時点でLPCマイコンはArduinoのようなプロトタイピング用途には向かない）・・・っていうのは、まるで、H8-Tinyみたいだな。</li></ul>
<p><br />
read more: <a href="LPCXpresso.html" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">LPCXpresso</a></p>
<ul class="list1 list-indent1"><li>もちろん、自作の小さなprintfで代用するとか、REDLIBを借用して使うとかいう逃げはあるけれど、どのみち32kFlash+8kRAMには限界がある。</li></ul>
<p><br />
ちなみに、BOOT-ROM(16kB)の内容は、(LPCXpresso と TRZ1010N を比較した結果)<strong>全く同一</strong>だった。</p>
<ul class="list1 list-indent1"><li>これを確かめるためにわざわざ<a href="LPCXpresso.html" title="LPCXpresso" class="link_page_passage" data-mtime="2014-11-17T14:44:26+09:00">HIDモニタ（armon）</a>を書いたわけだが。</li></ul>
<p><br />
<br />
<br /></p>
   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="http:/ATMEL_AVR/html/" style="background-image: url(image/title.jpg);"></a></div>
 <div id="personal"><ul><li class="login"><a href="#">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="../image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="../image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li id="lastmod">Last-modified: 2010-08-28 (土) 23:54:56<span class="page_passage" data-mtime="2010-08-28T23:54:56+09:00"></span></li><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>convert time: 0.106 sec</li>
    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
